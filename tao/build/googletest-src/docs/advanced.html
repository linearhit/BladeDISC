

<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Advanced googletest Topics &mdash; BladeDISC 1.0.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../../_static/css/theme.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/theme.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/copybutton.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 

</head>

<body>
    <header>
        <div class="container">
            <a class="site-nav-toggle hidden-lg-up"><i class="icon-menu"></i></a>
            <a class="site-title" href="../../../../index.html">
                BladeDISC
            </a>
        </div>
    </header>


<div class="breadcrumbs-outer hidden-xs-down">
    <div class="container">
        















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a></li>
        
      <li>Advanced googletest Topics</li>
    
    
      <li class="breadcrumbs-aside">
        
            
            <a href="../../../../_sources/tao/build/googletest-src/docs/advanced.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>
</div>
    </div>
</div>
    <div class="main-outer">
        <div class="container">
            <div class="row">
                <div class="col-12 col-lg-3 site-nav">
                    
<div role="search">
    <form class="search" action="../../../../search.html" method="get">
        <div class="icon-input">
            <input type="text" name="q" placeholder="Search" />
            <span class="icon-search"></span>
        </div>
        <input type="submit" value="Go" class="d-hidden" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
    </form>
</div>
                    <div class="site-nav-tree">
                        
                            
                            
                                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../README_.html">BladeDISC Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../README_.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../README_.html#api-quickview">API QuickView</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../README_.html#for-pytorch-users">For PyTorch Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../README_.html#setup-and-examples">Setup and Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../README_.html#publications">Publications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../README_.html#tutorials-and-documents-for-developers">Tutorials and Documents for Developers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../README_.html#how-to-contribute">How to Contribute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../README_.html#faq">FAQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../README_.html#contact-us">Contact Us</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../docs/install_with_docker.html">Install with Docker</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../docs/install_with_docker.html#download-a-bladedisc-docker-image">Download a BladeDISC Docker Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../docs/install_with_docker.html#start-a-docker-container">Start a Docker Container</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../docs/build_from_source.html">Build from Source</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../docs/build_from_source.html#prerequisite">Prerequisite</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../docs/build_from_source.html#checkout-the-source">Checkout the Source</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../docs/build_from_source.html#building-bladedisc-for-tensorflow-users">Building BladeDISC for TensorFlow Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../docs/build_from_source.html#building-bladedisc-for-pytorch-users">Building BladeDISC for PyTorch Users</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../docs/quickstart.html">Quickstart for TensorFlow/PyTorch users</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../docs/quickstart.html#quickstart-for-tensorflow-users">Quickstart for TensorFlow Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../docs/quickstart.html#quickstart-for-pytorch-users">Quickstart for PyTorch Users</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../docs/contribution.html">How to Contribute</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../docs/contribution.html#local-development-environment">Local Development Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../docs/contribution.html#submit-a-pull-request-to-bladedisc">Submit a Pull Request to BladeDISC</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../docs/developers/index.html">Documentation for Developers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../docs/developers/pass_pipeline.html">Tutorial: A Walkthough of the BladeDISC Pass Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../docs/developers/runtime_abstraction_layer.html">Runtime Abstraction Layer Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../docs/developers/bladedisc_torch_overview.html">BladeDISC Torch Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../docs/developers/torch_add_a_new_converter.html">Tutorial: How to add the support of a new Torch Op</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../docs/tutorials/index.html">Tutorials on Example Use Cases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../docs/tutorials/tensorflow_inference_and_training.html">Use case of TensorFlow Inference and Training</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../docs/tutorials/torch_bert_inference.html">Use case of PyTorch Inference</a></li>
</ul>
</li>
</ul>

                            
                        
                    </div>
                </div>
                <div class="col-12 col-lg-9">
                    <div class="document">
                        
                            
  <div class="section" id="advanced-googletest-topics">
<h1>Advanced googletest Topics<a class="headerlink" href="#advanced-googletest-topics" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Now that you have read the <a class="reference internal" href="primer.html"><span class="doc">googletest Primer</span></a> and learned how to
write tests using googletest, it’s time to learn some new tricks. This document
will show you more assertions as well as how to construct complex failure
messages, propagate fatal failures, reuse and speed up your test fixtures, and
use various flags with your tests.</p>
</div>
<div class="section" id="more-assertions">
<h2>More Assertions<a class="headerlink" href="#more-assertions" title="Permalink to this headline">¶</a></h2>
<p>This section covers some less frequently used, but still significant,
assertions.</p>
<div class="section" id="explicit-success-and-failure">
<h3>Explicit Success and Failure<a class="headerlink" href="#explicit-success-and-failure" title="Permalink to this headline">¶</a></h3>
<p>See Explicit Success and Failure in
the Assertions Reference.</p>
</div>
<div class="section" id="exception-assertions">
<h3>Exception Assertions<a class="headerlink" href="#exception-assertions" title="Permalink to this headline">¶</a></h3>
<p>See Exception Assertions in the Assertions
Reference.</p>
</div>
<div class="section" id="predicate-assertions-for-better-error-messages">
<h3>Predicate Assertions for Better Error Messages<a class="headerlink" href="#predicate-assertions-for-better-error-messages" title="Permalink to this headline">¶</a></h3>
<p>Even though googletest has a rich set of assertions, they can never be complete,
as it’s impossible (nor a good idea) to anticipate all scenarios a user might
run into. Therefore, sometimes a user has to use <code class="docutils literal notranslate"><span class="pre">EXPECT_TRUE()</span></code> to check a
complex expression, for lack of a better macro. This has the problem of not
showing you the values of the parts of the expression, making it hard to
understand what went wrong. As a workaround, some users choose to construct the
failure message by themselves, streaming it into <code class="docutils literal notranslate"><span class="pre">EXPECT_TRUE()</span></code>. However, this
is awkward especially when the expression has side-effects or is expensive to
evaluate.</p>
<p>googletest gives you three different options to solve this problem:</p>
<div class="section" id="using-an-existing-boolean-function">
<h4>Using an Existing Boolean Function<a class="headerlink" href="#using-an-existing-boolean-function" title="Permalink to this headline">¶</a></h4>
<p>If you already have a function or functor that returns <code class="docutils literal notranslate"><span class="pre">bool</span></code> (or a type that
can be implicitly converted to <code class="docutils literal notranslate"><span class="pre">bool</span></code>), you can use it in a <em>predicate
assertion</em> to get the function arguments printed for free. See
EXPECT_PRED* in the Assertions
Reference for details.</p>
</div>
<div class="section" id="using-a-function-that-returns-an-assertionresult">
<h4>Using a Function That Returns an AssertionResult<a class="headerlink" href="#using-a-function-that-returns-an-assertionresult" title="Permalink to this headline">¶</a></h4>
<p>While <code class="docutils literal notranslate"><span class="pre">EXPECT_PRED*()</span></code> and friends are handy for a quick job, the syntax is not
satisfactory: you have to use different macros for different arities, and it
feels more like Lisp than C++. The <code class="docutils literal notranslate"><span class="pre">::testing::AssertionResult</span></code> class solves
this problem.</p>
<p>An <code class="docutils literal notranslate"><span class="pre">AssertionResult</span></code> object represents the result of an assertion (whether it’s
a success or a failure, and an associated message). You can create an
<code class="docutils literal notranslate"><span class="pre">AssertionResult</span></code> using one of these factory functions:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="n">testing</span> <span class="p">{</span>

<span class="c1">// Returns an AssertionResult object to indicate that an assertion has</span>
<span class="c1">// succeeded.</span>
<span class="n">AssertionResult</span> <span class="n">AssertionSuccess</span><span class="p">();</span>

<span class="c1">// Returns an AssertionResult object to indicate that an assertion has</span>
<span class="c1">// failed.</span>
<span class="n">AssertionResult</span> <span class="nf">AssertionFailure</span><span class="p">();</span>

<span class="p">}</span>
</pre></div>
</div>
<p>You can then use the <code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span></code> operator to stream messages to the <code class="docutils literal notranslate"><span class="pre">AssertionResult</span></code>
object.</p>
<p>To provide more readable messages in Boolean assertions (e.g. <code class="docutils literal notranslate"><span class="pre">EXPECT_TRUE()</span></code>),
write a predicate function that returns <code class="docutils literal notranslate"><span class="pre">AssertionResult</span></code> instead of <code class="docutils literal notranslate"><span class="pre">bool</span></code>. For
example, if you define <code class="docutils literal notranslate"><span class="pre">IsEven()</span></code> as:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">testing</span><span class="o">::</span><span class="n">AssertionResult</span> <span class="n">IsEven</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">n</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">testing</span><span class="o">::</span><span class="n">AssertionSuccess</span><span class="p">();</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="n">testing</span><span class="o">::</span><span class="n">AssertionFailure</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">n</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; is odd&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>instead of:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">bool</span> <span class="nf">IsEven</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">n</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>the failed assertion <code class="docutils literal notranslate"><span class="pre">EXPECT_TRUE(IsEven(Fib(4)))</span></code> will print:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Value of: IsEven(Fib(4))
  Actual: false (3 is odd)
Expected: true
</pre></div>
</div>
<p>instead of a more opaque</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Value of: IsEven(Fib(4))
  Actual: false
Expected: true
</pre></div>
</div>
<p>If you want informative messages in <code class="docutils literal notranslate"><span class="pre">EXPECT_FALSE</span></code> and <code class="docutils literal notranslate"><span class="pre">ASSERT_FALSE</span></code> as well
(one third of Boolean assertions in the Google code base are negative ones), and
are fine with making the predicate slower in the success case, you can supply a
success message:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">testing</span><span class="o">::</span><span class="n">AssertionResult</span> <span class="n">IsEven</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">n</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">testing</span><span class="o">::</span><span class="n">AssertionSuccess</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">n</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; is even&quot;</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="n">testing</span><span class="o">::</span><span class="n">AssertionFailure</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">n</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; is odd&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Then the statement <code class="docutils literal notranslate"><span class="pre">EXPECT_FALSE(IsEven(Fib(6)))</span></code> will print</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  Value of: IsEven(Fib(6))
     Actual: true (8 is even)
  Expected: false
</pre></div>
</div>
</div>
<div class="section" id="using-a-predicate-formatter">
<h4>Using a Predicate-Formatter<a class="headerlink" href="#using-a-predicate-formatter" title="Permalink to this headline">¶</a></h4>
<p>If you find the default message generated by
EXPECT_PRED* and
EXPECT_TRUE unsatisfactory, or some
arguments to your predicate do not support streaming to <code class="docutils literal notranslate"><span class="pre">ostream</span></code>, you can
instead use <em>predicate-formatter assertions</em> to <em>fully</em> customize how the
message is formatted. See
EXPECT_PRED_FORMAT* in the
Assertions Reference for details.</p>
</div>
</div>
<div class="section" id="floating-point-comparison">
<h3>Floating-Point Comparison<a class="headerlink" href="#floating-point-comparison" title="Permalink to this headline">¶</a></h3>
<p>See Floating-Point Comparison in the
Assertions Reference.</p>
<div class="section" id="floating-point-predicate-format-functions">
<h4>Floating-Point Predicate-Format Functions<a class="headerlink" href="#floating-point-predicate-format-functions" title="Permalink to this headline">¶</a></h4>
<p>Some floating-point operations are useful, but not that often used. In order to
avoid an explosion of new macros, we provide them as predicate-format functions
that can be used in the predicate assertion macro
EXPECT_PRED_FORMAT2, for
example:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">FloatLE</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">DoubleLE</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">EXPECT_PRED_FORMAT2</span><span class="p">(</span><span class="n">FloatLE</span><span class="p">,</span> <span class="n">val1</span><span class="p">,</span> <span class="n">val2</span><span class="p">);</span>
<span class="n">EXPECT_PRED_FORMAT2</span><span class="p">(</span><span class="n">DoubleLE</span><span class="p">,</span> <span class="n">val1</span><span class="p">,</span> <span class="n">val2</span><span class="p">);</span>
</pre></div>
</div>
<p>The above code verifies that <code class="docutils literal notranslate"><span class="pre">val1</span></code> is less than, or approximately equal to,
<code class="docutils literal notranslate"><span class="pre">val2</span></code>.</p>
</div>
</div>
<div class="section" id="asserting-using-gmock-matchers">
<h3>Asserting Using gMock Matchers<a class="headerlink" href="#asserting-using-gmock-matchers" title="Permalink to this headline">¶</a></h3>
<p>See EXPECT_THAT in the Assertions
Reference.</p>
</div>
<div class="section" id="more-string-assertions">
<h3>More String Assertions<a class="headerlink" href="#more-string-assertions" title="Permalink to this headline">¶</a></h3>
<p>(Please read the <a class="reference external" href="#asserting-using-gmock-matchers">previous</a> section first if
you haven’t.)</p>
<p>You can use the gMock <a class="reference internal" href="reference/matchers.html#string-matchers"><span class="std std-ref">string matchers</span></a>
with EXPECT_THAT to do more string
comparison tricks (sub-string, prefix, suffix, regular expression, and etc). For
example,</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">HasSubstr</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">MatchesRegex</span><span class="p">;</span>
<span class="p">...</span>
  <span class="n">ASSERT_THAT</span><span class="p">(</span><span class="n">foo_string</span><span class="p">,</span> <span class="n">HasSubstr</span><span class="p">(</span><span class="s">&quot;needle&quot;</span><span class="p">));</span>
  <span class="n">EXPECT_THAT</span><span class="p">(</span><span class="n">bar_string</span><span class="p">,</span> <span class="n">MatchesRegex</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">w*</span><span class="se">\\</span><span class="s">d+&quot;</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="windows-hresult-assertions">
<h3>Windows HRESULT assertions<a class="headerlink" href="#windows-hresult-assertions" title="Permalink to this headline">¶</a></h3>
<p>See Windows HRESULT Assertions in the
Assertions Reference.</p>
</div>
<div class="section" id="type-assertions">
<h3>Type Assertions<a class="headerlink" href="#type-assertions" title="Permalink to this headline">¶</a></h3>
<p>You can call the function</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">StaticAssertTypeEq</span><span class="o">&lt;</span><span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="o">&gt;</span><span class="p">();</span>
</pre></div>
</div>
<p>to assert that types <code class="docutils literal notranslate"><span class="pre">T1</span></code> and <code class="docutils literal notranslate"><span class="pre">T2</span></code> are the same. The function does nothing if
the assertion is satisfied. If the types are different, the function call will
fail to compile, the compiler error message will say that <code class="docutils literal notranslate"><span class="pre">T1</span> <span class="pre">and</span> <span class="pre">T2</span> <span class="pre">are</span> <span class="pre">not</span> <span class="pre">the</span> <span class="pre">same</span> <span class="pre">type</span></code> and most likely (depending on the compiler) show you the actual
values of <code class="docutils literal notranslate"><span class="pre">T1</span></code> and <code class="docutils literal notranslate"><span class="pre">T2</span></code>. This is mainly useful inside template code.</p>
<p><strong>Caveat</strong>: When used inside a member function of a class template or a function
template, <code class="docutils literal notranslate"><span class="pre">StaticAssertTypeEq&lt;T1,</span> <span class="pre">T2&gt;()</span></code> is effective only if the function is
instantiated. For example, given:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">Bar</span><span class="p">()</span> <span class="p">{</span> <span class="n">testing</span><span class="o">::</span><span class="n">StaticAssertTypeEq</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span><span class="p">();</span> <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<p>the code:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">Test1</span><span class="p">()</span> <span class="p">{</span> <span class="n">Foo</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">foo</span><span class="p">;</span> <span class="p">}</span>
</pre></div>
</div>
<p>will not generate a compiler error, as <code class="docutils literal notranslate"><span class="pre">Foo&lt;bool&gt;::Bar()</span></code> is never actually
instantiated. Instead, you need:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">Test2</span><span class="p">()</span> <span class="p">{</span> <span class="n">Foo</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">foo</span><span class="p">;</span> <span class="n">foo</span><span class="p">.</span><span class="n">Bar</span><span class="p">();</span> <span class="p">}</span>
</pre></div>
</div>
<p>to cause a compiler error.</p>
</div>
<div class="section" id="assertion-placement">
<h3>Assertion Placement<a class="headerlink" href="#assertion-placement" title="Permalink to this headline">¶</a></h3>
<p>You can use assertions in any C++ function. In particular, it doesn’t have to be
a method of the test fixture class. The one constraint is that assertions that
generate a fatal failure (<code class="docutils literal notranslate"><span class="pre">FAIL*</span></code> and <code class="docutils literal notranslate"><span class="pre">ASSERT_*</span></code>) can only be used in
void-returning functions. This is a consequence of Google’s not using
exceptions. By placing it in a non-void function you’ll get a confusing compile
error like <code class="docutils literal notranslate"><span class="pre">&quot;error:</span> <span class="pre">void</span> <span class="pre">value</span> <span class="pre">not</span> <span class="pre">ignored</span> <span class="pre">as</span> <span class="pre">it</span> <span class="pre">ought</span> <span class="pre">to</span> <span class="pre">be&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;cannot</span> <span class="pre">initialize</span> <span class="pre">return</span> <span class="pre">object</span> <span class="pre">of</span> <span class="pre">type</span> <span class="pre">'bool'</span> <span class="pre">with</span> <span class="pre">an</span> <span class="pre">rvalue</span> <span class="pre">of</span> <span class="pre">type</span> <span class="pre">'void'&quot;</span></code> or
<code class="docutils literal notranslate"><span class="pre">&quot;error:</span> <span class="pre">no</span> <span class="pre">viable</span> <span class="pre">conversion</span> <span class="pre">from</span> <span class="pre">'void'</span> <span class="pre">to</span> <span class="pre">'string'&quot;</span></code>.</p>
<p>If you need to use fatal assertions in a function that returns non-void, one
option is to make the function return the value in an out parameter instead. For
example, you can rewrite <code class="docutils literal notranslate"><span class="pre">T2</span> <span class="pre">Foo(T1</span> <span class="pre">x)</span></code> to <code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">Foo(T1</span> <span class="pre">x,</span> <span class="pre">T2*</span> <span class="pre">result)</span></code>. You
need to make sure that <code class="docutils literal notranslate"><span class="pre">*result</span></code> contains some sensible value even when the
function returns prematurely. As the function now returns <code class="docutils literal notranslate"><span class="pre">void</span></code>, you can use
any assertion inside of it.</p>
<p>If changing the function’s type is not an option, you should just use assertions
that generate non-fatal failures, such as <code class="docutils literal notranslate"><span class="pre">ADD_FAILURE*</span></code> and <code class="docutils literal notranslate"><span class="pre">EXPECT_*</span></code>.</p>
<p>{: .callout .note}
NOTE: Constructors and destructors are not considered void-returning functions,
according to the C++ language specification, and so you may not use fatal
assertions in them; you’ll get a compilation error if you try. Instead, either
call <code class="docutils literal notranslate"><span class="pre">abort</span></code> and crash the entire test executable, or put the fatal assertion in
a <code class="docutils literal notranslate"><span class="pre">SetUp</span></code>/<code class="docutils literal notranslate"><span class="pre">TearDown</span></code> function; see
constructor/destructor vs. SetUp/TearDown</p>
<p>{: .callout .warning}
WARNING: A fatal assertion in a helper function (private void-returning method)
called from a constructor or destructor does not terminate the current test, as
your intuition might suggest: it merely returns from the constructor or
destructor early, possibly leaving your object in a partially-constructed or
partially-destructed state! You almost certainly want to <code class="docutils literal notranslate"><span class="pre">abort</span></code> or use
<code class="docutils literal notranslate"><span class="pre">SetUp</span></code>/<code class="docutils literal notranslate"><span class="pre">TearDown</span></code> instead.</p>
</div>
</div>
<div class="section" id="skipping-test-execution">
<h2>Skipping test execution<a class="headerlink" href="#skipping-test-execution" title="Permalink to this headline">¶</a></h2>
<p>Related to the assertions <code class="docutils literal notranslate"><span class="pre">SUCCEED()</span></code> and <code class="docutils literal notranslate"><span class="pre">FAIL()</span></code>, you can prevent further test
execution at runtime with the <code class="docutils literal notranslate"><span class="pre">GTEST_SKIP()</span></code> macro. This is useful when you need
to check for preconditions of the system under test during runtime and skip
tests in a meaningful way.</p>
<p><code class="docutils literal notranslate"><span class="pre">GTEST_SKIP()</span></code> can be used in individual test cases or in the <code class="docutils literal notranslate"><span class="pre">SetUp()</span></code> methods
of classes derived from either <code class="docutils literal notranslate"><span class="pre">::testing::Environment</span></code> or <code class="docutils literal notranslate"><span class="pre">::testing::Test</span></code>.
For example:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">TEST</span><span class="p">(</span><span class="n">SkipTest</span><span class="p">,</span> <span class="n">DoesSkip</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">GTEST_SKIP</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Skipping single test&quot;</span><span class="p">;</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>  <span class="c1">// Won&#39;t fail; it won&#39;t be executed</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">SkipFixture</span> <span class="o">:</span> <span class="k">public</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Test</span> <span class="p">{</span>
 <span class="k">protected</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">SetUp</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span>
    <span class="n">GTEST_SKIP</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Skipping all tests for this fixture&quot;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Tests for SkipFixture won&#39;t be executed.</span>
<span class="n">TEST_F</span><span class="p">(</span><span class="n">SkipFixture</span><span class="p">,</span> <span class="n">SkipsOneTest</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>  <span class="c1">// Won&#39;t fail</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As with assertion macros, you can stream a custom message into <code class="docutils literal notranslate"><span class="pre">GTEST_SKIP()</span></code>.</p>
</div>
<div class="section" id="teaching-googletest-how-to-print-your-values">
<h2>Teaching googletest How to Print Your Values<a class="headerlink" href="#teaching-googletest-how-to-print-your-values" title="Permalink to this headline">¶</a></h2>
<p>When a test assertion such as <code class="docutils literal notranslate"><span class="pre">EXPECT_EQ</span></code> fails, googletest prints the argument
values to help you debug. It does this using a user-extensible value printer.</p>
<p>This printer knows how to print built-in C++ types, native arrays, STL
containers, and any type that supports the <code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span></code> operator. For other types, it
prints the raw bytes in the value and hopes that you the user can figure it out.</p>
<p>As mentioned earlier, the printer is <em>extensible</em>. That means you can teach it
to do a better job at printing your particular type than to dump the bytes. To
do that, define <code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span></code> for your type:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ostream&gt;</span><span class="cp"></span>

<span class="k">namespace</span> <span class="n">foo</span> <span class="p">{</span>

<span class="k">class</span> <span class="nc">Bar</span> <span class="p">{</span>  <span class="c1">// We want googletest to be able to print instances of this.</span>
<span class="p">...</span>
  <span class="c1">// Create a free inline friend function.</span>
  <span class="k">friend</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">Bar</span><span class="o">&amp;</span> <span class="n">bar</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="n">bar</span><span class="p">.</span><span class="n">DebugString</span><span class="p">();</span>  <span class="c1">// whatever needed to print bar to os</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// If you can&#39;t declare the function in the class it&#39;s important that the</span>
<span class="c1">// &lt;&lt; operator is defined in the SAME namespace that defines Bar.  C++&#39;s look-up</span>
<span class="c1">// rules rely on that.</span>
<span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">Bar</span><span class="o">&amp;</span> <span class="n">bar</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="n">bar</span><span class="p">.</span><span class="n">DebugString</span><span class="p">();</span>  <span class="c1">// whatever needed to print bar to os</span>
<span class="p">}</span>

<span class="p">}</span>  <span class="c1">// namespace foo</span>
</pre></div>
</div>
<p>Sometimes, this might not be an option: your team may consider it bad style to
have a <code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span></code> operator for <code class="docutils literal notranslate"><span class="pre">Bar</span></code>, or <code class="docutils literal notranslate"><span class="pre">Bar</span></code> may already have a <code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span></code> operator that
doesn’t do what you want (and you cannot change it). If so, you can instead
define a <code class="docutils literal notranslate"><span class="pre">PrintTo()</span></code> function like this:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ostream&gt;</span><span class="cp"></span>

<span class="k">namespace</span> <span class="n">foo</span> <span class="p">{</span>

<span class="k">class</span> <span class="nc">Bar</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="k">friend</span> <span class="kt">void</span> <span class="n">PrintTo</span><span class="p">(</span><span class="k">const</span> <span class="n">Bar</span><span class="o">&amp;</span> <span class="n">bar</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">*</span> <span class="n">os</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">*</span><span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="n">bar</span><span class="p">.</span><span class="n">DebugString</span><span class="p">();</span>  <span class="c1">// whatever needed to print bar to os</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// If you can&#39;t declare the function in the class it&#39;s important that PrintTo()</span>
<span class="c1">// is defined in the SAME namespace that defines Bar.  C++&#39;s look-up rules rely</span>
<span class="c1">// on that.</span>
<span class="kt">void</span> <span class="nf">PrintTo</span><span class="p">(</span><span class="k">const</span> <span class="n">Bar</span><span class="o">&amp;</span> <span class="n">bar</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">*</span> <span class="n">os</span><span class="p">)</span> <span class="p">{</span>
  <span class="o">*</span><span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="n">bar</span><span class="p">.</span><span class="n">DebugString</span><span class="p">();</span>  <span class="c1">// whatever needed to print bar to os</span>
<span class="p">}</span>

<span class="p">}</span>  <span class="c1">// namespace foo</span>
</pre></div>
</div>
<p>If you have defined both <code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span></code> and <code class="docutils literal notranslate"><span class="pre">PrintTo()</span></code>, the latter will be used when
googletest is concerned. This allows you to customize how the value appears in
googletest’s output without affecting code that relies on the behavior of its
<code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span></code> operator.</p>
<p>If you want to print a value <code class="docutils literal notranslate"><span class="pre">x</span></code> using googletest’s value printer yourself, just
call <code class="docutils literal notranslate"><span class="pre">::testing::PrintToString(x)</span></code>, which returns an <code class="docutils literal notranslate"><span class="pre">std::string</span></code>:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">vector</span><span class="o">&lt;</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">Bar</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">bar_ints</span> <span class="o">=</span> <span class="n">GetBarIntVector</span><span class="p">();</span>

<span class="n">EXPECT_TRUE</span><span class="p">(</span><span class="n">IsCorrectBarIntVector</span><span class="p">(</span><span class="n">bar_ints</span><span class="p">))</span>
    <span class="o">&lt;&lt;</span> <span class="s">&quot;bar_ints = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">testing</span><span class="o">::</span><span class="n">PrintToString</span><span class="p">(</span><span class="n">bar_ints</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="death-tests">
<h2>Death Tests<a class="headerlink" href="#death-tests" title="Permalink to this headline">¶</a></h2>
<p>In many applications, there are assertions that can cause application failure if
a condition is not met. These consistency checks, which ensure that the program
is in a known good state, are there to fail at the earliest possible time after
some program state is corrupted. If the assertion checks the wrong condition,
then the program may proceed in an erroneous state, which could lead to memory
corruption, security holes, or worse. Hence it is vitally important to test that
such assertion statements work as expected.</p>
<p>Since these precondition checks cause the processes to die, we call such tests
<em>death tests</em>. More generally, any test that checks that a program terminates
(except by throwing an exception) in an expected fashion is also a death test.</p>
<p>Note that if a piece of code throws an exception, we don’t consider it “death”
for the purpose of death tests, as the caller of the code could catch the
exception and avoid the crash. If you want to verify exceptions thrown by your
code, see <a class="reference external" href="#ExceptionAssertions">Exception Assertions</a>.</p>
<p>If you want to test <code class="docutils literal notranslate"><span class="pre">EXPECT_*()/ASSERT_*()</span></code> failures in your test code, see
<a class="reference external" href="#catching-failures">“Catching” Failures</a>.</p>
<div class="section" id="how-to-write-a-death-test">
<h3>How to Write a Death Test<a class="headerlink" href="#how-to-write-a-death-test" title="Permalink to this headline">¶</a></h3>
<p>GoogleTest provides assertion macros to support death tests. See
Death Assertions in the Assertions Reference
for details.</p>
<p>To write a death test, simply use one of the macros inside your test function.
For example,</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">TEST</span><span class="p">(</span><span class="n">MyDeathTest</span><span class="p">,</span> <span class="n">Foo</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// This death test uses a compound statement.</span>
  <span class="n">ASSERT_DEATH</span><span class="p">({</span>
    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="n">Foo</span><span class="p">(</span><span class="o">&amp;</span><span class="n">n</span><span class="p">);</span>
  <span class="p">},</span> <span class="s">&quot;Error on line .* of Foo()&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">TEST</span><span class="p">(</span><span class="n">MyDeathTest</span><span class="p">,</span> <span class="n">NormalExit</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">EXPECT_EXIT</span><span class="p">(</span><span class="n">NormalExit</span><span class="p">(),</span> <span class="n">testing</span><span class="o">::</span><span class="n">ExitedWithCode</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s">&quot;Success&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">TEST</span><span class="p">(</span><span class="n">MyDeathTest</span><span class="p">,</span> <span class="n">KillProcess</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">EXPECT_EXIT</span><span class="p">(</span><span class="n">KillProcess</span><span class="p">(),</span> <span class="n">testing</span><span class="o">::</span><span class="n">KilledBySignal</span><span class="p">(</span><span class="n">SIGKILL</span><span class="p">),</span>
              <span class="s">&quot;Sending myself unblockable signal&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>verifies that:</p>
<ul class="simple">
<li><p>calling <code class="docutils literal notranslate"><span class="pre">Foo(5)</span></code> causes the process to die with the given error message,</p></li>
<li><p>calling <code class="docutils literal notranslate"><span class="pre">NormalExit()</span></code> causes the process to print <code class="docutils literal notranslate"><span class="pre">&quot;Success&quot;</span></code> to stderr and
exit with exit code 0, and</p></li>
<li><p>calling <code class="docutils literal notranslate"><span class="pre">KillProcess()</span></code> kills the process with signal <code class="docutils literal notranslate"><span class="pre">SIGKILL</span></code>.</p></li>
</ul>
<p>The test function body may contain other assertions and statements as well, if
necessary.</p>
<p>Note that a death test only cares about three things:</p>
<ol class="simple">
<li><p>does <code class="docutils literal notranslate"><span class="pre">statement</span></code> abort or exit the process?</p></li>
<li><p>(in the case of <code class="docutils literal notranslate"><span class="pre">ASSERT_EXIT</span></code> and <code class="docutils literal notranslate"><span class="pre">EXPECT_EXIT</span></code>) does the exit status
satisfy <code class="docutils literal notranslate"><span class="pre">predicate</span></code>? Or (in the case of <code class="docutils literal notranslate"><span class="pre">ASSERT_DEATH</span></code> and <code class="docutils literal notranslate"><span class="pre">EXPECT_DEATH</span></code>)
is the exit status non-zero? And</p></li>
<li><p>does the stderr output match <code class="docutils literal notranslate"><span class="pre">matcher</span></code>?</p></li>
</ol>
<p>In particular, if <code class="docutils literal notranslate"><span class="pre">statement</span></code> generates an <code class="docutils literal notranslate"><span class="pre">ASSERT_*</span></code> or <code class="docutils literal notranslate"><span class="pre">EXPECT_*</span></code> failure, it
will <strong>not</strong> cause the death test to fail, as googletest assertions don’t abort
the process.</p>
</div>
<div class="section" id="death-test-naming">
<h3>Death Test Naming<a class="headerlink" href="#death-test-naming" title="Permalink to this headline">¶</a></h3>
<p>{: .callout .important}
IMPORTANT: We strongly recommend you to follow the convention of naming your
<strong>test suite</strong> (not test) <code class="docutils literal notranslate"><span class="pre">*DeathTest</span></code> when it contains a death test, as
demonstrated in the above example. The
<a class="reference external" href="#death-tests-and-threads">Death Tests And Threads</a> section below explains why.</p>
<p>If a test fixture class is shared by normal tests and death tests, you can use
<code class="docutils literal notranslate"><span class="pre">using</span></code> or <code class="docutils literal notranslate"><span class="pre">typedef</span></code> to introduce an alias for the fixture class and avoid
duplicating its code:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FooTest</span> <span class="o">:</span> <span class="k">public</span> <span class="n">testing</span><span class="o">::</span><span class="n">Test</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>

<span class="k">using</span> <span class="n">FooDeathTest</span> <span class="o">=</span> <span class="n">FooTest</span><span class="p">;</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">DoesThis</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// normal test</span>
<span class="p">}</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">FooDeathTest</span><span class="p">,</span> <span class="n">DoesThat</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// death test</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="regular-expression-syntax">
<h3>Regular Expression Syntax<a class="headerlink" href="#regular-expression-syntax" title="Permalink to this headline">¶</a></h3>
<p>On POSIX systems (e.g. Linux, Cygwin, and Mac), googletest uses the
<a class="reference external" href="http://www.opengroup.org/onlinepubs/009695399/basedefs/xbd_chap09.html#tag_09_04">POSIX extended regular expression</a>
syntax. To learn about this syntax, you may want to read this
<a class="reference external" href="http://en.wikipedia.org/wiki/Regular_expression#POSIX_Extended_Regular_Expressions">Wikipedia entry</a>.</p>
<p>On Windows, googletest uses its own simple regular expression implementation. It
lacks many features. For example, we don’t support union (<code class="docutils literal notranslate"><span class="pre">&quot;x|y&quot;</span></code>), grouping
(<code class="docutils literal notranslate"><span class="pre">&quot;(xy)&quot;</span></code>), brackets (<code class="docutils literal notranslate"><span class="pre">&quot;[xy]&quot;</span></code>), and repetition count (<code class="docutils literal notranslate"><span class="pre">&quot;x{5,7}&quot;</span></code>), among
others. Below is what we do support (<code class="docutils literal notranslate"><span class="pre">A</span></code> denotes a literal character, period
(<code class="docutils literal notranslate"><span class="pre">.</span></code>), or a single <code class="docutils literal notranslate"><span class="pre">\\</span> </code> escape sequence; <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> denote regular
expressions.):</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Expression</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>c</code></td>
<td>matches any literal character <code>c</code></td>
</tr>
<tr>
<td><code>\\d</code></td>
<td>matches any decimal digit</td>
</tr>
<tr>
<td><code>\\D</code></td>
<td>matches any character that's not a decimal digit</td>
</tr>
<tr>
<td><code>\\f</code></td>
<td>matches <code>\f</code></td>
</tr>
<tr>
<td><code>\\n</code></td>
<td>matches <code>\n</code></td>
</tr>
<tr>
<td><code>\\r</code></td>
<td>matches <code>\r</code></td>
</tr>
<tr>
<td><code>\\s</code></td>
<td>matches any ASCII whitespace, including <code>\n</code></td>
</tr>
<tr>
<td><code>\\S</code></td>
<td>matches any character that's not a whitespace</td>
</tr>
<tr>
<td><code>\\t</code></td>
<td>matches <code>\t</code></td>
</tr>
<tr>
<td><code>\\v</code></td>
<td>matches <code>\v</code></td>
</tr>
<tr>
<td><code>\\w</code></td>
<td>matches any letter, <code>_</code>, or decimal digit</td>
</tr>
<tr>
<td><code>\\W</code></td>
<td>matches any character that <code>\\w</code> doesn't match</td>
</tr>
<tr>
<td><code>\\c</code></td>
<td>matches any literal character <code>c</code>, which must be a punctuation</td>
</tr>
<tr>
<td><code>.</code></td>
<td>matches any single character except <code>\n</code></td>
</tr>
<tr>
<td><code>A?</code></td>
<td>matches 0 or 1 occurrences of <code>A</code></td>
</tr>
<tr>
<td><code>A*</code></td>
<td>matches 0 or many occurrences of <code>A</code></td>
</tr>
<tr>
<td><code>A+</code></td>
<td>matches 1 or many occurrences of <code>A</code></td>
</tr>
<tr>
<td><code>^</code></td>
<td>matches the beginning of a string (not that of each line)</td>
</tr>
<tr>
<td><code>$</code></td>
<td>matches the end of a string (not that of each line)</td>
</tr>
<tr>
<td><code>xy</code></td>
<td>matches <code>x</code> followed by <code>y</code></td>
</tr>
</tbody>
</table><p>To help you determine which capability is available on your system, googletest
defines macros to govern which regular expression it is using. The macros are:
<code class="docutils literal notranslate"><span class="pre">GTEST_USES_SIMPLE_RE=1</span></code> or <code class="docutils literal notranslate"><span class="pre">GTEST_USES_POSIX_RE=1</span></code>. If you want your death
tests to work in all cases, you can either <code class="docutils literal notranslate"><span class="pre">#if</span></code> on these macros or use the more
limited syntax only.</p>
</div>
<div class="section" id="how-it-works">
<h3>How It Works<a class="headerlink" href="#how-it-works" title="Permalink to this headline">¶</a></h3>
<p>See Death Assertions in the Assertions
Reference.</p>
</div>
<div class="section" id="death-tests-and-threads">
<h3>Death Tests And Threads<a class="headerlink" href="#death-tests-and-threads" title="Permalink to this headline">¶</a></h3>
<p>The reason for the two death test styles has to do with thread safety. Due to
well-known problems with forking in the presence of threads, death tests should
be run in a single-threaded context. Sometimes, however, it isn’t feasible to
arrange that kind of environment. For example, statically-initialized modules
may start threads before main is ever reached. Once threads have been created,
it may be difficult or impossible to clean them up.</p>
<p>googletest has three features intended to raise awareness of threading issues.</p>
<ol class="simple">
<li><p>A warning is emitted if multiple threads are running when a death test is
encountered.</p></li>
<li><p>Test suites with a name ending in “DeathTest” are run before all other
tests.</p></li>
<li><p>It uses <code class="docutils literal notranslate"><span class="pre">clone()</span></code> instead of <code class="docutils literal notranslate"><span class="pre">fork()</span></code> to spawn the child process on Linux
(<code class="docutils literal notranslate"><span class="pre">clone()</span></code> is not available on Cygwin and Mac), as <code class="docutils literal notranslate"><span class="pre">fork()</span></code> is more likely
to cause the child to hang when the parent process has multiple threads.</p></li>
</ol>
<p>It’s perfectly fine to create threads inside a death test statement; they are
executed in a separate process and cannot affect the parent.</p>
</div>
<div class="section" id="death-test-styles">
<h3>Death Test Styles<a class="headerlink" href="#death-test-styles" title="Permalink to this headline">¶</a></h3>
<p>The “threadsafe” death test style was introduced in order to help mitigate the
risks of testing in a possibly multithreaded environment. It trades increased
test execution time (potentially dramatically so) for improved thread safety.</p>
<p>The automated testing framework does not set the style flag. You can choose a
particular style of death tests by setting the flag programmatically:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">GTEST_FLAG_SET</span><span class="p">(</span><span class="n">death_test_style</span><span class="p">,</span> <span class="s">&quot;threadsafe&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can do this in <code class="docutils literal notranslate"><span class="pre">main()</span></code> to set the style for all death tests in the binary,
or in individual tests. Recall that flags are saved before running each test and
restored afterwards, so you need not do that yourself. For example:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">testing</span><span class="o">::</span><span class="n">InitGoogleTest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
  <span class="n">GTEST_FLAG_SET</span><span class="p">(</span><span class="n">death_test_style</span><span class="p">,</span> <span class="s">&quot;fast&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">RUN_ALL_TESTS</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">TEST</span><span class="p">(</span><span class="n">MyDeathTest</span><span class="p">,</span> <span class="n">TestOne</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">GTEST_FLAG_SET</span><span class="p">(</span><span class="n">death_test_style</span><span class="p">,</span> <span class="s">&quot;threadsafe&quot;</span><span class="p">);</span>
  <span class="c1">// This test is run in the &quot;threadsafe&quot; style:</span>
  <span class="n">ASSERT_DEATH</span><span class="p">(</span><span class="n">ThisShouldDie</span><span class="p">(),</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">TEST</span><span class="p">(</span><span class="n">MyDeathTest</span><span class="p">,</span> <span class="n">TestTwo</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// This test is run in the &quot;fast&quot; style:</span>
  <span class="n">ASSERT_DEATH</span><span class="p">(</span><span class="n">ThisShouldDie</span><span class="p">(),</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="caveats">
<h3>Caveats<a class="headerlink" href="#caveats" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">statement</span></code> argument of <code class="docutils literal notranslate"><span class="pre">ASSERT_EXIT()</span></code> can be any valid C++ statement. If
it leaves the current function via a <code class="docutils literal notranslate"><span class="pre">return</span></code> statement or by throwing an
exception, the death test is considered to have failed. Some googletest macros
may return from the current function (e.g. <code class="docutils literal notranslate"><span class="pre">ASSERT_TRUE()</span></code>), so be sure to avoid
them in <code class="docutils literal notranslate"><span class="pre">statement</span></code>.</p>
<p>Since <code class="docutils literal notranslate"><span class="pre">statement</span></code> runs in the child process, any in-memory side effect (e.g.
modifying a variable, releasing memory, etc) it causes will <em>not</em> be observable
in the parent process. In particular, if you release memory in a death test,
your program will fail the heap check as the parent process will never see the
memory reclaimed. To solve this problem, you can</p>
<ol class="simple">
<li><p>try not to free memory in a death test;</p></li>
<li><p>free the memory again in the parent process; or</p></li>
<li><p>do not use the heap checker in your program.</p></li>
</ol>
<p>Due to an implementation detail, you cannot place multiple death test assertions
on the same line; otherwise, compilation will fail with an unobvious error
message.</p>
<p>Despite the improved thread safety afforded by the “threadsafe” style of death
test, thread problems such as deadlock are still possible in the presence of
handlers registered with <code class="docutils literal notranslate"><span class="pre">pthread_atfork(3)</span></code>.</p>
</div>
</div>
<div class="section" id="using-assertions-in-sub-routines">
<h2>Using Assertions in Sub-routines<a class="headerlink" href="#using-assertions-in-sub-routines" title="Permalink to this headline">¶</a></h2>
<p>{: .callout .note}
Note: If you want to put a series of test assertions in a subroutine to check
for a complex condition, consider using
a custom GMock matcher instead. This lets you
provide a more readable error message in case of failure and avoid all of the
issues described below.</p>
<div class="section" id="adding-traces-to-assertions">
<h3>Adding Traces to Assertions<a class="headerlink" href="#adding-traces-to-assertions" title="Permalink to this headline">¶</a></h3>
<p>If a test sub-routine is called from several places, when an assertion inside it
fails, it can be hard to tell which invocation of the sub-routine the failure is
from. You can alleviate this problem using extra logging or custom failure
messages, but that usually clutters up your tests. A better solution is to use
the <code class="docutils literal notranslate"><span class="pre">SCOPED_TRACE</span></code> macro or the <code class="docutils literal notranslate"><span class="pre">ScopedTrace</span></code> utility:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">SCOPED_TRACE</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">ScopedTrace</span> <span class="nf">trace</span><span class="p">(</span><span class="s">&quot;file_path&quot;</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">message</span><span class="p">);</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">message</span></code> can be anything streamable to <code class="docutils literal notranslate"><span class="pre">std::ostream</span></code>. <code class="docutils literal notranslate"><span class="pre">SCOPED_TRACE</span></code>
macro will cause the current file name, line number, and the given message to be
added in every failure message. <code class="docutils literal notranslate"><span class="pre">ScopedTrace</span></code> accepts explicit file name and
line number in arguments, which is useful for writing test helpers. The effect
will be undone when the control leaves the current lexical scope.</p>
<p>For example,</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="mi">10</span><span class="o">:</span> <span class="kt">void</span> <span class="n">Sub1</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
<span class="mi">11</span><span class="o">:</span>   <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">Bar</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
<span class="mi">12</span><span class="o">:</span>   <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">Bar</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">2</span><span class="p">);</span>
<span class="mi">13</span><span class="o">:</span> <span class="p">}</span>
<span class="mi">14</span><span class="o">:</span>
<span class="mi">15</span><span class="o">:</span> <span class="n">TEST</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Bar</span><span class="p">)</span> <span class="p">{</span>
<span class="mi">16</span><span class="o">:</span>   <span class="p">{</span>
<span class="mi">17</span><span class="o">:</span>     <span class="n">SCOPED_TRACE</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">);</span>  <span class="c1">// This trace point will be included in</span>
<span class="mi">18</span><span class="o">:</span>                         <span class="c1">// every failure in this scope.</span>
<span class="mi">19</span><span class="o">:</span>     <span class="n">Sub1</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="mi">20</span><span class="o">:</span>   <span class="p">}</span>
<span class="mi">21</span><span class="o">:</span>   <span class="c1">// Now it won&#39;t.</span>
<span class="mi">22</span><span class="o">:</span>   <span class="n">Sub1</span><span class="p">(</span><span class="mi">9</span><span class="p">);</span>
<span class="mi">23</span><span class="o">:</span> <span class="p">}</span>
</pre></div>
</div>
<p>could result in messages like these:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>path/to/foo_test.cc:11: Failure
Value of: Bar(n)
Expected: 1
  Actual: 2
Google Test trace:
path/to/foo_test.cc:17: A

path/to/foo_test.cc:12: Failure
Value of: Bar(n + 1)
Expected: 2
  Actual: 3
</pre></div>
</div>
<p>Without the trace, it would’ve been difficult to know which invocation of
<code class="docutils literal notranslate"><span class="pre">Sub1()</span></code> the two failures come from respectively. (You could add an extra
message to each assertion in <code class="docutils literal notranslate"><span class="pre">Sub1()</span></code> to indicate the value of <code class="docutils literal notranslate"><span class="pre">n</span></code>, but that’s
tedious.)</p>
<p>Some tips on using <code class="docutils literal notranslate"><span class="pre">SCOPED_TRACE</span></code>:</p>
<ol class="simple">
<li><p>With a suitable message, it’s often enough to use <code class="docutils literal notranslate"><span class="pre">SCOPED_TRACE</span></code> at the
beginning of a sub-routine, instead of at each call site.</p></li>
<li><p>When calling sub-routines inside a loop, make the loop iterator part of the
message in <code class="docutils literal notranslate"><span class="pre">SCOPED_TRACE</span></code> such that you can know which iteration the failure
is from.</p></li>
<li><p>Sometimes the line number of the trace point is enough for identifying the
particular invocation of a sub-routine. In this case, you don’t have to
choose a unique message for <code class="docutils literal notranslate"><span class="pre">SCOPED_TRACE</span></code>. You can simply use <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>.</p></li>
<li><p>You can use <code class="docutils literal notranslate"><span class="pre">SCOPED_TRACE</span></code> in an inner scope when there is one in the outer
scope. In this case, all active trace points will be included in the failure
messages, in reverse order they are encountered.</p></li>
<li><p>The trace dump is clickable in Emacs - hit <code class="docutils literal notranslate"><span class="pre">return</span></code> on a line number and
you’ll be taken to that line in the source file!</p></li>
</ol>
</div>
<div class="section" id="propagating-fatal-failures">
<h3>Propagating Fatal Failures<a class="headerlink" href="#propagating-fatal-failures" title="Permalink to this headline">¶</a></h3>
<p>A common pitfall when using <code class="docutils literal notranslate"><span class="pre">ASSERT_*</span></code> and <code class="docutils literal notranslate"><span class="pre">FAIL*</span></code> is not understanding that
when they fail they only abort the <em>current function</em>, not the entire test. For
example, the following test will segfault:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">Subroutine</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Generates a fatal failure and aborts the current function.</span>
  <span class="n">ASSERT_EQ</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

  <span class="c1">// The following won&#39;t be executed.</span>
  <span class="p">...</span>
<span class="p">}</span>

<span class="n">TEST</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Bar</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">Subroutine</span><span class="p">();</span>  <span class="c1">// The intended behavior is for the fatal failure</span>
                 <span class="c1">// in Subroutine() to abort the entire test.</span>

  <span class="c1">// The actual behavior: the function goes on after Subroutine() returns.</span>
  <span class="kt">int</span><span class="o">*</span> <span class="n">p</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
  <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>  <span class="c1">// Segfault!</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To alleviate this, googletest provides three different solutions. You could use
either exceptions, the <code class="docutils literal notranslate"><span class="pre">(ASSERT|EXPECT)_NO_FATAL_FAILURE</span></code> assertions or the
<code class="docutils literal notranslate"><span class="pre">HasFatalFailure()</span></code> function. They are described in the following two
subsections.</p>
<div class="section" id="asserting-on-subroutines-with-an-exception">
<h4>Asserting on Subroutines with an exception<a class="headerlink" href="#asserting-on-subroutines-with-an-exception" title="Permalink to this headline">¶</a></h4>
<p>The following code can turn ASSERT-failure into an exception:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ThrowListener</span> <span class="o">:</span> <span class="k">public</span> <span class="n">testing</span><span class="o">::</span><span class="n">EmptyTestEventListener</span> <span class="p">{</span>
  <span class="kt">void</span> <span class="n">OnTestPartResult</span><span class="p">(</span><span class="k">const</span> <span class="n">testing</span><span class="o">::</span><span class="n">TestPartResult</span><span class="o">&amp;</span> <span class="n">result</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="n">testing</span><span class="o">::</span><span class="n">TestPartResult</span><span class="o">::</span><span class="n">kFatalFailure</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="n">testing</span><span class="o">::</span><span class="n">AssertionException</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="n">testing</span><span class="o">::</span><span class="n">UnitTest</span><span class="o">::</span><span class="n">GetInstance</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">listeners</span><span class="p">().</span><span class="n">Append</span><span class="p">(</span><span class="k">new</span> <span class="n">ThrowListener</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">RUN_ALL_TESTS</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This listener should be added after other listeners if you have any, otherwise
they won’t see failed <code class="docutils literal notranslate"><span class="pre">OnTestPartResult</span></code>.</p>
</div>
<div class="section" id="asserting-on-subroutines">
<h4>Asserting on Subroutines<a class="headerlink" href="#asserting-on-subroutines" title="Permalink to this headline">¶</a></h4>
<p>As shown above, if your test calls a subroutine that has an <code class="docutils literal notranslate"><span class="pre">ASSERT_*</span></code> failure
in it, the test will continue after the subroutine returns. This may not be what
you want.</p>
<p>Often people want fatal failures to propagate like exceptions. For that
googletest offers the following macros:</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Fatal assertion</th>
<th>Nonfatal assertion</th>
<th>Verifies</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ASSERT_NO_FATAL_FAILURE(statement);</code></td>
<td><code>EXPECT_NO_FATAL_FAILURE(statement);</code></td>
<td><code>statement</code> doesn't generate any new fatal failures in the current thread.</td>
</tr>
</tbody>
</table><p>Only failures in the thread that executes the assertion are checked to determine
the result of this type of assertions. If <code class="docutils literal notranslate"><span class="pre">statement</span></code> creates new threads,
failures in these threads are ignored.</p>
<p>Examples:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">ASSERT_NO_FATAL_FAILURE</span><span class="p">(</span><span class="n">Foo</span><span class="p">());</span>

<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<span class="n">EXPECT_NO_FATAL_FAILURE</span><span class="p">({</span>
  <span class="n">i</span> <span class="o">=</span> <span class="n">Bar</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Assertions from multiple threads are currently not supported on Windows.</p>
</div>
<div class="section" id="checking-for-failures-in-the-current-test">
<h4>Checking for Failures in the Current Test<a class="headerlink" href="#checking-for-failures-in-the-current-test" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">HasFatalFailure()</span></code> in the <code class="docutils literal notranslate"><span class="pre">::testing::Test</span></code> class returns <code class="docutils literal notranslate"><span class="pre">true</span></code> if an
assertion in the current test has suffered a fatal failure. This allows
functions to catch fatal failures in a sub-routine and return early.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Test</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="p">...</span>
  <span class="k">static</span> <span class="kt">bool</span> <span class="n">HasFatalFailure</span><span class="p">();</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The typical usage, which basically simulates the behavior of a thrown exception,
is:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">TEST</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Bar</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">Subroutine</span><span class="p">();</span>
  <span class="c1">// Aborts if Subroutine() had a fatal failure.</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">HasFatalFailure</span><span class="p">())</span> <span class="k">return</span><span class="p">;</span>

  <span class="c1">// The following won&#39;t be executed.</span>
  <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">HasFatalFailure()</span></code> is used outside of <code class="docutils literal notranslate"><span class="pre">TEST()</span></code> , <code class="docutils literal notranslate"><span class="pre">TEST_F()</span></code> , or a test
fixture, you must add the <code class="docutils literal notranslate"><span class="pre">::testing::Test::</span></code> prefix, as in:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">testing</span><span class="o">::</span><span class="n">Test</span><span class="o">::</span><span class="n">HasFatalFailure</span><span class="p">())</span> <span class="k">return</span><span class="p">;</span>
</pre></div>
</div>
<p>Similarly, <code class="docutils literal notranslate"><span class="pre">HasNonfatalFailure()</span></code> returns <code class="docutils literal notranslate"><span class="pre">true</span></code> if the current test has at
least one non-fatal failure, and <code class="docutils literal notranslate"><span class="pre">HasFailure()</span></code> returns <code class="docutils literal notranslate"><span class="pre">true</span></code> if the current
test has at least one failure of either kind.</p>
</div>
</div>
</div>
<div class="section" id="logging-additional-information">
<h2>Logging Additional Information<a class="headerlink" href="#logging-additional-information" title="Permalink to this headline">¶</a></h2>
<p>In your test code, you can call <code class="docutils literal notranslate"><span class="pre">RecordProperty(&quot;key&quot;,</span> <span class="pre">value)</span></code> to log additional
information, where <code class="docutils literal notranslate"><span class="pre">value</span></code> can be either a string or an <code class="docutils literal notranslate"><span class="pre">int</span></code>. The <em>last</em> value
recorded for a key will be emitted to the
<a class="reference external" href="#generating-an-xml-report">XML output</a> if you specify one. For example, the
test</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">TEST_F</span><span class="p">(</span><span class="n">WidgetUsageTest</span><span class="p">,</span> <span class="n">MinAndMaxWidgets</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">RecordProperty</span><span class="p">(</span><span class="s">&quot;MaximumWidgets&quot;</span><span class="p">,</span> <span class="n">ComputeMaxUsage</span><span class="p">());</span>
  <span class="n">RecordProperty</span><span class="p">(</span><span class="s">&quot;MinimumWidgets&quot;</span><span class="p">,</span> <span class="n">ComputeMinUsage</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
<p>will output XML like this:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span>  ...
    <span class="nt">&lt;testcase</span> <span class="na">name=</span><span class="s">&quot;MinAndMaxWidgets&quot;</span> <span class="na">status=</span><span class="s">&quot;run&quot;</span> <span class="na">time=</span><span class="s">&quot;0.006&quot;</span> <span class="na">classname=</span><span class="s">&quot;WidgetUsageTest&quot;</span> <span class="na">MaximumWidgets=</span><span class="s">&quot;12&quot;</span> <span class="na">MinimumWidgets=</span><span class="s">&quot;9&quot;</span> <span class="nt">/&gt;</span>
  ...
</pre></div>
</div>
<p>{: .callout .note}</p>
<blockquote>
<div><p>NOTE:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RecordProperty()</span></code> is a static member of the <code class="docutils literal notranslate"><span class="pre">Test</span></code> class. Therefore it
needs to be prefixed with <code class="docutils literal notranslate"><span class="pre">::testing::Test::</span></code> if used outside of the
<code class="docutils literal notranslate"><span class="pre">TEST</span></code> body and the test fixture class.</p></li>
<li><p><em><code class="docutils literal notranslate"><span class="pre">key</span></code></em> must be a valid XML attribute name, and cannot conflict with the
ones already used by googletest (<code class="docutils literal notranslate"><span class="pre">name</span></code>, <code class="docutils literal notranslate"><span class="pre">status</span></code>, <code class="docutils literal notranslate"><span class="pre">time</span></code>, <code class="docutils literal notranslate"><span class="pre">classname</span></code>,
<code class="docutils literal notranslate"><span class="pre">type_param</span></code>, and <code class="docutils literal notranslate"><span class="pre">value_param</span></code>).</p></li>
<li><p>Calling <code class="docutils literal notranslate"><span class="pre">RecordProperty()</span></code> outside of the lifespan of a test is allowed.
If it’s called outside of a test but between a test suite’s
<code class="docutils literal notranslate"><span class="pre">SetUpTestSuite()</span></code> and <code class="docutils literal notranslate"><span class="pre">TearDownTestSuite()</span></code> methods, it will be
attributed to the XML element for the test suite. If it’s called outside
of all test suites (e.g. in a test environment), it will be attributed to
the top-level XML element.</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="sharing-resources-between-tests-in-the-same-test-suite">
<h2>Sharing Resources Between Tests in the Same Test Suite<a class="headerlink" href="#sharing-resources-between-tests-in-the-same-test-suite" title="Permalink to this headline">¶</a></h2>
<p>googletest creates a new test fixture object for each test in order to make
tests independent and easier to debug. However, sometimes tests use resources
that are expensive to set up, making the one-copy-per-test model prohibitively
expensive.</p>
<p>If the tests don’t change the resource, there’s no harm in their sharing a
single resource copy. So, in addition to per-test set-up/tear-down, googletest
also supports per-test-suite set-up/tear-down. To use it:</p>
<ol class="simple">
<li><p>In your test fixture class (say <code class="docutils literal notranslate"><span class="pre">FooTest</span></code> ), declare as <code class="docutils literal notranslate"><span class="pre">static</span></code> some member
variables to hold the shared resources.</p></li>
<li><p>Outside your test fixture class (typically just below it), define those
member variables, optionally giving them initial values.</p></li>
<li><p>In the same test fixture class, define a <code class="docutils literal notranslate"><span class="pre">static</span> <span class="pre">void</span> <span class="pre">SetUpTestSuite()</span></code>
function (remember not to spell it as <strong><code class="docutils literal notranslate"><span class="pre">SetupTestSuite</span></code></strong> with a small
<code class="docutils literal notranslate"><span class="pre">u</span></code>!) to set up the shared resources and a <code class="docutils literal notranslate"><span class="pre">static</span> <span class="pre">void</span> <span class="pre">TearDownTestSuite()</span></code>
function to tear them down.</p></li>
</ol>
<p>That’s it! googletest automatically calls <code class="docutils literal notranslate"><span class="pre">SetUpTestSuite()</span></code> before running the
<em>first test</em> in the <code class="docutils literal notranslate"><span class="pre">FooTest</span></code> test suite (i.e. before creating the first
<code class="docutils literal notranslate"><span class="pre">FooTest</span></code> object), and calls <code class="docutils literal notranslate"><span class="pre">TearDownTestSuite()</span></code> after running the <em>last test</em>
in it (i.e. after deleting the last <code class="docutils literal notranslate"><span class="pre">FooTest</span></code> object). In between, the tests can
use the shared resources.</p>
<p>Remember that the test order is undefined, so your code can’t depend on a test
preceding or following another. Also, the tests must either not modify the state
of any shared resource, or, if they do modify the state, they must restore the
state to its original value before passing control to the next test.</p>
<p>Note that <code class="docutils literal notranslate"><span class="pre">SetUpTestSuite()</span></code> may be called multiple times for a test fixture
class that has derived classes, so you should not expect code in the function
body to be run only once. Also, derived classes still have access to shared
resources defined as static members, so careful consideration is needed when
managing shared resources to avoid memory leaks.</p>
<p>Here’s an example of per-test-suite set-up and tear-down:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FooTest</span> <span class="o">:</span> <span class="k">public</span> <span class="n">testing</span><span class="o">::</span><span class="n">Test</span> <span class="p">{</span>
 <span class="k">protected</span><span class="o">:</span>
  <span class="c1">// Per-test-suite set-up.</span>
  <span class="c1">// Called before the first test in this test suite.</span>
  <span class="c1">// Can be omitted if not needed.</span>
  <span class="k">static</span> <span class="kt">void</span> <span class="n">SetUpTestSuite</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Avoid reallocating static objects if called in subclasses of FooTest.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">shared_resource_</span> <span class="o">==</span> <span class="k">nullptr</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">shared_resource_</span> <span class="o">=</span> <span class="k">new</span> <span class="p">...;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// Per-test-suite tear-down.</span>
  <span class="c1">// Called after the last test in this test suite.</span>
  <span class="c1">// Can be omitted if not needed.</span>
  <span class="k">static</span> <span class="kt">void</span> <span class="n">TearDownTestSuite</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">delete</span> <span class="n">shared_resource_</span><span class="p">;</span>
    <span class="n">shared_resource_</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// You can define per-test set-up logic as usual.</span>
  <span class="kt">void</span> <span class="n">SetUp</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

  <span class="c1">// You can define per-test tear-down logic as usual.</span>
  <span class="kt">void</span> <span class="n">TearDown</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

  <span class="c1">// Some expensive resource shared by all tests.</span>
  <span class="k">static</span> <span class="n">T</span><span class="o">*</span> <span class="n">shared_resource_</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">T</span><span class="o">*</span> <span class="n">FooTest</span><span class="o">::</span><span class="n">shared_resource_</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Test1</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">...</span> <span class="n">you</span> <span class="n">can</span> <span class="n">refer</span> <span class="n">to</span> <span class="n">shared_resource_</span> <span class="n">here</span> <span class="p">...</span>
<span class="p">}</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Test2</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">...</span> <span class="n">you</span> <span class="n">can</span> <span class="n">refer</span> <span class="n">to</span> <span class="n">shared_resource_</span> <span class="n">here</span> <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>{: .callout .note}
NOTE: Though the above code declares <code class="docutils literal notranslate"><span class="pre">SetUpTestSuite()</span></code> protected, it may
sometimes be necessary to declare it public, such as when using it with
<code class="docutils literal notranslate"><span class="pre">TEST_P</span></code>.</p>
</div>
<div class="section" id="global-set-up-and-tear-down">
<h2>Global Set-Up and Tear-Down<a class="headerlink" href="#global-set-up-and-tear-down" title="Permalink to this headline">¶</a></h2>
<p>Just as you can do set-up and tear-down at the test level and the test suite
level, you can also do it at the test program level. Here’s how.</p>
<p>First, you subclass the <code class="docutils literal notranslate"><span class="pre">::testing::Environment</span></code> class to define a test
environment, which knows how to set-up and tear-down:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Environment</span> <span class="o">:</span> <span class="k">public</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Environment</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="o">~</span><span class="n">Environment</span><span class="p">()</span> <span class="k">override</span> <span class="p">{}</span>

  <span class="c1">// Override this to define how to set up the environment.</span>
  <span class="kt">void</span> <span class="n">SetUp</span><span class="p">()</span> <span class="k">override</span> <span class="p">{}</span>

  <span class="c1">// Override this to define how to tear down the environment.</span>
  <span class="kt">void</span> <span class="n">TearDown</span><span class="p">()</span> <span class="k">override</span> <span class="p">{}</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Then, you register an instance of your environment class with googletest by
calling the <code class="docutils literal notranslate"><span class="pre">::testing::AddGlobalTestEnvironment()</span></code> function:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">Environment</span><span class="o">*</span> <span class="nf">AddGlobalTestEnvironment</span><span class="p">(</span><span class="n">Environment</span><span class="o">*</span> <span class="n">env</span><span class="p">);</span>
</pre></div>
</div>
<p>Now, when <code class="docutils literal notranslate"><span class="pre">RUN_ALL_TESTS()</span></code> is called, it first calls the <code class="docutils literal notranslate"><span class="pre">SetUp()</span></code> method of
each environment object, then runs the tests if none of the environments
reported fatal failures and <code class="docutils literal notranslate"><span class="pre">GTEST_SKIP()</span></code> was not called. <code class="docutils literal notranslate"><span class="pre">RUN_ALL_TESTS()</span></code>
always calls <code class="docutils literal notranslate"><span class="pre">TearDown()</span></code> with each environment object, regardless of whether or
not the tests were run.</p>
<p>It’s OK to register multiple environment objects. In this suite, their <code class="docutils literal notranslate"><span class="pre">SetUp()</span></code>
will be called in the order they are registered, and their <code class="docutils literal notranslate"><span class="pre">TearDown()</span></code> will be
called in the reverse order.</p>
<p>Note that googletest takes ownership of the registered environment objects.
Therefore <strong>do not delete them</strong> by yourself.</p>
<p>You should call <code class="docutils literal notranslate"><span class="pre">AddGlobalTestEnvironment()</span></code> before <code class="docutils literal notranslate"><span class="pre">RUN_ALL_TESTS()</span></code> is called,
probably in <code class="docutils literal notranslate"><span class="pre">main()</span></code>. If you use <code class="docutils literal notranslate"><span class="pre">gtest_main</span></code>, you need to call this before
<code class="docutils literal notranslate"><span class="pre">main()</span></code> starts for it to take effect. One way to do this is to define a global
variable like this:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">testing</span><span class="o">::</span><span class="n">Environment</span><span class="o">*</span> <span class="k">const</span> <span class="n">foo_env</span> <span class="o">=</span>
    <span class="n">testing</span><span class="o">::</span><span class="n">AddGlobalTestEnvironment</span><span class="p">(</span><span class="k">new</span> <span class="n">FooEnvironment</span><span class="p">);</span>
</pre></div>
</div>
<p>However, we strongly recommend you to write your own <code class="docutils literal notranslate"><span class="pre">main()</span></code> and call
<code class="docutils literal notranslate"><span class="pre">AddGlobalTestEnvironment()</span></code> there, as relying on initialization of global
variables makes the code harder to read and may cause problems when you register
multiple environments from different translation units and the environments have
dependencies among them (remember that the compiler doesn’t guarantee the order
in which global variables from different translation units are initialized).</p>
</div>
<div class="section" id="value-parameterized-tests">
<h2>Value-Parameterized Tests<a class="headerlink" href="#value-parameterized-tests" title="Permalink to this headline">¶</a></h2>
<p><em>Value-parameterized tests</em> allow you to test your code with different
parameters without writing multiple copies of the same test. This is useful in a
number of situations, for example:</p>
<ul class="simple">
<li><p>You have a piece of code whose behavior is affected by one or more
command-line flags. You want to make sure your code performs correctly for
various values of those flags.</p></li>
<li><p>You want to test different implementations of an OO interface.</p></li>
<li><p>You want to test your code over various inputs (a.k.a. data-driven testing).
This feature is easy to abuse, so please exercise your good sense when doing
it!</p></li>
</ul>
<div class="section" id="how-to-write-value-parameterized-tests">
<h3>How to Write Value-Parameterized Tests<a class="headerlink" href="#how-to-write-value-parameterized-tests" title="Permalink to this headline">¶</a></h3>
<p>To write value-parameterized tests, first you should define a fixture class. It
must be derived from both <code class="docutils literal notranslate"><span class="pre">testing::Test</span></code> and <code class="docutils literal notranslate"><span class="pre">testing::WithParamInterface&lt;T&gt;</span></code>
(the latter is a pure interface), where <code class="docutils literal notranslate"><span class="pre">T</span></code> is the type of your parameter
values. For convenience, you can just derive the fixture class from
<code class="docutils literal notranslate"><span class="pre">testing::TestWithParam&lt;T&gt;</span></code>, which itself is derived from both <code class="docutils literal notranslate"><span class="pre">testing::Test</span></code>
and <code class="docutils literal notranslate"><span class="pre">testing::WithParamInterface&lt;T&gt;</span></code>. <code class="docutils literal notranslate"><span class="pre">T</span></code> can be any copyable type. If it’s a
raw pointer, you are responsible for managing the lifespan of the pointed
values.</p>
<p>{: .callout .note}
NOTE: If your test fixture defines <code class="docutils literal notranslate"><span class="pre">SetUpTestSuite()</span></code> or <code class="docutils literal notranslate"><span class="pre">TearDownTestSuite()</span></code>
they must be declared <strong>public</strong> rather than <strong>protected</strong> in order to use
<code class="docutils literal notranslate"><span class="pre">TEST_P</span></code>.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FooTest</span> <span class="o">:</span>
    <span class="k">public</span> <span class="n">testing</span><span class="o">::</span><span class="n">TestWithParam</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">char</span><span class="o">*&gt;</span> <span class="p">{</span>
  <span class="c1">// You can implement all the usual fixture class members here.</span>
  <span class="c1">// To access the test parameter, call GetParam() from class</span>
  <span class="c1">// TestWithParam&lt;T&gt;.</span>
<span class="p">};</span>

<span class="c1">// Or, when you want to add parameters to a pre-existing fixture class:</span>
<span class="k">class</span> <span class="nc">BaseTest</span> <span class="o">:</span> <span class="k">public</span> <span class="n">testing</span><span class="o">::</span><span class="n">Test</span> <span class="p">{</span>
  <span class="p">...</span>
<span class="p">};</span>
<span class="k">class</span> <span class="nc">BarTest</span> <span class="o">:</span> <span class="k">public</span> <span class="n">BaseTest</span><span class="p">,</span>
                <span class="k">public</span> <span class="n">testing</span><span class="o">::</span><span class="n">WithParamInterface</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">char</span><span class="o">*&gt;</span> <span class="p">{</span>
  <span class="p">...</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Then, use the <code class="docutils literal notranslate"><span class="pre">TEST_P</span></code> macro to define as many test patterns using this fixture
as you want. The <code class="docutils literal notranslate"><span class="pre">_P</span></code> suffix is for “parameterized” or “pattern”, whichever you
prefer to think.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">TEST_P</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">DoesBlah</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Inside a test, access the test parameter with the GetParam() method</span>
  <span class="c1">// of the TestWithParam&lt;T&gt; class:</span>
  <span class="n">EXPECT_TRUE</span><span class="p">(</span><span class="n">foo</span><span class="p">.</span><span class="n">Blah</span><span class="p">(</span><span class="n">GetParam</span><span class="p">()));</span>
  <span class="p">...</span>
<span class="p">}</span>

<span class="n">TEST_P</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">HasBlahBlah</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Finally, you can use the <code class="docutils literal notranslate"><span class="pre">INSTANTIATE_TEST_SUITE_P</span></code> macro to instantiate the
test suite with any set of parameters you want. GoogleTest defines a number of
functions for generating test parameters—see details at
INSTANTIATE_TEST_SUITE_P in
the Testing Reference.</p>
<p>For example, the following statement will instantiate tests from the <code class="docutils literal notranslate"><span class="pre">FooTest</span></code>
test suite each with parameter values <code class="docutils literal notranslate"><span class="pre">&quot;meeny&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;miny&quot;</span></code>, and <code class="docutils literal notranslate"><span class="pre">&quot;moe&quot;</span></code> using the
Values parameter generator:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">INSTANTIATE_TEST_SUITE_P</span><span class="p">(</span><span class="n">MeenyMinyMoe</span><span class="p">,</span>
                         <span class="n">FooTest</span><span class="p">,</span>
                         <span class="n">testing</span><span class="o">::</span><span class="n">Values</span><span class="p">(</span><span class="s">&quot;meeny&quot;</span><span class="p">,</span> <span class="s">&quot;miny&quot;</span><span class="p">,</span> <span class="s">&quot;moe&quot;</span><span class="p">));</span>
</pre></div>
</div>
<p>{: .callout .note}
NOTE: The code above must be placed at global or namespace scope, not at
function scope.</p>
<p>The first argument to <code class="docutils literal notranslate"><span class="pre">INSTANTIATE_TEST_SUITE_P</span></code> is a unique name for the
instantiation of the test suite. The next argument is the name of the test
pattern, and the last is the
parameter generator.</p>
<p>You can instantiate a test pattern more than once, so to distinguish different
instances of the pattern, the instantiation name is added as a prefix to the
actual test suite name. Remember to pick unique prefixes for different
instantiations. The tests from the instantiation above will have these names:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MeenyMinyMoe/FooTest.DoesBlah/0</span></code> for <code class="docutils literal notranslate"><span class="pre">&quot;meeny&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MeenyMinyMoe/FooTest.DoesBlah/1</span></code> for <code class="docutils literal notranslate"><span class="pre">&quot;miny&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MeenyMinyMoe/FooTest.DoesBlah/2</span></code> for <code class="docutils literal notranslate"><span class="pre">&quot;moe&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MeenyMinyMoe/FooTest.HasBlahBlah/0</span></code> for <code class="docutils literal notranslate"><span class="pre">&quot;meeny&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MeenyMinyMoe/FooTest.HasBlahBlah/1</span></code> for <code class="docutils literal notranslate"><span class="pre">&quot;miny&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MeenyMinyMoe/FooTest.HasBlahBlah/2</span></code> for <code class="docutils literal notranslate"><span class="pre">&quot;moe&quot;</span></code></p></li>
</ul>
<p>You can use these names in <a class="reference external" href="#running-a-subset-of-the-tests"><code class="docutils literal notranslate"><span class="pre">--gtest_filter</span></code></a>.</p>
<p>The following statement will instantiate all tests from <code class="docutils literal notranslate"><span class="pre">FooTest</span></code> again, each
with parameter values <code class="docutils literal notranslate"><span class="pre">&quot;cat&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;dog&quot;</span></code> using the
ValuesIn parameter generator:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">pets</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;cat&quot;</span><span class="p">,</span> <span class="s">&quot;dog&quot;</span><span class="p">};</span>
<span class="n">INSTANTIATE_TEST_SUITE_P</span><span class="p">(</span><span class="n">Pets</span><span class="p">,</span> <span class="n">FooTest</span><span class="p">,</span> <span class="n">testing</span><span class="o">::</span><span class="n">ValuesIn</span><span class="p">(</span><span class="n">pets</span><span class="p">));</span>
</pre></div>
</div>
<p>The tests from the instantiation above will have these names:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Pets/FooTest.DoesBlah/0</span></code> for <code class="docutils literal notranslate"><span class="pre">&quot;cat&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Pets/FooTest.DoesBlah/1</span></code> for <code class="docutils literal notranslate"><span class="pre">&quot;dog&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Pets/FooTest.HasBlahBlah/0</span></code> for <code class="docutils literal notranslate"><span class="pre">&quot;cat&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Pets/FooTest.HasBlahBlah/1</span></code> for <code class="docutils literal notranslate"><span class="pre">&quot;dog&quot;</span></code></p></li>
</ul>
<p>Please note that <code class="docutils literal notranslate"><span class="pre">INSTANTIATE_TEST_SUITE_P</span></code> will instantiate <em>all</em> tests in the
given test suite, whether their definitions come before or <em>after</em> the
<code class="docutils literal notranslate"><span class="pre">INSTANTIATE_TEST_SUITE_P</span></code> statement.</p>
<p>Additionally, by default, every <code class="docutils literal notranslate"><span class="pre">TEST_P</span></code> without a corresponding
<code class="docutils literal notranslate"><span class="pre">INSTANTIATE_TEST_SUITE_P</span></code> causes a failing test in test suite
<code class="docutils literal notranslate"><span class="pre">GoogleTestVerification</span></code>. If you have a test suite where that omission is not an
error, for example it is in a library that may be linked in for other reasons or
where the list of test cases is dynamic and may be empty, then this check can be
suppressed by tagging the test suite:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">GTEST_ALLOW_UNINSTANTIATED_PARAMETERIZED_TEST</span><span class="p">(</span><span class="n">FooTest</span><span class="p">);</span>
</pre></div>
</div>
<p>You can see <a class="reference external" href="https://github.com/google/googletest/blob/master/googletest/samples/sample7_unittest.cc">sample7_unittest.cc</a> and <a class="reference external" href="https://github.com/google/googletest/blob/master/googletest/samples/sample8_unittest.cc">sample8_unittest.cc</a> for more examples.</p>
</div>
<div class="section" id="creating-value-parameterized-abstract-tests">
<h3>Creating Value-Parameterized Abstract Tests<a class="headerlink" href="#creating-value-parameterized-abstract-tests" title="Permalink to this headline">¶</a></h3>
<p>In the above, we define and instantiate <code class="docutils literal notranslate"><span class="pre">FooTest</span></code> in the <em>same</em> source file.
Sometimes you may want to define value-parameterized tests in a library and let
other people instantiate them later. This pattern is known as <em>abstract tests</em>.
As an example of its application, when you are designing an interface you can
write a standard suite of abstract tests (perhaps using a factory function as
the test parameter) that all implementations of the interface are expected to
pass. When someone implements the interface, they can instantiate your suite to
get all the interface-conformance tests for free.</p>
<p>To define abstract tests, you should organize your code like this:</p>
<ol class="simple">
<li><p>Put the definition of the parameterized test fixture class (e.g. <code class="docutils literal notranslate"><span class="pre">FooTest</span></code>)
in a header file, say <code class="docutils literal notranslate"><span class="pre">foo_param_test.h</span></code>. Think of this as <em>declaring</em> your
abstract tests.</p></li>
<li><p>Put the <code class="docutils literal notranslate"><span class="pre">TEST_P</span></code> definitions in <code class="docutils literal notranslate"><span class="pre">foo_param_test.cc</span></code>, which includes
<code class="docutils literal notranslate"><span class="pre">foo_param_test.h</span></code>. Think of this as <em>implementing</em> your abstract tests.</p></li>
</ol>
<p>Once they are defined, you can instantiate them by including <code class="docutils literal notranslate"><span class="pre">foo_param_test.h</span></code>,
invoking <code class="docutils literal notranslate"><span class="pre">INSTANTIATE_TEST_SUITE_P()</span></code>, and depending on the library target that
contains <code class="docutils literal notranslate"><span class="pre">foo_param_test.cc</span></code>. You can instantiate the same abstract test suite
multiple times, possibly in different source files.</p>
</div>
<div class="section" id="specifying-names-for-value-parameterized-test-parameters">
<h3>Specifying Names for Value-Parameterized Test Parameters<a class="headerlink" href="#specifying-names-for-value-parameterized-test-parameters" title="Permalink to this headline">¶</a></h3>
<p>The optional last argument to <code class="docutils literal notranslate"><span class="pre">INSTANTIATE_TEST_SUITE_P()</span></code> allows the user to
specify a function or functor that generates custom test name suffixes based on
the test parameters. The function should accept one argument of type
<code class="docutils literal notranslate"><span class="pre">testing::TestParamInfo&lt;class</span> <span class="pre">ParamType&gt;</span></code>, and return <code class="docutils literal notranslate"><span class="pre">std::string</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">testing::PrintToStringParamName</span></code> is a builtin test suffix generator that
returns the value of <code class="docutils literal notranslate"><span class="pre">testing::PrintToString(GetParam())</span></code>. It does not work for
<code class="docutils literal notranslate"><span class="pre">std::string</span></code> or C strings.</p>
<p>{: .callout .note}
NOTE: test names must be non-empty, unique, and may only contain ASCII
alphanumeric characters. In particular, they
<a class="reference internal" href="faq.html#why-should-test-suite-names-and-test-names-not-contain-underscore"><span class="std std-ref">should not contain underscores</span></a></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyTestSuite</span> <span class="o">:</span> <span class="k">public</span> <span class="n">testing</span><span class="o">::</span><span class="n">TestWithParam</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="p">{};</span>

<span class="n">TEST_P</span><span class="p">(</span><span class="n">MyTestSuite</span><span class="p">,</span> <span class="n">MyTest</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Example Test Param: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">GetParam</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">INSTANTIATE_TEST_SUITE_P</span><span class="p">(</span><span class="n">MyGroup</span><span class="p">,</span> <span class="n">MyTestSuite</span><span class="p">,</span> <span class="n">testing</span><span class="o">::</span><span class="n">Range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                         <span class="n">testing</span><span class="o">::</span><span class="n">PrintToStringParamName</span><span class="p">());</span>
</pre></div>
</div>
<p>Providing a custom functor allows for more control over test parameter name
generation, especially for types where the automatic conversion does not
generate helpful parameter names (e.g. strings as demonstrated above). The
following example illustrates this for multiple parameters, an enumeration type
and a string, and also demonstrates how to combine generators. It uses a lambda
for conciseness:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span> <span class="k">class</span> <span class="nc">MyType</span> <span class="p">{</span> <span class="n">MY_FOO</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MY_BAR</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">};</span>

<span class="k">class</span> <span class="nc">MyTestSuite</span> <span class="o">:</span> <span class="k">public</span> <span class="n">testing</span><span class="o">::</span><span class="n">TestWithParam</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">tuple</span><span class="o">&lt;</span><span class="n">MyType</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
<span class="p">};</span>

<span class="n">INSTANTIATE_TEST_SUITE_P</span><span class="p">(</span>
    <span class="n">MyGroup</span><span class="p">,</span> <span class="n">MyTestSuite</span><span class="p">,</span>
    <span class="n">testing</span><span class="o">::</span><span class="n">Combine</span><span class="p">(</span>
        <span class="n">testing</span><span class="o">::</span><span class="n">Values</span><span class="p">(</span><span class="n">MyType</span><span class="o">::</span><span class="n">MY_FOO</span><span class="p">,</span> <span class="n">MyType</span><span class="o">::</span><span class="n">MY_BAR</span><span class="p">),</span>
        <span class="n">testing</span><span class="o">::</span><span class="n">Values</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">,</span> <span class="s">&quot;B&quot;</span><span class="p">)),</span>
    <span class="p">[](</span><span class="k">const</span> <span class="n">testing</span><span class="o">::</span><span class="n">TestParamInfo</span><span class="o">&lt;</span><span class="n">MyTestSuite</span><span class="o">::</span><span class="n">ParamType</span><span class="o">&gt;&amp;</span> <span class="n">info</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span> <span class="o">=</span> <span class="n">absl</span><span class="o">::</span><span class="n">StrCat</span><span class="p">(</span>
          <span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">param</span><span class="p">)</span> <span class="o">==</span> <span class="n">MyType</span><span class="o">::</span><span class="n">MY_FOO</span> <span class="o">?</span> <span class="s">&quot;Foo&quot;</span> <span class="o">:</span> <span class="s">&quot;Bar&quot;</span><span class="p">,</span>
          <span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">param</span><span class="p">));</span>
      <span class="n">absl</span><span class="o">::</span><span class="n">c_replace_if</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">[](</span><span class="kt">char</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">!</span><span class="n">std</span><span class="o">::</span><span class="n">isalnum</span><span class="p">(</span><span class="n">c</span><span class="p">);</span> <span class="p">},</span> <span class="sc">&#39;_&#39;</span><span class="p">);</span>
      <span class="k">return</span> <span class="n">name</span><span class="p">;</span>
    <span class="p">});</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="typed-tests">
<h2>Typed Tests<a class="headerlink" href="#typed-tests" title="Permalink to this headline">¶</a></h2>
<p>Suppose you have multiple implementations of the same interface and want to make
sure that all of them satisfy some common requirements. Or, you may have defined
several types that are supposed to conform to the same “concept” and you want to
verify it. In both cases, you want the same test logic repeated for different
types.</p>
<p>While you can write one <code class="docutils literal notranslate"><span class="pre">TEST</span></code> or <code class="docutils literal notranslate"><span class="pre">TEST_F</span></code> for each type you want to test (and
you may even factor the test logic into a function template that you invoke from
the <code class="docutils literal notranslate"><span class="pre">TEST</span></code>), it’s tedious and doesn’t scale: if you want <code class="docutils literal notranslate"><span class="pre">m</span></code> tests over <code class="docutils literal notranslate"><span class="pre">n</span></code>
types, you’ll end up writing <code class="docutils literal notranslate"><span class="pre">m*n</span></code> <code class="docutils literal notranslate"><span class="pre">TEST</span></code>s.</p>
<p><em>Typed tests</em> allow you to repeat the same test logic over a list of types. You
only need to write the test logic once, although you must know the type list
when writing typed tests. Here’s how you do it:</p>
<p>First, define a fixture class template. It should be parameterized by a type.
Remember to derive it from <code class="docutils literal notranslate"><span class="pre">::testing::Test</span></code>:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">FooTest</span> <span class="o">:</span> <span class="k">public</span> <span class="n">testing</span><span class="o">::</span><span class="n">Test</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="p">...</span>
  <span class="k">using</span> <span class="n">List</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">list</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="k">static</span> <span class="n">T</span> <span class="n">shared_</span><span class="p">;</span>
  <span class="n">T</span> <span class="n">value_</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Next, associate a list of types with the test suite, which will be repeated for
each type in the list:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="n">MyTypes</span> <span class="o">=</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Types</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">;</span>
<span class="n">TYPED_TEST_SUITE</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">MyTypes</span><span class="p">);</span>
</pre></div>
</div>
<p>The type alias (<code class="docutils literal notranslate"><span class="pre">using</span></code> or <code class="docutils literal notranslate"><span class="pre">typedef</span></code>) is necessary for the <code class="docutils literal notranslate"><span class="pre">TYPED_TEST_SUITE</span></code>
macro to parse correctly. Otherwise the compiler will think that each comma in
the type list introduces a new macro argument.</p>
<p>Then, use <code class="docutils literal notranslate"><span class="pre">TYPED_TEST()</span></code> instead of <code class="docutils literal notranslate"><span class="pre">TEST_F()</span></code> to define a typed test for this
test suite. You can repeat this as many times as you want:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">TYPED_TEST</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">DoesBlah</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Inside a test, refer to the special name TypeParam to get the type</span>
  <span class="c1">// parameter.  Since we are inside a derived class template, C++ requires</span>
  <span class="c1">// us to visit the members of FooTest via &#39;this&#39;.</span>
  <span class="n">TypeParam</span> <span class="n">n</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">value_</span><span class="p">;</span>

  <span class="c1">// To visit static members of the fixture, add the &#39;TestFixture::&#39;</span>
  <span class="c1">// prefix.</span>
  <span class="n">n</span> <span class="o">+=</span> <span class="n">TestFixture</span><span class="o">::</span><span class="n">shared_</span><span class="p">;</span>

  <span class="c1">// To refer to typedefs in the fixture, add the &#39;typename TestFixture::&#39;</span>
  <span class="c1">// prefix.  The &#39;typename&#39; is required to satisfy the compiler.</span>
  <span class="k">typename</span> <span class="n">TestFixture</span><span class="o">::</span><span class="n">List</span> <span class="n">values</span><span class="p">;</span>

  <span class="n">values</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
  <span class="p">...</span>
<span class="p">}</span>

<span class="n">TYPED_TEST</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">HasPropertyA</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>You can see <a class="reference external" href="https://github.com/google/googletest/blob/master/googletest/samples/sample6_unittest.cc">sample6_unittest.cc</a> for a complete example.</p>
</div>
<div class="section" id="type-parameterized-tests">
<h2>Type-Parameterized Tests<a class="headerlink" href="#type-parameterized-tests" title="Permalink to this headline">¶</a></h2>
<p><em>Type-parameterized tests</em> are like typed tests, except that they don’t require
you to know the list of types ahead of time. Instead, you can define the test
logic first and instantiate it with different type lists later. You can even
instantiate it more than once in the same program.</p>
<p>If you are designing an interface or concept, you can define a suite of
type-parameterized tests to verify properties that any valid implementation of
the interface/concept should have. Then, the author of each implementation can
just instantiate the test suite with their type to verify that it conforms to
the requirements, without having to write similar tests repeatedly. Here’s an
example:</p>
<p>First, define a fixture class template, as we did with typed tests:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">FooTest</span> <span class="o">:</span> <span class="k">public</span> <span class="n">testing</span><span class="o">::</span><span class="n">Test</span> <span class="p">{</span>
  <span class="p">...</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Next, declare that you will define a type-parameterized test suite:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">TYPED_TEST_SUITE_P</span><span class="p">(</span><span class="n">FooTest</span><span class="p">);</span>
</pre></div>
</div>
<p>Then, use <code class="docutils literal notranslate"><span class="pre">TYPED_TEST_P()</span></code> to define a type-parameterized test. You can repeat
this as many times as you want:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">TYPED_TEST_P</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">DoesBlah</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Inside a test, refer to TypeParam to get the type parameter.</span>
  <span class="n">TypeParam</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">...</span>
<span class="p">}</span>

<span class="n">TYPED_TEST_P</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">HasPropertyA</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>Now the tricky part: you need to register all test patterns using the
<code class="docutils literal notranslate"><span class="pre">REGISTER_TYPED_TEST_SUITE_P</span></code> macro before you can instantiate them. The first
argument of the macro is the test suite name; the rest are the names of the
tests in this test suite:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">REGISTER_TYPED_TEST_SUITE_P</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span>
                            <span class="n">DoesBlah</span><span class="p">,</span> <span class="n">HasPropertyA</span><span class="p">);</span>
</pre></div>
</div>
<p>Finally, you are free to instantiate the pattern with the types you want. If you
put the above code in a header file, you can <code class="docutils literal notranslate"><span class="pre">#include</span></code> it in multiple C++
source files and instantiate it multiple times.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="n">MyTypes</span> <span class="o">=</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Types</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">;</span>
<span class="n">INSTANTIATE_TYPED_TEST_SUITE_P</span><span class="p">(</span><span class="n">My</span><span class="p">,</span> <span class="n">FooTest</span><span class="p">,</span> <span class="n">MyTypes</span><span class="p">);</span>
</pre></div>
</div>
<p>To distinguish different instances of the pattern, the first argument to the
<code class="docutils literal notranslate"><span class="pre">INSTANTIATE_TYPED_TEST_SUITE_P</span></code> macro is a prefix that will be added to the
actual test suite name. Remember to pick unique prefixes for different
instances.</p>
<p>In the special case where the type list contains only one type, you can write
that type directly without <code class="docutils literal notranslate"><span class="pre">::testing::Types&lt;...&gt;</span></code>, like this:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">INSTANTIATE_TYPED_TEST_SUITE_P</span><span class="p">(</span><span class="n">My</span><span class="p">,</span> <span class="n">FooTest</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
</pre></div>
</div>
<p>You can see <a class="reference external" href="https://github.com/google/googletest/blob/master/googletest/samples/sample6_unittest.cc">sample6_unittest.cc</a> for a complete example.</p>
</div>
<div class="section" id="testing-private-code">
<h2>Testing Private Code<a class="headerlink" href="#testing-private-code" title="Permalink to this headline">¶</a></h2>
<p>If you change your software’s internal implementation, your tests should not
break as long as the change is not observable by users. Therefore, <strong>per the
black-box testing principle, most of the time you should test your code through
its public interfaces.</strong></p>
<p><strong>If you still find yourself needing to test internal implementation code,
consider if there’s a better design.</strong> The desire to test internal
implementation is often a sign that the class is doing too much. Consider
extracting an implementation class, and testing it. Then use that implementation
class in the original class.</p>
<p>If you absolutely have to test non-public interface code though, you can. There
are two cases to consider:</p>
<ul class="simple">
<li><p>Static functions ( <em>not</em> the same as static member functions!) or unnamed
namespaces, and</p></li>
<li><p>Private or protected class members</p></li>
</ul>
<p>To test them, we use the following special techniques:</p>
<ul>
<li><p>Both static functions and definitions/declarations in an unnamed namespace
are only visible within the same translation unit. To test them, you can
<code class="docutils literal notranslate"><span class="pre">#include</span></code> the entire <code class="docutils literal notranslate"><span class="pre">.cc</span></code> file being tested in your <code class="docutils literal notranslate"><span class="pre">*_test.cc</span></code> file.
(#including <code class="docutils literal notranslate"><span class="pre">.cc</span></code> files is not a good way to reuse code - you should not do
this in production code!)</p>
<p>However, a better approach is to move the private code into the
<code class="docutils literal notranslate"><span class="pre">foo::internal</span></code> namespace, where <code class="docutils literal notranslate"><span class="pre">foo</span></code> is the namespace your project
normally uses, and put the private declarations in a <code class="docutils literal notranslate"><span class="pre">*-internal.h</span></code> file.
Your production <code class="docutils literal notranslate"><span class="pre">.cc</span></code> files and your tests are allowed to include this
internal header, but your clients are not. This way, you can fully test your
internal implementation without leaking it to your clients.</p>
</li>
<li><p>Private class members are only accessible from within the class or by
friends. To access a class’ private members, you can declare your test
fixture as a friend to the class and define accessors in your fixture. Tests
using the fixture can then access the private members of your production
class via the accessors in the fixture. Note that even though your fixture
is a friend to your production class, your tests are not automatically
friends to it, as they are technically defined in sub-classes of the
fixture.</p>
<p>Another way to test private members is to refactor them into an
implementation class, which is then declared in a <code class="docutils literal notranslate"><span class="pre">*-internal.h</span></code> file. Your
clients aren’t allowed to include this header but your tests can. Such is
called the
<a class="reference external" href="https://www.gamedev.net/articles/programming/general-and-gameplay-programming/the-c-pimpl-r1794/">Pimpl</a>
(Private Implementation) idiom.</p>
<p>Or, you can declare an individual test as a friend of your class by adding
this line in the class body:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span>    <span class="n">FRIEND_TEST</span><span class="p">(</span><span class="n">TestSuiteName</span><span class="p">,</span> <span class="n">TestName</span><span class="p">);</span>
</pre></div>
</div>
<p>For example,</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// foo.h</span>
<span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
  <span class="p">...</span>
 <span class="k">private</span><span class="o">:</span>
  <span class="n">FRIEND_TEST</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">BarReturnsZeroOnNull</span><span class="p">);</span>

  <span class="kt">int</span> <span class="nf">Bar</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">x</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// foo_test.cc</span>
<span class="p">...</span>
<span class="n">TEST</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">BarReturnsZeroOnNull</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">Foo</span> <span class="n">foo</span><span class="p">;</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">foo</span><span class="p">.</span><span class="n">Bar</span><span class="p">(</span><span class="nb">NULL</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>  <span class="c1">// Uses Foo&#39;s private member Bar().</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Pay special attention when your class is defined in a namespace. If you want
your test fixtures and tests to be friends of your class, then they must be
defined in the exact same namespace (no anonymous or inline namespaces).</p>
<p>For example, if the code to be tested looks like:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="n">my_namespace</span> <span class="p">{</span>

<span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
  <span class="k">friend</span> <span class="k">class</span> <span class="nc">FooTest</span><span class="p">;</span>
  <span class="n">FRIEND_TEST</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Bar</span><span class="p">);</span>
  <span class="n">FRIEND_TEST</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Baz</span><span class="p">);</span>
  <span class="p">...</span> <span class="n">definition</span> <span class="n">of</span> <span class="n">the</span> <span class="k">class</span> <span class="nc">Foo</span> <span class="p">...</span>
<span class="p">};</span>

<span class="p">}</span>  <span class="c1">// namespace my_namespace</span>
</pre></div>
</div>
<p>Your test code should be something like:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="n">my_namespace</span> <span class="p">{</span>

<span class="k">class</span> <span class="nc">FooTest</span> <span class="o">:</span> <span class="k">public</span> <span class="n">testing</span><span class="o">::</span><span class="n">Test</span> <span class="p">{</span>
 <span class="k">protected</span><span class="o">:</span>
  <span class="p">...</span>
<span class="p">};</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Bar</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">TEST_F</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Baz</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

<span class="p">}</span>  <span class="c1">// namespace my_namespace</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="catching-failures">
<h2>“Catching” Failures<a class="headerlink" href="#catching-failures" title="Permalink to this headline">¶</a></h2>
<p>If you are building a testing utility on top of googletest, you’ll want to test
your utility. What framework would you use to test it? googletest, of course.</p>
<p>The challenge is to verify that your testing utility reports failures correctly.
In frameworks that report a failure by throwing an exception, you could catch
the exception and assert on it. But googletest doesn’t use exceptions, so how do
we test that a piece of code generates an expected failure?</p>
<p><code class="docutils literal notranslate"><span class="pre">&quot;gtest/gtest-spi.h&quot;</span></code> contains some constructs to do this.
After #including this header, you can use</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span>  <span class="n">EXPECT_FATAL_FAILURE</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">substring</span><span class="p">);</span>
</pre></div>
</div>
<p>to assert that <code class="docutils literal notranslate"><span class="pre">statement</span></code> generates a fatal (e.g. <code class="docutils literal notranslate"><span class="pre">ASSERT_*</span></code>) failure in the
current thread whose message contains the given <code class="docutils literal notranslate"><span class="pre">substring</span></code>, or use</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span>  <span class="n">EXPECT_NONFATAL_FAILURE</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">substring</span><span class="p">);</span>
</pre></div>
</div>
<p>if you are expecting a non-fatal (e.g. <code class="docutils literal notranslate"><span class="pre">EXPECT_*</span></code>) failure.</p>
<p>Only failures in the current thread are checked to determine the result of this
type of expectations. If <code class="docutils literal notranslate"><span class="pre">statement</span></code> creates new threads, failures in these
threads are also ignored. If you want to catch failures in other threads as
well, use one of the following macros instead:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span>  <span class="n">EXPECT_FATAL_FAILURE_ON_ALL_THREADS</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">substring</span><span class="p">);</span>
  <span class="n">EXPECT_NONFATAL_FAILURE_ON_ALL_THREADS</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">substring</span><span class="p">);</span>
</pre></div>
</div>
<p>{: .callout .note}
NOTE: Assertions from multiple threads are currently not supported on Windows.</p>
<p>For technical reasons, there are some caveats:</p>
<ol class="simple">
<li><p>You cannot stream a failure message to either macro.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">statement</span></code> in <code class="docutils literal notranslate"><span class="pre">EXPECT_FATAL_FAILURE{_ON_ALL_THREADS}()</span></code> cannot reference
local non-static variables or non-static members of <code class="docutils literal notranslate"><span class="pre">this</span></code> object.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">statement</span></code> in <code class="docutils literal notranslate"><span class="pre">EXPECT_FATAL_FAILURE{_ON_ALL_THREADS}()</span></code> cannot return a
value.</p></li>
</ol>
</div>
<div class="section" id="registering-tests-programmatically">
<h2>Registering tests programmatically<a class="headerlink" href="#registering-tests-programmatically" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">TEST</span></code> macros handle the vast majority of all use cases, but there are few
where runtime registration logic is required. For those cases, the framework
provides the <code class="docutils literal notranslate"><span class="pre">::testing::RegisterTest</span></code> that allows callers to register arbitrary
tests dynamically.</p>
<p>This is an advanced API only to be used when the <code class="docutils literal notranslate"><span class="pre">TEST</span></code> macros are insufficient.
The macros should be preferred when possible, as they avoid most of the
complexity of calling this function.</p>
<p>It provides the following signature:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Factory</span><span class="o">&gt;</span>
<span class="n">TestInfo</span><span class="o">*</span> <span class="n">RegisterTest</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">test_suite_name</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">test_name</span><span class="p">,</span>
                       <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">type_param</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">value_param</span><span class="p">,</span>
                       <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">file</span><span class="p">,</span> <span class="kt">int</span> <span class="n">line</span><span class="p">,</span> <span class="n">Factory</span> <span class="n">factory</span><span class="p">);</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">factory</span></code> argument is a factory callable (move-constructible) object or
function pointer that creates a new instance of the Test object. It handles
ownership to the caller. The signature of the callable is <code class="docutils literal notranslate"><span class="pre">Fixture*()</span></code>, where
<code class="docutils literal notranslate"><span class="pre">Fixture</span></code> is the test fixture class for the test. All tests registered with the
same <code class="docutils literal notranslate"><span class="pre">test_suite_name</span></code> must return the same fixture type. This is checked at
runtime.</p>
<p>The framework will infer the fixture class from the factory and will call the
<code class="docutils literal notranslate"><span class="pre">SetUpTestSuite</span></code> and <code class="docutils literal notranslate"><span class="pre">TearDownTestSuite</span></code> for it.</p>
<p>Must be called before <code class="docutils literal notranslate"><span class="pre">RUN_ALL_TESTS()</span></code> is invoked, otherwise behavior is
undefined.</p>
<p>Use case example:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyFixture</span> <span class="o">:</span> <span class="k">public</span> <span class="n">testing</span><span class="o">::</span><span class="n">Test</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="c1">// All of these optional, just like in regular macro usage.</span>
  <span class="k">static</span> <span class="kt">void</span> <span class="n">SetUpTestSuite</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
  <span class="k">static</span> <span class="kt">void</span> <span class="n">TearDownTestSuite</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
  <span class="kt">void</span> <span class="n">SetUp</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
  <span class="kt">void</span> <span class="n">TearDown</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">MyTest</span> <span class="o">:</span> <span class="k">public</span> <span class="n">MyFixture</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">explicit</span> <span class="n">MyTest</span><span class="p">(</span><span class="kt">int</span> <span class="n">data</span><span class="p">)</span> <span class="o">:</span> <span class="n">data_</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="p">{}</span>
  <span class="kt">void</span> <span class="n">TestBody</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

 <span class="k">private</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">data_</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="nf">RegisterMyTests</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">values</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="nl">v</span> <span class="p">:</span> <span class="n">values</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">testing</span><span class="o">::</span><span class="n">RegisterTest</span><span class="p">(</span>
        <span class="s">&quot;MyFixture&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;Test&quot;</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">v</span><span class="p">)).</span><span class="n">c_str</span><span class="p">(),</span> <span class="k">nullptr</span><span class="p">,</span>
        <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">v</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span>
        <span class="n">__FILE__</span><span class="p">,</span> <span class="n">__LINE__</span><span class="p">,</span>
        <span class="c1">// Important to use the fixture type as the return type here.</span>
        <span class="p">[</span><span class="o">=</span><span class="p">]()</span> <span class="o">-&gt;</span> <span class="n">MyFixture</span><span class="o">*</span> <span class="p">{</span> <span class="k">return</span> <span class="k">new</span> <span class="n">MyTest</span><span class="p">(</span><span class="n">v</span><span class="p">);</span> <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">...</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">testing</span><span class="o">::</span><span class="n">InitGoogleTest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">values_to_test</span> <span class="o">=</span> <span class="n">LoadValuesFromConfig</span><span class="p">();</span>
  <span class="n">RegisterMyTests</span><span class="p">(</span><span class="n">values_to_test</span><span class="p">);</span>
  <span class="p">...</span>
  <span class="k">return</span> <span class="n">RUN_ALL_TESTS</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="getting-the-current-test-s-name">
<h2>Getting the Current Test’s Name<a class="headerlink" href="#getting-the-current-test-s-name" title="Permalink to this headline">¶</a></h2>
<p>Sometimes a function may need to know the name of the currently running test.
For example, you may be using the <code class="docutils literal notranslate"><span class="pre">SetUp()</span></code> method of your test fixture to set
the golden file name based on which test is running. The
TestInfo class has this information.</p>
<p>To obtain a <code class="docutils literal notranslate"><span class="pre">TestInfo</span></code> object for the currently running test, call
<code class="docutils literal notranslate"><span class="pre">current_test_info()</span></code> on the UnitTest
singleton object:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span>  <span class="c1">// Gets information about the currently running test.</span>
  <span class="c1">// Do NOT delete the returned object - it&#39;s managed by the UnitTest class.</span>
  <span class="k">const</span> <span class="n">testing</span><span class="o">::</span><span class="n">TestInfo</span><span class="o">*</span> <span class="k">const</span> <span class="n">test_info</span> <span class="o">=</span>
      <span class="n">testing</span><span class="o">::</span><span class="n">UnitTest</span><span class="o">::</span><span class="n">GetInstance</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">current_test_info</span><span class="p">();</span>

  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;We are in test %s of test suite %s.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
         <span class="n">test_info</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">(),</span>
         <span class="n">test_info</span><span class="o">-&gt;</span><span class="n">test_suite_name</span><span class="p">());</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">current_test_info()</span></code> returns a null pointer if no test is running. In
particular, you cannot find the test suite name in <code class="docutils literal notranslate"><span class="pre">SetUpTestSuite()</span></code>,
<code class="docutils literal notranslate"><span class="pre">TearDownTestSuite()</span></code> (where you know the test suite name implicitly), or
functions called from them.</p>
</div>
<div class="section" id="extending-googletest-by-handling-test-events">
<h2>Extending googletest by Handling Test Events<a class="headerlink" href="#extending-googletest-by-handling-test-events" title="Permalink to this headline">¶</a></h2>
<p>googletest provides an <strong>event listener API</strong> to let you receive notifications
about the progress of a test program and test failures. The events you can
listen to include the start and end of the test program, a test suite, or a test
method, among others. You may use this API to augment or replace the standard
console output, replace the XML output, or provide a completely different form
of output, such as a GUI or a database. You can also use test events as
checkpoints to implement a resource leak checker, for example.</p>
<div class="section" id="defining-event-listeners">
<h3>Defining Event Listeners<a class="headerlink" href="#defining-event-listeners" title="Permalink to this headline">¶</a></h3>
<p>To define a event listener, you subclass either
testing::TestEventListener or
testing::EmptyTestEventListener
The former is an (abstract) interface, where <em>each pure virtual method can be
overridden to handle a test event</em> (For example, when a test starts, the
<code class="docutils literal notranslate"><span class="pre">OnTestStart()</span></code> method will be called.). The latter provides an empty
implementation of all methods in the interface, such that a subclass only needs
to override the methods it cares about.</p>
<p>When an event is fired, its context is passed to the handler function as an
argument. The following argument types are used:</p>
<ul class="simple">
<li><p>UnitTest reflects the state of the entire test program,</p></li>
<li><p>TestSuite has information about a test suite, which can contain one or more
tests,</p></li>
<li><p>TestInfo contains the state of a test, and</p></li>
<li><p>TestPartResult represents the result of a test assertion.</p></li>
</ul>
<p>An event handler function can examine the argument it receives to find out
interesting information about the event and the test program’s state.</p>
<p>Here’s an example:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span>  <span class="k">class</span> <span class="nc">MinimalistPrinter</span> <span class="o">:</span> <span class="k">public</span> <span class="n">testing</span><span class="o">::</span><span class="n">EmptyTestEventListener</span> <span class="p">{</span>
    <span class="c1">// Called before a test starts.</span>
    <span class="kt">void</span> <span class="n">OnTestStart</span><span class="p">(</span><span class="k">const</span> <span class="n">testing</span><span class="o">::</span><span class="n">TestInfo</span><span class="o">&amp;</span> <span class="n">test_info</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;*** Test %s.%s starting.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
             <span class="n">test_info</span><span class="p">.</span><span class="n">test_suite_name</span><span class="p">(),</span> <span class="n">test_info</span><span class="p">.</span><span class="n">name</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="c1">// Called after a failed assertion or a SUCCESS().</span>
    <span class="kt">void</span> <span class="n">OnTestPartResult</span><span class="p">(</span><span class="k">const</span> <span class="n">testing</span><span class="o">::</span><span class="n">TestPartResult</span><span class="o">&amp;</span> <span class="n">test_part_result</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s in %s:%d</span><span class="se">\n</span><span class="s">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
             <span class="n">test_part_result</span><span class="p">.</span><span class="n">failed</span><span class="p">()</span> <span class="o">?</span> <span class="s">&quot;*** Failure&quot;</span> <span class="o">:</span> <span class="s">&quot;Success&quot;</span><span class="p">,</span>
             <span class="n">test_part_result</span><span class="p">.</span><span class="n">file_name</span><span class="p">(),</span>
             <span class="n">test_part_result</span><span class="p">.</span><span class="n">line_number</span><span class="p">(),</span>
             <span class="n">test_part_result</span><span class="p">.</span><span class="n">summary</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="c1">// Called after a test ends.</span>
    <span class="kt">void</span> <span class="n">OnTestEnd</span><span class="p">(</span><span class="k">const</span> <span class="n">testing</span><span class="o">::</span><span class="n">TestInfo</span><span class="o">&amp;</span> <span class="n">test_info</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;*** Test %s.%s ending.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
             <span class="n">test_info</span><span class="p">.</span><span class="n">test_suite_name</span><span class="p">(),</span> <span class="n">test_info</span><span class="p">.</span><span class="n">name</span><span class="p">());</span>
    <span class="p">}</span>
  <span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="using-event-listeners">
<h3>Using Event Listeners<a class="headerlink" href="#using-event-listeners" title="Permalink to this headline">¶</a></h3>
<p>To use the event listener you have defined, add an instance of it to the
googletest event listener list (represented by class
TestEventListeners - note the “s”
at the end of the name) in your <code class="docutils literal notranslate"><span class="pre">main()</span></code> function, before calling
<code class="docutils literal notranslate"><span class="pre">RUN_ALL_TESTS()</span></code>:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">testing</span><span class="o">::</span><span class="n">InitGoogleTest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
  <span class="c1">// Gets hold of the event listener list.</span>
  <span class="n">testing</span><span class="o">::</span><span class="n">TestEventListeners</span><span class="o">&amp;</span> <span class="n">listeners</span> <span class="o">=</span>
      <span class="n">testing</span><span class="o">::</span><span class="n">UnitTest</span><span class="o">::</span><span class="n">GetInstance</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">listeners</span><span class="p">();</span>
  <span class="c1">// Adds a listener to the end.  googletest takes the ownership.</span>
  <span class="n">listeners</span><span class="p">.</span><span class="n">Append</span><span class="p">(</span><span class="k">new</span> <span class="n">MinimalistPrinter</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">RUN_ALL_TESTS</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>There’s only one problem: the default test result printer is still in effect, so
its output will mingle with the output from your minimalist printer. To suppress
the default printer, just release it from the event listener list and delete it.
You can do so by adding one line:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span>  <span class="p">...</span>
  <span class="k">delete</span> <span class="n">listeners</span><span class="p">.</span><span class="n">Release</span><span class="p">(</span><span class="n">listeners</span><span class="p">.</span><span class="n">default_result_printer</span><span class="p">());</span>
  <span class="n">listeners</span><span class="p">.</span><span class="n">Append</span><span class="p">(</span><span class="k">new</span> <span class="n">MinimalistPrinter</span><span class="p">);</span>
  <span class="k">return</span> <span class="nf">RUN_ALL_TESTS</span><span class="p">();</span>
</pre></div>
</div>
<p>Now, sit back and enjoy a completely different output from your tests. For more
details, see <a class="reference external" href="https://github.com/google/googletest/blob/master/googletest/samples/sample9_unittest.cc">sample9_unittest.cc</a>.</p>
<p>You may append more than one listener to the list. When an <code class="docutils literal notranslate"><span class="pre">On*Start()</span></code> or
<code class="docutils literal notranslate"><span class="pre">OnTestPartResult()</span></code> event is fired, the listeners will receive it in the order
they appear in the list (since new listeners are added to the end of the list,
the default text printer and the default XML generator will receive the event
first). An <code class="docutils literal notranslate"><span class="pre">On*End()</span></code> event will be received by the listeners in the <em>reverse</em>
order. This allows output by listeners added later to be framed by output from
listeners added earlier.</p>
</div>
<div class="section" id="generating-failures-in-listeners">
<h3>Generating Failures in Listeners<a class="headerlink" href="#generating-failures-in-listeners" title="Permalink to this headline">¶</a></h3>
<p>You may use failure-raising macros (<code class="docutils literal notranslate"><span class="pre">EXPECT_*()</span></code>, <code class="docutils literal notranslate"><span class="pre">ASSERT_*()</span></code>, <code class="docutils literal notranslate"><span class="pre">FAIL()</span></code>, etc)
when processing an event. There are some restrictions:</p>
<ol class="simple">
<li><p>You cannot generate any failure in <code class="docutils literal notranslate"><span class="pre">OnTestPartResult()</span></code> (otherwise it will
cause <code class="docutils literal notranslate"><span class="pre">OnTestPartResult()</span></code> to be called recursively).</p></li>
<li><p>A listener that handles <code class="docutils literal notranslate"><span class="pre">OnTestPartResult()</span></code> is not allowed to generate any
failure.</p></li>
</ol>
<p>When you add listeners to the listener list, you should put listeners that
handle <code class="docutils literal notranslate"><span class="pre">OnTestPartResult()</span></code> <em>before</em> listeners that can generate failures. This
ensures that failures generated by the latter are attributed to the right test
by the former.</p>
<p>See <a class="reference external" href="https://github.com/google/googletest/blob/master/googletest/samples/sample10_unittest.cc">sample10_unittest.cc</a> for an example of a failure-raising listener.</p>
</div>
</div>
<div class="section" id="running-test-programs-advanced-options">
<h2>Running Test Programs: Advanced Options<a class="headerlink" href="#running-test-programs-advanced-options" title="Permalink to this headline">¶</a></h2>
<p>googletest test programs are ordinary executables. Once built, you can run them
directly and affect their behavior via the following environment variables
and/or command line flags. For the flags to work, your programs must call
<code class="docutils literal notranslate"><span class="pre">::testing::InitGoogleTest()</span></code> before calling <code class="docutils literal notranslate"><span class="pre">RUN_ALL_TESTS()</span></code>.</p>
<p>To see a list of supported flags and their usage, please run your test program
with the <code class="docutils literal notranslate"><span class="pre">--help</span></code> flag. You can also use <code class="docutils literal notranslate"><span class="pre">-h</span></code>, <code class="docutils literal notranslate"><span class="pre">-?</span></code>, or <code class="docutils literal notranslate"><span class="pre">/?</span></code> for short.</p>
<p>If an option is specified both by an environment variable and by a flag, the
latter takes precedence.</p>
<div class="section" id="selecting-tests">
<h3>Selecting Tests<a class="headerlink" href="#selecting-tests" title="Permalink to this headline">¶</a></h3>
<div class="section" id="listing-test-names">
<h4>Listing Test Names<a class="headerlink" href="#listing-test-names" title="Permalink to this headline">¶</a></h4>
<p>Sometimes it is necessary to list the available tests in a program before
running them so that a filter may be applied if needed. Including the flag
<code class="docutils literal notranslate"><span class="pre">--gtest_list_tests</span></code> overrides all other flags and lists tests in the following
format:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>TestSuite1.
  TestName1
  TestName2
TestSuite2.
  TestName
</pre></div>
</div>
<p>None of the tests listed are actually run if the flag is provided. There is no
corresponding environment variable for this flag.</p>
</div>
<div class="section" id="running-a-subset-of-the-tests">
<h4>Running a Subset of the Tests<a class="headerlink" href="#running-a-subset-of-the-tests" title="Permalink to this headline">¶</a></h4>
<p>By default, a googletest program runs all tests the user has defined. Sometimes,
you want to run only a subset of the tests (e.g. for debugging or quickly
verifying a change). If you set the <code class="docutils literal notranslate"><span class="pre">GTEST_FILTER</span></code> environment variable or the
<code class="docutils literal notranslate"><span class="pre">--gtest_filter</span></code> flag to a filter string, googletest will only run the tests
whose full names (in the form of <code class="docutils literal notranslate"><span class="pre">TestSuiteName.TestName</span></code>) match the filter.</p>
<p>The format of a filter is a ‘<code class="docutils literal notranslate"><span class="pre">:</span></code>’-separated list of wildcard patterns (called
the <em>positive patterns</em>) optionally followed by a ‘<code class="docutils literal notranslate"><span class="pre">-</span></code>‘ and another
‘<code class="docutils literal notranslate"><span class="pre">:</span></code>’-separated pattern list (called the <em>negative patterns</em>). A test matches
the filter if and only if it matches any of the positive patterns but does not
match any of the negative patterns.</p>
<p>A pattern may contain <code class="docutils literal notranslate"><span class="pre">'*'</span></code> (matches any string) or <code class="docutils literal notranslate"><span class="pre">'?'</span></code> (matches any single
character). For convenience, the filter <code class="docutils literal notranslate"><span class="pre">'*-NegativePatterns'</span></code> can be also
written as <code class="docutils literal notranslate"><span class="pre">'-NegativePatterns'</span></code>.</p>
<p>For example:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">./foo_test</span></code> Has no flag, and thus runs all its tests.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">./foo_test</span> <span class="pre">--gtest_filter=*</span></code> Also runs everything, due to the single
match-everything <code class="docutils literal notranslate"><span class="pre">*</span></code> value.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">./foo_test</span> <span class="pre">--gtest_filter=FooTest.*</span></code> Runs everything in test suite
<code class="docutils literal notranslate"><span class="pre">FooTest</span></code> .</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">./foo_test</span> <span class="pre">--gtest_filter=*Null*:*Constructor*</span></code> Runs any test whose full
name contains either <code class="docutils literal notranslate"><span class="pre">&quot;Null&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;Constructor&quot;</span></code> .</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">./foo_test</span> <span class="pre">--gtest_filter=-*DeathTest.*</span></code> Runs all non-death tests.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">./foo_test</span> <span class="pre">--gtest_filter=FooTest.*-FooTest.Bar</span></code> Runs everything in test
suite <code class="docutils literal notranslate"><span class="pre">FooTest</span></code> except <code class="docutils literal notranslate"><span class="pre">FooTest.Bar</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">./foo_test</span> <span class="pre">--gtest_filter=FooTest.*:BarTest.*-FooTest.Bar:BarTest.Foo</span></code> Runs
everything in test suite <code class="docutils literal notranslate"><span class="pre">FooTest</span></code> except <code class="docutils literal notranslate"><span class="pre">FooTest.Bar</span></code> and everything in
test suite <code class="docutils literal notranslate"><span class="pre">BarTest</span></code> except <code class="docutils literal notranslate"><span class="pre">BarTest.Foo</span></code>.</p></li>
</ul>
</div>
<div class="section" id="stop-test-execution-upon-first-failure">
<h4>Stop test execution upon first failure<a class="headerlink" href="#stop-test-execution-upon-first-failure" title="Permalink to this headline">¶</a></h4>
<p>By default, a googletest program runs all tests the user has defined. In some
cases (e.g. iterative test development &amp; execution) it may be desirable stop
test execution upon first failure (trading improved latency for completeness).
If <code class="docutils literal notranslate"><span class="pre">GTEST_FAIL_FAST</span></code> environment variable or <code class="docutils literal notranslate"><span class="pre">--gtest_fail_fast</span></code> flag is set,
the test runner will stop execution as soon as the first test failure is found.</p>
</div>
<div class="section" id="temporarily-disabling-tests">
<h4>Temporarily Disabling Tests<a class="headerlink" href="#temporarily-disabling-tests" title="Permalink to this headline">¶</a></h4>
<p>If you have a broken test that you cannot fix right away, you can add the
<code class="docutils literal notranslate"><span class="pre">DISABLED_</span></code> prefix to its name. This will exclude it from execution. This is
better than commenting out the code or using <code class="docutils literal notranslate"><span class="pre">#if</span> <span class="pre">0</span></code>, as disabled tests are
still compiled (and thus won’t rot).</p>
<p>If you need to disable all tests in a test suite, you can either add <code class="docutils literal notranslate"><span class="pre">DISABLED_</span></code>
to the front of the name of each test, or alternatively add it to the front of
the test suite name.</p>
<p>For example, the following tests won’t be run by googletest, even though they
will still be compiled:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// Tests that Foo does Abc.</span>
<span class="n">TEST</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">DISABLED_DoesAbc</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

<span class="k">class</span> <span class="nc">DISABLED_BarTest</span> <span class="o">:</span> <span class="k">public</span> <span class="n">testing</span><span class="o">::</span><span class="n">Test</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>

<span class="c1">// Tests that Bar does Xyz.</span>
<span class="n">TEST_F</span><span class="p">(</span><span class="n">DISABLED_BarTest</span><span class="p">,</span> <span class="n">DoesXyz</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>{: .callout .note}
NOTE: This feature should only be used for temporary pain-relief. You still have
to fix the disabled tests at a later date. As a reminder, googletest will print
a banner warning you if a test program contains any disabled tests.</p>
<p>{: .callout .tip}
TIP: You can easily count the number of disabled tests you have using
<code class="docutils literal notranslate"><span class="pre">grep</span></code>. This number can be used as a metric for
improving your test quality.</p>
</div>
<div class="section" id="temporarily-enabling-disabled-tests">
<h4>Temporarily Enabling Disabled Tests<a class="headerlink" href="#temporarily-enabling-disabled-tests" title="Permalink to this headline">¶</a></h4>
<p>To include disabled tests in test execution, just invoke the test program with
the <code class="docutils literal notranslate"><span class="pre">--gtest_also_run_disabled_tests</span></code> flag or set the
<code class="docutils literal notranslate"><span class="pre">GTEST_ALSO_RUN_DISABLED_TESTS</span></code> environment variable to a value other than <code class="docutils literal notranslate"><span class="pre">0</span></code>.
You can combine this with the <code class="docutils literal notranslate"><span class="pre">--gtest_filter</span></code> flag to further select which
disabled tests to run.</p>
</div>
</div>
<div class="section" id="repeating-the-tests">
<h3>Repeating the Tests<a class="headerlink" href="#repeating-the-tests" title="Permalink to this headline">¶</a></h3>
<p>Once in a while you’ll run into a test whose result is hit-or-miss. Perhaps it
will fail only 1% of the time, making it rather hard to reproduce the bug under
a debugger. This can be a major source of frustration.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--gtest_repeat</span></code> flag allows you to repeat all (or selected) test methods in
a program many times. Hopefully, a flaky test will eventually fail and give you
a chance to debug. Here’s how to use it:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ foo_test --gtest_repeat=1000
Repeat foo_test 1000 times and don&#39;t stop at failures.

$ foo_test --gtest_repeat=-1
A negative count means repeating forever.

$ foo_test --gtest_repeat=1000 --gtest_break_on_failure
Repeat foo_test 1000 times, stopping at the first failure.  This
is especially useful when running under a debugger: when the test
fails, it will drop into the debugger and you can then inspect
variables and stacks.

$ foo_test --gtest_repeat=1000 --gtest_filter=FooBar.*
Repeat the tests whose name matches the filter 1000 times.
</pre></div>
</div>
<p>If your test program contains
<a class="reference external" href="#global-set-up-and-tear-down">global set-up/tear-down</a> code, it will be
repeated in each iteration as well, as the flakiness may be in it. You can also
specify the repeat count by setting the <code class="docutils literal notranslate"><span class="pre">GTEST_REPEAT</span></code> environment variable.</p>
</div>
<div class="section" id="shuffling-the-tests">
<h3>Shuffling the Tests<a class="headerlink" href="#shuffling-the-tests" title="Permalink to this headline">¶</a></h3>
<p>You can specify the <code class="docutils literal notranslate"><span class="pre">--gtest_shuffle</span></code> flag (or set the <code class="docutils literal notranslate"><span class="pre">GTEST_SHUFFLE</span></code>
environment variable to <code class="docutils literal notranslate"><span class="pre">1</span></code>) to run the tests in a program in a random order.
This helps to reveal bad dependencies between tests.</p>
<p>By default, googletest uses a random seed calculated from the current time.
Therefore you’ll get a different order every time. The console output includes
the random seed value, such that you can reproduce an order-related test failure
later. To specify the random seed explicitly, use the <code class="docutils literal notranslate"><span class="pre">--gtest_random_seed=SEED</span></code>
flag (or set the <code class="docutils literal notranslate"><span class="pre">GTEST_RANDOM_SEED</span></code> environment variable), where <code class="docutils literal notranslate"><span class="pre">SEED</span></code> is an
integer in the range [0, 99999]. The seed value 0 is special: it tells
googletest to do the default behavior of calculating the seed from the current
time.</p>
<p>If you combine this with <code class="docutils literal notranslate"><span class="pre">--gtest_repeat=N</span></code>, googletest will pick a different
random seed and re-shuffle the tests in each iteration.</p>
</div>
<div class="section" id="distributing-test-functions-to-multiple-machines">
<h3>Distributing Test Functions to Multiple Machines<a class="headerlink" href="#distributing-test-functions-to-multiple-machines" title="Permalink to this headline">¶</a></h3>
<p>If you have more than one machine you can use to run a test program, you might
want to run the test functions in parallel and get the result faster. We call
this technique <em>sharding</em>, where each machine is called a <em>shard</em>.</p>
<p>GoogleTest is compatible with test sharding. To take advantage of this feature,
your test runner (not part of GoogleTest) needs to do the following:</p>
<ol class="simple">
<li><p>Allocate a number of machines (shards) to run the tests.</p></li>
<li><p>On each shard, set the <code class="docutils literal notranslate"><span class="pre">GTEST_TOTAL_SHARDS</span></code> environment variable to the total
number of shards. It must be the same for all shards.</p></li>
<li><p>On each shard, set the <code class="docutils literal notranslate"><span class="pre">GTEST_SHARD_INDEX</span></code> environment variable to the index
of the shard. Different shards must be assigned different indices, which
must be in the range <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">GTEST_TOTAL_SHARDS</span> <span class="pre">-</span> <span class="pre">1]</span></code>.</p></li>
<li><p>Run the same test program on all shards. When GoogleTest sees the above two
environment variables, it will select a subset of the test functions to run.
Across all shards, each test function in the program will be run exactly
once.</p></li>
<li><p>Wait for all shards to finish, then collect and report the results.</p></li>
</ol>
<p>Your project may have tests that were written without GoogleTest and thus don’t
understand this protocol. In order for your test runner to figure out which test
supports sharding, it can set the environment variable <code class="docutils literal notranslate"><span class="pre">GTEST_SHARD_STATUS_FILE</span></code>
to a non-existent file path. If a test program supports sharding, it will create
this file to acknowledge that fact; otherwise it will not create it. The actual
contents of the file are not important at this time, although we may put some
useful information in it in the future.</p>
<p>Here’s an example to make it clear. Suppose you have a test program <code class="docutils literal notranslate"><span class="pre">foo_test</span></code>
that contains the following 5 test functions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TEST</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">V</span><span class="p">)</span>
<span class="n">TEST</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span>
<span class="n">TEST</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
<span class="n">TEST</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
<span class="n">TEST</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">Z</span><span class="p">)</span>
</pre></div>
</div>
<p>Suppose you have 3 machines at your disposal. To run the test functions in
parallel, you would set <code class="docutils literal notranslate"><span class="pre">GTEST_TOTAL_SHARDS</span></code> to 3 on all machines, and set
<code class="docutils literal notranslate"><span class="pre">GTEST_SHARD_INDEX</span></code> to 0, 1, and 2 on the machines respectively. Then you would
run the same <code class="docutils literal notranslate"><span class="pre">foo_test</span></code> on each machine.</p>
<p>GoogleTest reserves the right to change how the work is distributed across the
shards, but here’s one possible scenario:</p>
<ul class="simple">
<li><p>Machine #0 runs <code class="docutils literal notranslate"><span class="pre">A.V</span></code> and <code class="docutils literal notranslate"><span class="pre">B.X</span></code>.</p></li>
<li><p>Machine #1 runs <code class="docutils literal notranslate"><span class="pre">A.W</span></code> and <code class="docutils literal notranslate"><span class="pre">B.Y</span></code>.</p></li>
<li><p>Machine #2 runs <code class="docutils literal notranslate"><span class="pre">B.Z</span></code>.</p></li>
</ul>
</div>
<div class="section" id="controlling-test-output">
<h3>Controlling Test Output<a class="headerlink" href="#controlling-test-output" title="Permalink to this headline">¶</a></h3>
<div class="section" id="colored-terminal-output">
<h4>Colored Terminal Output<a class="headerlink" href="#colored-terminal-output" title="Permalink to this headline">¶</a></h4>
<p>googletest can use colors in its terminal output to make it easier to spot the
important information:</p>
<pre>...
<font color="green">[----------]</font> 1 test from FooTest
<font color="green">[ RUN      ]</font> FooTest.DoesAbc
<font color="green">[       OK ]</font> FooTest.DoesAbc
<font color="green">[----------]</font> 2 tests from BarTest
<font color="green">[ RUN      ]</font> BarTest.HasXyzProperty
<font color="green">[       OK ]</font> BarTest.HasXyzProperty
<font color="green">[ RUN      ]</font> BarTest.ReturnsTrueOnSuccess
... some error messages ...
<font color="red">[   FAILED ]</font> BarTest.ReturnsTrueOnSuccess
...
<font color="green">[==========]</font> 30 tests from 14 test suites ran.
<font color="green">[   PASSED ]</font> 28 tests.
<font color="red">[   FAILED ]</font> 2 tests, listed below:
<font color="red">[   FAILED ]</font> BarTest.ReturnsTrueOnSuccess
<font color="red">[   FAILED ]</font> AnotherTest.DoesXyz

 2 FAILED TESTS
</pre><p>You can set the <code class="docutils literal notranslate"><span class="pre">GTEST_COLOR</span></code> environment variable or the <code class="docutils literal notranslate"><span class="pre">--gtest_color</span></code>
command line flag to <code class="docutils literal notranslate"><span class="pre">yes</span></code>, <code class="docutils literal notranslate"><span class="pre">no</span></code>, or <code class="docutils literal notranslate"><span class="pre">auto</span></code> (the default) to enable colors,
disable colors, or let googletest decide. When the value is <code class="docutils literal notranslate"><span class="pre">auto</span></code>, googletest
will use colors if and only if the output goes to a terminal and (on non-Windows
platforms) the <code class="docutils literal notranslate"><span class="pre">TERM</span></code> environment variable is set to <code class="docutils literal notranslate"><span class="pre">xterm</span></code> or <code class="docutils literal notranslate"><span class="pre">xterm-color</span></code>.</p>
</div>
<div class="section" id="suppressing-test-passes">
<h4>Suppressing test passes<a class="headerlink" href="#suppressing-test-passes" title="Permalink to this headline">¶</a></h4>
<p>By default, googletest prints 1 line of output for each test, indicating if it
passed or failed. To show only test failures, run the test program with
<code class="docutils literal notranslate"><span class="pre">--gtest_brief=1</span></code>, or set the GTEST_BRIEF environment variable to <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
</div>
<div class="section" id="suppressing-the-elapsed-time">
<h4>Suppressing the Elapsed Time<a class="headerlink" href="#suppressing-the-elapsed-time" title="Permalink to this headline">¶</a></h4>
<p>By default, googletest prints the time it takes to run each test. To disable
that, run the test program with the <code class="docutils literal notranslate"><span class="pre">--gtest_print_time=0</span></code> command line flag, or
set the GTEST_PRINT_TIME environment variable to <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
</div>
<div class="section" id="suppressing-utf-8-text-output">
<h4>Suppressing UTF-8 Text Output<a class="headerlink" href="#suppressing-utf-8-text-output" title="Permalink to this headline">¶</a></h4>
<p>In case of assertion failures, googletest prints expected and actual values of
type <code class="docutils literal notranslate"><span class="pre">string</span></code> both as hex-encoded strings as well as in readable UTF-8 text if
they contain valid non-ASCII UTF-8 characters. If you want to suppress the UTF-8
text because, for example, you don’t have an UTF-8 compatible output medium, run
the test program with <code class="docutils literal notranslate"><span class="pre">--gtest_print_utf8=0</span></code> or set the <code class="docutils literal notranslate"><span class="pre">GTEST_PRINT_UTF8</span></code>
environment variable to <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
</div>
<div class="section" id="generating-an-xml-report">
<h4>Generating an XML Report<a class="headerlink" href="#generating-an-xml-report" title="Permalink to this headline">¶</a></h4>
<p>googletest can emit a detailed XML report to a file in addition to its normal
textual output. The report contains the duration of each test, and thus can help
you identify slow tests.</p>
<p>To generate the XML report, set the <code class="docutils literal notranslate"><span class="pre">GTEST_OUTPUT</span></code> environment variable or the
<code class="docutils literal notranslate"><span class="pre">--gtest_output</span></code> flag to the string <code class="docutils literal notranslate"><span class="pre">&quot;xml:path_to_output_file&quot;</span></code>, which will
create the file at the given location. You can also just use the string <code class="docutils literal notranslate"><span class="pre">&quot;xml&quot;</span></code>,
in which case the output can be found in the <code class="docutils literal notranslate"><span class="pre">test_detail.xml</span></code> file in the
current directory.</p>
<p>If you specify a directory (for example, <code class="docutils literal notranslate"><span class="pre">&quot;xml:output/directory/&quot;</span></code> on Linux or
<code class="docutils literal notranslate"><span class="pre">&quot;xml:output\directory\&quot;</span></code> on Windows), googletest will create the XML file in
that directory, named after the test executable (e.g. <code class="docutils literal notranslate"><span class="pre">foo_test.xml</span></code> for test
program <code class="docutils literal notranslate"><span class="pre">foo_test</span></code> or <code class="docutils literal notranslate"><span class="pre">foo_test.exe</span></code>). If the file already exists (perhaps left
over from a previous run), googletest will pick a different name (e.g.
<code class="docutils literal notranslate"><span class="pre">foo_test_1.xml</span></code>) to avoid overwriting it.</p>
<p>The report is based on the <code class="docutils literal notranslate"><span class="pre">junitreport</span></code> Ant task. Since that format was
originally intended for Java, a little interpretation is required to make it
apply to googletest tests, as shown here:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span>&lt;testsuites name=&quot;AllTests&quot; ...&gt;
  &lt;testsuite name=&quot;test_case_name&quot; ...&gt;
    &lt;testcase    name=&quot;test_name&quot; ...&gt;
      &lt;failure message=&quot;...&quot;/&gt;
      &lt;failure message=&quot;...&quot;/&gt;
      &lt;failure message=&quot;...&quot;/&gt;
    &lt;/testcase&gt;
  &lt;/testsuite&gt;
&lt;/testsuites&gt;
</pre></div>
</div>
<ul class="simple">
<li><p>The root <code class="docutils literal notranslate"><span class="pre">&lt;testsuites&gt;</span></code> element corresponds to the entire test program.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;testsuite&gt;</span></code> elements correspond to googletest test suites.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;testcase&gt;</span></code> elements correspond to googletest test functions.</p></li>
</ul>
<p>For instance, the following program</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">TEST</span><span class="p">(</span><span class="n">MathTest</span><span class="p">,</span> <span class="n">Addition</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">TEST</span><span class="p">(</span><span class="n">MathTest</span><span class="p">,</span> <span class="n">Subtraction</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">TEST</span><span class="p">(</span><span class="n">LogicTest</span><span class="p">,</span> <span class="n">NonContradiction</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>could generate this report:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;testsuites</span> <span class="na">tests=</span><span class="s">&quot;3&quot;</span> <span class="na">failures=</span><span class="s">&quot;1&quot;</span> <span class="na">errors=</span><span class="s">&quot;0&quot;</span> <span class="na">time=</span><span class="s">&quot;0.035&quot;</span> <span class="na">timestamp=</span><span class="s">&quot;2011-10-31T18:52:42&quot;</span> <span class="na">name=</span><span class="s">&quot;AllTests&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;testsuite</span> <span class="na">name=</span><span class="s">&quot;MathTest&quot;</span> <span class="na">tests=</span><span class="s">&quot;2&quot;</span> <span class="na">failures=</span><span class="s">&quot;1&quot;</span> <span class="na">errors=</span><span class="s">&quot;0&quot;</span> <span class="na">time=</span><span class="s">&quot;0.015&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;testcase</span> <span class="na">name=</span><span class="s">&quot;Addition&quot;</span> <span class="na">status=</span><span class="s">&quot;run&quot;</span> <span class="na">time=</span><span class="s">&quot;0.007&quot;</span> <span class="na">classname=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;failure</span> <span class="na">message=</span><span class="s">&quot;Value of: add(1, 1)&amp;#x0A;  Actual: 3&amp;#x0A;Expected: 2&quot;</span> <span class="na">type=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>...<span class="nt">&lt;/failure&gt;</span>
      <span class="nt">&lt;failure</span> <span class="na">message=</span><span class="s">&quot;Value of: add(1, -1)&amp;#x0A;  Actual: 1&amp;#x0A;Expected: 0&quot;</span> <span class="na">type=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>...<span class="nt">&lt;/failure&gt;</span>
    <span class="nt">&lt;/testcase&gt;</span>
    <span class="nt">&lt;testcase</span> <span class="na">name=</span><span class="s">&quot;Subtraction&quot;</span> <span class="na">status=</span><span class="s">&quot;run&quot;</span> <span class="na">time=</span><span class="s">&quot;0.005&quot;</span> <span class="na">classname=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/testcase&gt;</span>
  <span class="nt">&lt;/testsuite&gt;</span>
  <span class="nt">&lt;testsuite</span> <span class="na">name=</span><span class="s">&quot;LogicTest&quot;</span> <span class="na">tests=</span><span class="s">&quot;1&quot;</span> <span class="na">failures=</span><span class="s">&quot;0&quot;</span> <span class="na">errors=</span><span class="s">&quot;0&quot;</span> <span class="na">time=</span><span class="s">&quot;0.005&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;testcase</span> <span class="na">name=</span><span class="s">&quot;NonContradiction&quot;</span> <span class="na">status=</span><span class="s">&quot;run&quot;</span> <span class="na">time=</span><span class="s">&quot;0.005&quot;</span> <span class="na">classname=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/testcase&gt;</span>
  <span class="nt">&lt;/testsuite&gt;</span>
<span class="nt">&lt;/testsuites&gt;</span>
</pre></div>
</div>
<p>Things to note:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">tests</span></code> attribute of a <code class="docutils literal notranslate"><span class="pre">&lt;testsuites&gt;</span></code> or <code class="docutils literal notranslate"><span class="pre">&lt;testsuite&gt;</span></code> element tells how
many test functions the googletest program or test suite contains, while the
<code class="docutils literal notranslate"><span class="pre">failures</span></code> attribute tells how many of them failed.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">time</span></code> attribute expresses the duration of the test, test suite, or
entire test program in seconds.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">timestamp</span></code> attribute records the local date and time of the test
execution.</p></li>
<li><p>Each <code class="docutils literal notranslate"><span class="pre">&lt;failure&gt;</span></code> element corresponds to a single failed googletest
assertion.</p></li>
</ul>
</div>
<div class="section" id="generating-a-json-report">
<h4>Generating a JSON Report<a class="headerlink" href="#generating-a-json-report" title="Permalink to this headline">¶</a></h4>
<p>googletest can also emit a JSON report as an alternative format to XML. To
generate the JSON report, set the <code class="docutils literal notranslate"><span class="pre">GTEST_OUTPUT</span></code> environment variable or the
<code class="docutils literal notranslate"><span class="pre">--gtest_output</span></code> flag to the string <code class="docutils literal notranslate"><span class="pre">&quot;json:path_to_output_file&quot;</span></code>, which will
create the file at the given location. You can also just use the string
<code class="docutils literal notranslate"><span class="pre">&quot;json&quot;</span></code>, in which case the output can be found in the <code class="docutils literal notranslate"><span class="pre">test_detail.json</span></code> file
in the current directory.</p>
<p>The report format conforms to the following JSON Schema:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;$schema&quot;</span><span class="p">:</span> <span class="s2">&quot;http://json-schema.org/schema#&quot;</span><span class="p">,</span>
  <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
  <span class="nt">&quot;definitions&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;TestCase&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
      <span class="nt">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span> <span class="p">},</span>
        <span class="nt">&quot;tests&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span> <span class="p">},</span>
        <span class="nt">&quot;failures&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span> <span class="p">},</span>
        <span class="nt">&quot;disabled&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span> <span class="p">},</span>
        <span class="nt">&quot;time&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span> <span class="p">},</span>
        <span class="nt">&quot;testsuite&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;array&quot;</span><span class="p">,</span>
          <span class="nt">&quot;items&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;$ref&quot;</span><span class="p">:</span> <span class="s2">&quot;#/definitions/TestInfo&quot;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&quot;TestInfo&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
      <span class="nt">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span> <span class="p">},</span>
        <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
          <span class="nt">&quot;enum&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;RUN&quot;</span><span class="p">,</span> <span class="s2">&quot;NOTRUN&quot;</span><span class="p">]</span>
        <span class="p">},</span>
        <span class="nt">&quot;time&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span> <span class="p">},</span>
        <span class="nt">&quot;classname&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span> <span class="p">},</span>
        <span class="nt">&quot;failures&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;array&quot;</span><span class="p">,</span>
          <span class="nt">&quot;items&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;$ref&quot;</span><span class="p">:</span> <span class="s2">&quot;#/definitions/Failure&quot;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&quot;Failure&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
      <span class="nt">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;failures&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span> <span class="p">},</span>
        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span> <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;tests&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span> <span class="p">},</span>
    <span class="nt">&quot;failures&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span> <span class="p">},</span>
    <span class="nt">&quot;disabled&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span> <span class="p">},</span>
    <span class="nt">&quot;errors&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span> <span class="p">},</span>
    <span class="nt">&quot;timestamp&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
      <span class="nt">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;date-time&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;time&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span> <span class="p">},</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span> <span class="p">},</span>
    <span class="nt">&quot;testsuites&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;array&quot;</span><span class="p">,</span>
      <span class="nt">&quot;items&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;$ref&quot;</span><span class="p">:</span> <span class="s2">&quot;#/definitions/TestCase&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The report uses the format that conforms to the following Proto3 using the
<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto3#json">JSON encoding</a>:</p>
<div class="highlight-proto notranslate"><div class="highlight"><pre><span></span><span class="na">syntax</span> <span class="o">=</span> <span class="s">&quot;proto3&quot;</span><span class="p">;</span>

<span class="kn">package</span> <span class="nn">googletest</span><span class="p">;</span>

<span class="k">import</span> <span class="s">&quot;google/protobuf/timestamp.proto&quot;</span><span class="p">;</span>
<span class="k">import</span> <span class="s">&quot;google/protobuf/duration.proto&quot;</span><span class="p">;</span>

<span class="kd">message</span> <span class="nc">UnitTest</span> <span class="p">{</span>
  <span class="kt">int32</span> <span class="na">tests</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">int32</span> <span class="na">failures</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="kt">int32</span> <span class="na">disabled</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="kt">int32</span> <span class="na">errors</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
  <span class="n">google.protobuf.Timestamp</span> <span class="na">timestamp</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
  <span class="n">google.protobuf.Duration</span> <span class="na">time</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
  <span class="kt">string</span> <span class="na">name</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
  <span class="k">repeated</span> <span class="n">TestCase</span> <span class="na">testsuites</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span> <span class="nc">TestCase</span> <span class="p">{</span>
  <span class="kt">string</span> <span class="na">name</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">int32</span> <span class="na">tests</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="kt">int32</span> <span class="na">failures</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="kt">int32</span> <span class="na">disabled</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
  <span class="kt">int32</span> <span class="na">errors</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
  <span class="n">google.protobuf.Duration</span> <span class="na">time</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
  <span class="k">repeated</span> <span class="n">TestInfo</span> <span class="na">testsuite</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span> <span class="nc">TestInfo</span> <span class="p">{</span>
  <span class="kt">string</span> <span class="na">name</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kd">enum</span> <span class="n">Status</span> <span class="p">{</span>
    <span class="na">RUN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="na">NOTRUN</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">Status</span> <span class="na">status</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="n">google.protobuf.Duration</span> <span class="na">time</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="kt">string</span> <span class="na">classname</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
  <span class="kd">message</span> <span class="nc">Failure</span> <span class="p">{</span>
    <span class="kt">string</span> <span class="na">failures</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">string</span> <span class="na">type</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">repeated</span> <span class="n">Failure</span> <span class="na">failures</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For instance, the following program</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">TEST</span><span class="p">(</span><span class="n">MathTest</span><span class="p">,</span> <span class="n">Addition</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">TEST</span><span class="p">(</span><span class="n">MathTest</span><span class="p">,</span> <span class="n">Subtraction</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">TEST</span><span class="p">(</span><span class="n">LogicTest</span><span class="p">,</span> <span class="n">NonContradiction</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>could generate this report:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;tests&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
  <span class="nt">&quot;failures&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nt">&quot;errors&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="nt">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;0.035s&quot;</span><span class="p">,</span>
  <span class="nt">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2011-10-31T18:52:42Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;AllTests&quot;</span><span class="p">,</span>
  <span class="nt">&quot;testsuites&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;MathTest&quot;</span><span class="p">,</span>
      <span class="nt">&quot;tests&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="nt">&quot;failures&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="nt">&quot;errors&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nt">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;0.015s&quot;</span><span class="p">,</span>
      <span class="nt">&quot;testsuite&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Addition&quot;</span><span class="p">,</span>
          <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;RUN&quot;</span><span class="p">,</span>
          <span class="nt">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;0.007s&quot;</span><span class="p">,</span>
          <span class="nt">&quot;classname&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
          <span class="nt">&quot;failures&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
              <span class="nt">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Value of: add(1, 1)\n  Actual: 3\nExpected: 2&quot;</span><span class="p">,</span>
              <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
            <span class="p">},</span>
            <span class="p">{</span>
              <span class="nt">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Value of: add(1, -1)\n  Actual: 1\nExpected: 0&quot;</span><span class="p">,</span>
              <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
            <span class="p">}</span>
          <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Subtraction&quot;</span><span class="p">,</span>
          <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;RUN&quot;</span><span class="p">,</span>
          <span class="nt">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;0.005s&quot;</span><span class="p">,</span>
          <span class="nt">&quot;classname&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;LogicTest&quot;</span><span class="p">,</span>
      <span class="nt">&quot;tests&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="nt">&quot;failures&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nt">&quot;errors&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nt">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;0.005s&quot;</span><span class="p">,</span>
      <span class="nt">&quot;testsuite&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;NonContradiction&quot;</span><span class="p">,</span>
          <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;RUN&quot;</span><span class="p">,</span>
          <span class="nt">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;0.005s&quot;</span><span class="p">,</span>
          <span class="nt">&quot;classname&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>{: .callout .important}
IMPORTANT: The exact format of the JSON document is subject to change.</p>
</div>
</div>
<div class="section" id="controlling-how-failures-are-reported">
<h3>Controlling How Failures Are Reported<a class="headerlink" href="#controlling-how-failures-are-reported" title="Permalink to this headline">¶</a></h3>
<div class="section" id="detecting-test-premature-exit">
<h4>Detecting Test Premature Exit<a class="headerlink" href="#detecting-test-premature-exit" title="Permalink to this headline">¶</a></h4>
<p>Google Test implements the <em>premature-exit-file</em> protocol for test runners to
catch any kind of unexpected exits of test programs. Upon start, Google Test
creates the file which will be automatically deleted after all work has been
finished. Then, the test runner can check if this file exists. In case the file
remains undeleted, the inspected test has exited prematurely.</p>
<p>This feature is enabled only if the <code class="docutils literal notranslate"><span class="pre">TEST_PREMATURE_EXIT_FILE</span></code> environment
variable has been set.</p>
</div>
<div class="section" id="turning-assertion-failures-into-break-points">
<h4>Turning Assertion Failures into Break-Points<a class="headerlink" href="#turning-assertion-failures-into-break-points" title="Permalink to this headline">¶</a></h4>
<p>When running test programs under a debugger, it’s very convenient if the
debugger can catch an assertion failure and automatically drop into interactive
mode. googletest’s <em>break-on-failure</em> mode supports this behavior.</p>
<p>To enable it, set the <code class="docutils literal notranslate"><span class="pre">GTEST_BREAK_ON_FAILURE</span></code> environment variable to a value
other than <code class="docutils literal notranslate"><span class="pre">0</span></code>. Alternatively, you can use the <code class="docutils literal notranslate"><span class="pre">--gtest_break_on_failure</span></code>
command line flag.</p>
</div>
<div class="section" id="disabling-catching-test-thrown-exceptions">
<h4>Disabling Catching Test-Thrown Exceptions<a class="headerlink" href="#disabling-catching-test-thrown-exceptions" title="Permalink to this headline">¶</a></h4>
<p>googletest can be used either with or without exceptions enabled. If a test
throws a C++ exception or (on Windows) a structured exception (SEH), by default
googletest catches it, reports it as a test failure, and continues with the next
test method. This maximizes the coverage of a test run. Also, on Windows an
uncaught exception will cause a pop-up window, so catching the exceptions allows
you to run the tests automatically.</p>
<p>When debugging the test failures, however, you may instead want the exceptions
to be handled by the debugger, such that you can examine the call stack when an
exception is thrown. To achieve that, set the <code class="docutils literal notranslate"><span class="pre">GTEST_CATCH_EXCEPTIONS</span></code>
environment variable to <code class="docutils literal notranslate"><span class="pre">0</span></code>, or use the <code class="docutils literal notranslate"><span class="pre">--gtest_catch_exceptions=0</span></code> flag when
running the tests.</p>
</div>
</div>
<div class="section" id="sanitizer-integration">
<h3>Sanitizer Integration<a class="headerlink" href="#sanitizer-integration" title="Permalink to this headline">¶</a></h3>
<p>The
<a class="reference external" href="https://clang.llvm.org/docs/UndefinedBehaviorSanitizer.html">Undefined Behavior Sanitizer</a>,
<a class="reference external" href="https://github.com/google/sanitizers/wiki/AddressSanitizer">Address Sanitizer</a>,
and
<a class="reference external" href="https://github.com/google/sanitizers/wiki/ThreadSanitizerCppManual">Thread Sanitizer</a>
all provide weak functions that you can override to trigger explicit failures
when they detect sanitizer errors, such as creating a reference from <code class="docutils literal notranslate"><span class="pre">nullptr</span></code>.
To override these functions, place definitions for them in a source file that
you compile as part of your main binary:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">extern</span> <span class="s2">&quot;C&quot;</span> <span class="p">{</span>
<span class="n">void</span> <span class="n">__ubsan_on_report</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">FAIL</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;Encountered an undefined behavior sanitizer error&quot;</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">void</span> <span class="n">__asan_on_error</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">FAIL</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;Encountered an address sanitizer error&quot;</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">void</span> <span class="n">__tsan_on_report</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">FAIL</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;Encountered a thread sanitizer error&quot;</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">}</span>  <span class="o">//</span> <span class="n">extern</span> <span class="s2">&quot;C&quot;</span>
</pre></div>
</div>
<p>After compiling your project with one of the sanitizers enabled, if a particular
test triggers a sanitizer error, googletest will report that it failed.</p>
</div>
</div>
</div>


                        
                    </div>
                </div>
            </div>
        </div>
    </div>    


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../',
            VERSION:'1.0.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
    <script type="text/javascript" src="../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/clipboard.min.js"></script>
    <script type="text/javascript" src="../../../../_static/copybutton.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>
  
    <div class="footer" role="contentinfo">
        <div class="container">
            &#169; Copyright bladedisc-dev@list.alibaba-inc.com.
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.3.2.
        </div>
    </div>  

</body>
</html>