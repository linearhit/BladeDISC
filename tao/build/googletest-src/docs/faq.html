

<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Googletest FAQ &mdash; BladeDISC 1.0.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../../_static/css/theme.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/theme.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/copybutton.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 

</head>

<body>
    <header>
        <div class="container">
            <a class="site-nav-toggle hidden-lg-up"><i class="icon-menu"></i></a>
            <a class="site-title" href="../../../../index.html">
                BladeDISC
            </a>
        </div>
    </header>


<div class="breadcrumbs-outer hidden-xs-down">
    <div class="container">
        















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a></li>
        
      <li>Googletest FAQ</li>
    
    
      <li class="breadcrumbs-aside">
        
            
            <a href="../../../../_sources/tao/build/googletest-src/docs/faq.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>
</div>
    </div>
</div>
    <div class="main-outer">
        <div class="container">
            <div class="row">
                <div class="col-12 col-lg-3 site-nav">
                    
<div role="search">
    <form class="search" action="../../../../search.html" method="get">
        <div class="icon-input">
            <input type="text" name="q" placeholder="Search" />
            <span class="icon-search"></span>
        </div>
        <input type="submit" value="Go" class="d-hidden" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
    </form>
</div>
                    <div class="site-nav-tree">
                        
                            
                            
                                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../README_.html">BladeDISC Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../README_.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../README_.html#api-quickview">API QuickView</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../README_.html#for-pytorch-users">For PyTorch Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../README_.html#setup-and-examples">Setup and Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../README_.html#publications">Publications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../README_.html#tutorials-and-documents-for-developers">Tutorials and Documents for Developers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../README_.html#how-to-contribute">How to Contribute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../README_.html#faq">FAQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../README_.html#contact-us">Contact Us</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../docs/install_with_docker.html">Install with Docker</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../docs/install_with_docker.html#download-a-bladedisc-docker-image">Download a BladeDISC Docker Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../docs/install_with_docker.html#start-a-docker-container">Start a Docker Container</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../docs/build_from_source.html">Build from Source</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../docs/build_from_source.html#prerequisite">Prerequisite</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../docs/build_from_source.html#checkout-the-source">Checkout the Source</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../docs/build_from_source.html#building-bladedisc-for-tensorflow-users">Building BladeDISC for TensorFlow Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../docs/build_from_source.html#building-bladedisc-for-pytorch-users">Building BladeDISC for PyTorch Users</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../docs/quickstart.html">Quickstart for TensorFlow/PyTorch users</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../docs/quickstart.html#quickstart-for-tensorflow-users">Quickstart for TensorFlow Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../docs/quickstart.html#quickstart-for-pytorch-users">Quickstart for PyTorch Users</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../docs/contribution.html">How to Contribute</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../docs/contribution.html#local-development-environment">Local Development Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../docs/contribution.html#submit-a-pull-request-to-bladedisc">Submit a Pull Request to BladeDISC</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../docs/developers/index.html">Documentation for Developers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../docs/developers/pass_pipeline.html">Tutorial: A Walkthough of the BladeDISC Pass Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../docs/developers/runtime_abstraction_layer.html">Runtime Abstraction Layer Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../docs/developers/bladedisc_torch_overview.html">BladeDISC Torch Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../docs/developers/torch_add_a_new_converter.html">Tutorial: How to add the support of a new Torch Op</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../docs/tutorials/index.html">Tutorials on Example Use Cases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../docs/tutorials/tensorflow_inference_and_training.html">Use case of TensorFlow Inference and Training</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../docs/tutorials/torch_bert_inference.html">Use case of PyTorch Inference</a></li>
</ul>
</li>
</ul>

                            
                        
                    </div>
                </div>
                <div class="col-12 col-lg-9">
                    <div class="document">
                        
                            
  <div class="section" id="googletest-faq">
<h1>Googletest FAQ<a class="headerlink" href="#googletest-faq" title="Permalink to this headline">¶</a></h1>
<div class="section" id="why-should-test-suite-names-and-test-names-not-contain-underscore">
<h2>Why should test suite names and test names not contain underscore?<a class="headerlink" href="#why-should-test-suite-names-and-test-names-not-contain-underscore" title="Permalink to this headline">¶</a></h2>
<p>{: .callout .note}
Note: Googletest reserves underscore (<code class="docutils literal notranslate"><span class="pre">_</span></code>) for special purpose keywords, such as
<a class="reference internal" href="advanced.html#temporarily-disabling-tests"><span class="std std-ref">the DISABLED_ prefix</span></a>, in addition
to the following rationale.</p>
<p>Underscore (<code class="docutils literal notranslate"><span class="pre">_</span></code>) is special, as C++ reserves the following to be used by the
compiler and the standard library:</p>
<ol class="simple">
<li><p>any identifier that starts with an <code class="docutils literal notranslate"><span class="pre">_</span></code> followed by an upper-case letter, and</p></li>
<li><p>any identifier that contains two consecutive underscores (i.e. <code class="docutils literal notranslate"><span class="pre">__</span></code>)
<em>anywhere</em> in its name.</p></li>
</ol>
<p>User code is <em>prohibited</em> from using such identifiers.</p>
<p>Now let’s look at what this means for <code class="docutils literal notranslate"><span class="pre">TEST</span></code> and <code class="docutils literal notranslate"><span class="pre">TEST_F</span></code>.</p>
<p>Currently <code class="docutils literal notranslate"><span class="pre">TEST(TestSuiteName,</span> <span class="pre">TestName)</span></code> generates a class named
<code class="docutils literal notranslate"><span class="pre">TestSuiteName_TestName_Test</span></code>. What happens if <code class="docutils literal notranslate"><span class="pre">TestSuiteName</span></code> or <code class="docutils literal notranslate"><span class="pre">TestName</span></code>
contains <code class="docutils literal notranslate"><span class="pre">_</span></code>?</p>
<ol class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">TestSuiteName</span></code> starts with an <code class="docutils literal notranslate"><span class="pre">_</span></code> followed by an upper-case letter (say,
<code class="docutils literal notranslate"><span class="pre">_Foo</span></code>), we end up with <code class="docutils literal notranslate"><span class="pre">_Foo_TestName_Test</span></code>, which is reserved and thus
invalid.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">TestSuiteName</span></code> ends with an <code class="docutils literal notranslate"><span class="pre">_</span></code> (say, <code class="docutils literal notranslate"><span class="pre">Foo_</span></code>), we get
<code class="docutils literal notranslate"><span class="pre">Foo__TestName_Test</span></code>, which is invalid.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">TestName</span></code> starts with an <code class="docutils literal notranslate"><span class="pre">_</span></code> (say, <code class="docutils literal notranslate"><span class="pre">_Bar</span></code>), we get
<code class="docutils literal notranslate"><span class="pre">TestSuiteName__Bar_Test</span></code>, which is invalid.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">TestName</span></code> ends with an <code class="docutils literal notranslate"><span class="pre">_</span></code> (say, <code class="docutils literal notranslate"><span class="pre">Bar_</span></code>), we get
<code class="docutils literal notranslate"><span class="pre">TestSuiteName_Bar__Test</span></code>, which is invalid.</p></li>
</ol>
<p>So clearly <code class="docutils literal notranslate"><span class="pre">TestSuiteName</span></code> and <code class="docutils literal notranslate"><span class="pre">TestName</span></code> cannot start or end with <code class="docutils literal notranslate"><span class="pre">_</span></code>
(Actually, <code class="docutils literal notranslate"><span class="pre">TestSuiteName</span></code> can start with <code class="docutils literal notranslate"><span class="pre">_</span></code> – as long as the <code class="docutils literal notranslate"><span class="pre">_</span></code> isn’t
followed by an upper-case letter. But that’s getting complicated. So for
simplicity we just say that it cannot start with <code class="docutils literal notranslate"><span class="pre">_</span></code>.).</p>
<p>It may seem fine for <code class="docutils literal notranslate"><span class="pre">TestSuiteName</span></code> and <code class="docutils literal notranslate"><span class="pre">TestName</span></code> to contain <code class="docutils literal notranslate"><span class="pre">_</span></code> in the
middle. However, consider this:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">TEST</span><span class="p">(</span><span class="n">Time</span><span class="p">,</span> <span class="n">Flies_Like_An_Arrow</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">TEST</span><span class="p">(</span><span class="n">Time_Flies</span><span class="p">,</span> <span class="n">Like_An_Arrow</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>Now, the two <code class="docutils literal notranslate"><span class="pre">TEST</span></code>s will both generate the same class
(<code class="docutils literal notranslate"><span class="pre">Time_Flies_Like_An_Arrow_Test</span></code>). That’s not good.</p>
<p>So for simplicity, we just ask the users to avoid <code class="docutils literal notranslate"><span class="pre">_</span></code> in <code class="docutils literal notranslate"><span class="pre">TestSuiteName</span></code> and
<code class="docutils literal notranslate"><span class="pre">TestName</span></code>. The rule is more constraining than necessary, but it’s simple and
easy to remember. It also gives googletest some wiggle room in case its
implementation needs to change in the future.</p>
<p>If you violate the rule, there may not be immediate consequences, but your test
may (just may) break with a new compiler (or a new version of the compiler you
are using) or with a new version of googletest. Therefore it’s best to follow
the rule.</p>
</div>
<div class="section" id="why-does-googletest-support-expect-eq-null-ptr-and-assert-eq-null-ptr-but-not-expect-ne-null-ptr-and-assert-ne-null-ptr">
<h2>Why does googletest support <code class="docutils literal notranslate"><span class="pre">EXPECT_EQ(NULL,</span> <span class="pre">ptr)</span></code> and <code class="docutils literal notranslate"><span class="pre">ASSERT_EQ(NULL,</span> <span class="pre">ptr)</span></code> but not <code class="docutils literal notranslate"><span class="pre">EXPECT_NE(NULL,</span> <span class="pre">ptr)</span></code> and <code class="docutils literal notranslate"><span class="pre">ASSERT_NE(NULL,</span> <span class="pre">ptr)</span></code>?<a class="headerlink" href="#why-does-googletest-support-expect-eq-null-ptr-and-assert-eq-null-ptr-but-not-expect-ne-null-ptr-and-assert-ne-null-ptr" title="Permalink to this headline">¶</a></h2>
<p>First of all, you can use <code class="docutils literal notranslate"><span class="pre">nullptr</span></code> with each of these macros, e.g.
<code class="docutils literal notranslate"><span class="pre">EXPECT_EQ(ptr,</span> <span class="pre">nullptr)</span></code>, <code class="docutils literal notranslate"><span class="pre">EXPECT_NE(ptr,</span> <span class="pre">nullptr)</span></code>, <code class="docutils literal notranslate"><span class="pre">ASSERT_EQ(ptr,</span> <span class="pre">nullptr)</span></code>,
<code class="docutils literal notranslate"><span class="pre">ASSERT_NE(ptr,</span> <span class="pre">nullptr)</span></code>. This is the preferred syntax in the style guide
because <code class="docutils literal notranslate"><span class="pre">nullptr</span></code> does not have the type problems that <code class="docutils literal notranslate"><span class="pre">NULL</span></code> does.</p>
<p>Due to some peculiarity of C++, it requires some non-trivial template meta
programming tricks to support using <code class="docutils literal notranslate"><span class="pre">NULL</span></code> as an argument of the <code class="docutils literal notranslate"><span class="pre">EXPECT_XX()</span></code>
and <code class="docutils literal notranslate"><span class="pre">ASSERT_XX()</span></code> macros. Therefore we only do it where it’s most needed
(otherwise we make the implementation of googletest harder to maintain and more
error-prone than necessary).</p>
<p>Historically, the <code class="docutils literal notranslate"><span class="pre">EXPECT_EQ()</span></code> macro took the <em>expected</em> value as its first
argument and the <em>actual</em> value as the second, though this argument order is now
discouraged. It was reasonable that someone wanted
to write <code class="docutils literal notranslate"><span class="pre">EXPECT_EQ(NULL,</span> <span class="pre">some_expression)</span></code>, and this indeed was requested
several times. Therefore we implemented it.</p>
<p>The need for <code class="docutils literal notranslate"><span class="pre">EXPECT_NE(NULL,</span> <span class="pre">ptr)</span></code> wasn’t nearly as strong. When the assertion
fails, you already know that <code class="docutils literal notranslate"><span class="pre">ptr</span></code> must be <code class="docutils literal notranslate"><span class="pre">NULL</span></code>, so it doesn’t add any
information to print <code class="docutils literal notranslate"><span class="pre">ptr</span></code> in this case. That means <code class="docutils literal notranslate"><span class="pre">EXPECT_TRUE(ptr</span> <span class="pre">!=</span> <span class="pre">NULL)</span></code>
works just as well.</p>
<p>If we were to support <code class="docutils literal notranslate"><span class="pre">EXPECT_NE(NULL,</span> <span class="pre">ptr)</span></code>, for consistency we’d have to
support <code class="docutils literal notranslate"><span class="pre">EXPECT_NE(ptr,</span> <span class="pre">NULL)</span></code> as well. This means using the template meta
programming tricks twice in the implementation, making it even harder to
understand and maintain. We believe the benefit doesn’t justify the cost.</p>
<p>Finally, with the growth of the gMock matcher library, we are encouraging people
to use the unified <code class="docutils literal notranslate"><span class="pre">EXPECT_THAT(value,</span> <span class="pre">matcher)</span></code> syntax more often in tests. One
significant advantage of the matcher approach is that matchers can be easily
combined to form new matchers, while the <code class="docutils literal notranslate"><span class="pre">EXPECT_NE</span></code>, etc, macros cannot be
easily combined. Therefore we want to invest more in the matchers than in the
<code class="docutils literal notranslate"><span class="pre">EXPECT_XX()</span></code> macros.</p>
</div>
<div class="section" id="i-need-to-test-that-different-implementations-of-an-interface-satisfy-some-common-requirements-should-i-use-typed-tests-or-value-parameterized-tests">
<h2>I need to test that different implementations of an interface satisfy some common requirements. Should I use typed tests or value-parameterized tests?<a class="headerlink" href="#i-need-to-test-that-different-implementations-of-an-interface-satisfy-some-common-requirements-should-i-use-typed-tests-or-value-parameterized-tests" title="Permalink to this headline">¶</a></h2>
<p>For testing various implementations of the same interface, either typed tests or
value-parameterized tests can get it done. It’s really up to you the user to
decide which is more convenient for you, depending on your particular case. Some
rough guidelines:</p>
<ul class="simple">
<li><p>Typed tests can be easier to write if instances of the different
implementations can be created the same way, modulo the type. For example,
if all these implementations have a public default constructor (such that
you can write <code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">TypeParam</span></code>), or if their factory functions have the same
form (e.g. <code class="docutils literal notranslate"><span class="pre">CreateInstance&lt;TypeParam&gt;()</span></code>).</p></li>
<li><p>Value-parameterized tests can be easier to write if you need different code
patterns to create different implementations’ instances, e.g. <code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">Foo</span></code> vs
<code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">Bar(5)</span></code>. To accommodate for the differences, you can write factory
function wrappers and pass these function pointers to the tests as their
parameters.</p></li>
<li><p>When a typed test fails, the default output includes the name of the type,
which can help you quickly identify which implementation is wrong.
Value-parameterized tests only show the number of the failed iteration by
default. You will need to define a function that returns the iteration name
and pass it as the third parameter to INSTANTIATE_TEST_SUITE_P to have more
useful output.</p></li>
<li><p>When using typed tests, you need to make sure you are testing against the
interface type, not the concrete types (in other words, you want to make
sure <code class="docutils literal notranslate"><span class="pre">implicit_cast&lt;MyInterface*&gt;(my_concrete_impl)</span></code> works, not just that
<code class="docutils literal notranslate"><span class="pre">my_concrete_impl</span></code> works). It’s less likely to make mistakes in this area
when using value-parameterized tests.</p></li>
</ul>
<p>I hope I didn’t confuse you more. :-) If you don’t mind, I’d suggest you to give
both approaches a try. Practice is a much better way to grasp the subtle
differences between the two tools. Once you have some concrete experience, you
can much more easily decide which one to use the next time.</p>
</div>
<div class="section" id="i-got-some-run-time-errors-about-invalid-proto-descriptors-when-using-protocolmessageequals-help">
<h2>I got some run-time errors about invalid proto descriptors when using <code class="docutils literal notranslate"><span class="pre">ProtocolMessageEquals</span></code>. Help!<a class="headerlink" href="#i-got-some-run-time-errors-about-invalid-proto-descriptors-when-using-protocolmessageequals-help" title="Permalink to this headline">¶</a></h2>
<p>{: .callout .note}
<strong>Note:</strong> <code class="docutils literal notranslate"><span class="pre">ProtocolMessageEquals</span></code> and <code class="docutils literal notranslate"><span class="pre">ProtocolMessageEquiv</span></code> are <em>deprecated</em>
now. Please use <code class="docutils literal notranslate"><span class="pre">EqualsProto</span></code>, etc instead.</p>
<p><code class="docutils literal notranslate"><span class="pre">ProtocolMessageEquals</span></code> and <code class="docutils literal notranslate"><span class="pre">ProtocolMessageEquiv</span></code> were redefined recently and
are now less tolerant of invalid protocol buffer definitions. In particular, if
you have a <code class="docutils literal notranslate"><span class="pre">foo.proto</span></code> that doesn’t fully qualify the type of a protocol message
it references (e.g. <code class="docutils literal notranslate"><span class="pre">message&lt;Bar&gt;</span></code> where it should be <code class="docutils literal notranslate"><span class="pre">message&lt;blah.Bar&gt;</span></code>), you
will now get run-time errors like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span> <span class="n">descriptor</span><span class="o">.</span><span class="n">cc</span><span class="p">:</span><span class="o">...</span><span class="p">]</span> <span class="n">Invalid</span> <span class="n">proto</span> <span class="n">descriptor</span> <span class="k">for</span> <span class="n">file</span> <span class="s2">&quot;path/to/foo.proto&quot;</span><span class="p">:</span>
<span class="o">...</span> <span class="n">descriptor</span><span class="o">.</span><span class="n">cc</span><span class="p">:</span><span class="o">...</span><span class="p">]</span>  <span class="n">blah</span><span class="o">.</span><span class="n">MyMessage</span><span class="o">.</span><span class="n">my_field</span><span class="p">:</span> <span class="s2">&quot;.Bar&quot;</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">defined</span><span class="o">.</span>
</pre></div>
</div>
<p>If you see this, your <code class="docutils literal notranslate"><span class="pre">.proto</span></code> file is broken and needs to be fixed by making
the types fully qualified. The new definition of <code class="docutils literal notranslate"><span class="pre">ProtocolMessageEquals</span></code> and
<code class="docutils literal notranslate"><span class="pre">ProtocolMessageEquiv</span></code> just happen to reveal your bug.</p>
</div>
<div class="section" id="my-death-test-modifies-some-state-but-the-change-seems-lost-after-the-death-test-finishes-why">
<h2>My death test modifies some state, but the change seems lost after the death test finishes. Why?<a class="headerlink" href="#my-death-test-modifies-some-state-but-the-change-seems-lost-after-the-death-test-finishes-why" title="Permalink to this headline">¶</a></h2>
<p>Death tests (<code class="docutils literal notranslate"><span class="pre">EXPECT_DEATH</span></code>, etc) are executed in a sub-process s.t. the
expected crash won’t kill the test program (i.e. the parent process). As a
result, any in-memory side effects they incur are observable in their respective
sub-processes, but not in the parent process. You can think of them as running
in a parallel universe, more or less.</p>
<p>In particular, if you use mocking and the death test statement invokes some mock
methods, the parent process will think the calls have never occurred. Therefore,
you may want to move your <code class="docutils literal notranslate"><span class="pre">EXPECT_CALL</span></code> statements inside the <code class="docutils literal notranslate"><span class="pre">EXPECT_DEATH</span></code>
macro.</p>
</div>
<div class="section" id="expect-eq-htonl-blah-blah-blah-generates-weird-compiler-errors-in-opt-mode-is-this-a-googletest-bug">
<h2>EXPECT_EQ(htonl(blah), blah_blah) generates weird compiler errors in opt mode. Is this a googletest bug?<a class="headerlink" href="#expect-eq-htonl-blah-blah-blah-generates-weird-compiler-errors-in-opt-mode-is-this-a-googletest-bug" title="Permalink to this headline">¶</a></h2>
<p>Actually, the bug is in <code class="docutils literal notranslate"><span class="pre">htonl()</span></code>.</p>
<p>According to <code class="docutils literal notranslate"><span class="pre">'man</span> <span class="pre">htonl'</span></code>, <code class="docutils literal notranslate"><span class="pre">htonl()</span></code> is a <em>function</em>, which means it’s valid to
use <code class="docutils literal notranslate"><span class="pre">htonl</span></code> as a function pointer. However, in opt mode <code class="docutils literal notranslate"><span class="pre">htonl()</span></code> is defined as
a <em>macro</em>, which breaks this usage.</p>
<p>Worse, the macro definition of <code class="docutils literal notranslate"><span class="pre">htonl()</span></code> uses a <code class="docutils literal notranslate"><span class="pre">gcc</span></code> extension and is <em>not</em>
standard C++. That hacky implementation has some ad hoc limitations. In
particular, it prevents you from writing <code class="docutils literal notranslate"><span class="pre">Foo&lt;sizeof(htonl(x))&gt;()</span></code>, where <code class="docutils literal notranslate"><span class="pre">Foo</span></code>
is a template that has an integral argument.</p>
<p>The implementation of <code class="docutils literal notranslate"><span class="pre">EXPECT_EQ(a,</span> <span class="pre">b)</span></code> uses <code class="docutils literal notranslate"><span class="pre">sizeof(...</span> <span class="pre">a</span> <span class="pre">...)</span></code> inside a
template argument, and thus doesn’t compile in opt mode when <code class="docutils literal notranslate"><span class="pre">a</span></code> contains a call
to <code class="docutils literal notranslate"><span class="pre">htonl()</span></code>. It is difficult to make <code class="docutils literal notranslate"><span class="pre">EXPECT_EQ</span></code> bypass the <code class="docutils literal notranslate"><span class="pre">htonl()</span></code> bug, as
the solution must work with different compilers on various platforms.</p>
</div>
<div class="section" id="the-compiler-complains-about-undefined-references-to-some-static-const-member-variables-but-i-did-define-them-in-the-class-body-what-s-wrong">
<h2>The compiler complains about “undefined references” to some static const member variables, but I did define them in the class body. What’s wrong?<a class="headerlink" href="#the-compiler-complains-about-undefined-references-to-some-static-const-member-variables-but-i-did-define-them-in-the-class-body-what-s-wrong" title="Permalink to this headline">¶</a></h2>
<p>If your class has a static data member:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// foo.h</span>
<span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">kBar</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>You also need to define it <em>outside</em> of the class body in <code class="docutils literal notranslate"><span class="pre">foo.cc</span></code>:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="kt">int</span> <span class="n">Foo</span><span class="o">::</span><span class="n">kBar</span><span class="p">;</span>  <span class="c1">// No initializer here.</span>
</pre></div>
</div>
<p>Otherwise your code is <strong>invalid C++</strong>, and may break in unexpected ways. In
particular, using it in googletest comparison assertions (<code class="docutils literal notranslate"><span class="pre">EXPECT_EQ</span></code>, etc) will
generate an “undefined reference” linker error. The fact that “it used to work”
doesn’t mean it’s valid. It just means that you were lucky. :-)</p>
<p>If the declaration of the static data member is <code class="docutils literal notranslate"><span class="pre">constexpr</span></code> then it is
implicitly an <code class="docutils literal notranslate"><span class="pre">inline</span></code> definition, and a separate definition in <code class="docutils literal notranslate"><span class="pre">foo.cc</span></code> is not
needed:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// foo.h</span>
<span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="k">static</span> <span class="k">constexpr</span> <span class="kt">int</span> <span class="n">kBar</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>  <span class="c1">// Defines kBar, no need to do it in foo.cc.</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="can-i-derive-a-test-fixture-from-another">
<h2>Can I derive a test fixture from another?<a class="headerlink" href="#can-i-derive-a-test-fixture-from-another" title="Permalink to this headline">¶</a></h2>
<p>Yes.</p>
<p>Each test fixture has a corresponding and same named test suite. This means only
one test suite can use a particular fixture. Sometimes, however, multiple test
cases may want to use the same or slightly different fixtures. For example, you
may want to make sure that all of a GUI library’s test suites don’t leak
important system resources like fonts and brushes.</p>
<p>In googletest, you share a fixture among test suites by putting the shared logic
in a base test fixture, then deriving from that base a separate fixture for each
test suite that wants to use this common logic. You then use <code class="docutils literal notranslate"><span class="pre">TEST_F()</span></code> to write
tests using each derived fixture.</p>
<p>Typically, your code looks like this:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// Defines a base test fixture.</span>
<span class="k">class</span> <span class="nc">BaseTest</span> <span class="o">:</span> <span class="k">public</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Test</span> <span class="p">{</span>
 <span class="k">protected</span><span class="o">:</span>
  <span class="p">...</span>
<span class="p">};</span>

<span class="c1">// Derives a fixture FooTest from BaseTest.</span>
<span class="k">class</span> <span class="nc">FooTest</span> <span class="o">:</span> <span class="k">public</span> <span class="n">BaseTest</span> <span class="p">{</span>
 <span class="k">protected</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">SetUp</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span>
    <span class="n">BaseTest</span><span class="o">::</span><span class="n">SetUp</span><span class="p">();</span>  <span class="c1">// Sets up the base fixture first.</span>
    <span class="p">...</span> <span class="n">additional</span> <span class="n">set</span><span class="o">-</span><span class="n">up</span> <span class="n">work</span> <span class="p">...</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="n">TearDown</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span>
    <span class="p">...</span> <span class="n">clean</span><span class="o">-</span><span class="n">up</span> <span class="n">work</span> <span class="k">for</span> <span class="n">FooTest</span> <span class="p">...</span>
    <span class="n">BaseTest</span><span class="o">::</span><span class="n">TearDown</span><span class="p">();</span>  <span class="c1">// Remember to tear down the base fixture</span>
                           <span class="c1">// after cleaning up FooTest!</span>
  <span class="p">}</span>

  <span class="p">...</span> <span class="n">functions</span> <span class="n">and</span> <span class="n">variables</span> <span class="k">for</span> <span class="n">FooTest</span> <span class="p">...</span>
<span class="p">};</span>

<span class="c1">// Tests that use the fixture FooTest.</span>
<span class="n">TEST_F</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Bar</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">TEST_F</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Baz</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

<span class="p">...</span> <span class="n">additional</span> <span class="n">fixtures</span> <span class="n">derived</span> <span class="n">from</span> <span class="n">BaseTest</span> <span class="p">...</span>
</pre></div>
</div>
<p>If necessary, you can continue to derive test fixtures from a derived fixture.
googletest has no limit on how deep the hierarchy can be.</p>
<p>For a complete example using derived test fixtures, see
<a class="reference external" href="https://github.com/google/googletest/blob/master/googletest/samples/sample5_unittest.cc">sample5_unittest.cc</a>.</p>
</div>
<div class="section" id="my-compiler-complains-void-value-not-ignored-as-it-ought-to-be-what-does-this-mean">
<h2>My compiler complains “void value not ignored as it ought to be.” What does this mean?<a class="headerlink" href="#my-compiler-complains-void-value-not-ignored-as-it-ought-to-be-what-does-this-mean" title="Permalink to this headline">¶</a></h2>
<p>You’re probably using an <code class="docutils literal notranslate"><span class="pre">ASSERT_*()</span></code> in a function that doesn’t return <code class="docutils literal notranslate"><span class="pre">void</span></code>.
<code class="docutils literal notranslate"><span class="pre">ASSERT_*()</span></code> can only be used in <code class="docutils literal notranslate"><span class="pre">void</span></code> functions, due to exceptions being
disabled by our build system. Please see more details
<a class="reference internal" href="advanced.html#assertion-placement"><span class="std std-ref">here</span></a>.</p>
</div>
<div class="section" id="my-death-test-hangs-or-seg-faults-how-do-i-fix-it">
<h2>My death test hangs (or seg-faults). How do I fix it?<a class="headerlink" href="#my-death-test-hangs-or-seg-faults-how-do-i-fix-it" title="Permalink to this headline">¶</a></h2>
<p>In googletest, death tests are run in a child process and the way they work is
delicate. To write death tests you really need to understand how they work—see
the details at Death Assertions in the
Assertions Reference.</p>
<p>In particular, death tests don’t like having multiple threads in the parent
process. So the first thing you can try is to eliminate creating threads outside
of <code class="docutils literal notranslate"><span class="pre">EXPECT_DEATH()</span></code>. For example, you may want to use mocks or fake objects
instead of real ones in your tests.</p>
<p>Sometimes this is impossible as some library you must use may be creating
threads before <code class="docutils literal notranslate"><span class="pre">main()</span></code> is even reached. In this case, you can try to minimize
the chance of conflicts by either moving as many activities as possible inside
<code class="docutils literal notranslate"><span class="pre">EXPECT_DEATH()</span></code> (in the extreme case, you want to move everything inside), or
leaving as few things as possible in it. Also, you can try to set the death test
style to <code class="docutils literal notranslate"><span class="pre">&quot;threadsafe&quot;</span></code>, which is safer but slower, and see if it helps.</p>
<p>If you go with thread-safe death tests, remember that they rerun the test
program from the beginning in the child process. Therefore make sure your
program can run side-by-side with itself and is deterministic.</p>
<p>In the end, this boils down to good concurrent programming. You have to make
sure that there are no race conditions or deadlocks in your program. No silver
bullet - sorry!</p>
</div>
<div class="section" id="should-i-use-the-constructor-destructor-of-the-test-fixture-or-setup-teardown-ctorvssetup">
<h2>Should I use the constructor/destructor of the test fixture or SetUp()/TearDown()? {#CtorVsSetUp}<a class="headerlink" href="#should-i-use-the-constructor-destructor-of-the-test-fixture-or-setup-teardown-ctorvssetup" title="Permalink to this headline">¶</a></h2>
<p>The first thing to remember is that googletest does <strong>not</strong> reuse the same test
fixture object across multiple tests. For each <code class="docutils literal notranslate"><span class="pre">TEST_F</span></code>, googletest will create
a <strong>fresh</strong> test fixture object, immediately call <code class="docutils literal notranslate"><span class="pre">SetUp()</span></code>, run the test body,
call <code class="docutils literal notranslate"><span class="pre">TearDown()</span></code>, and then delete the test fixture object.</p>
<p>When you need to write per-test set-up and tear-down logic, you have the choice
between using the test fixture constructor/destructor or <code class="docutils literal notranslate"><span class="pre">SetUp()/TearDown()</span></code>.
The former is usually preferred, as it has the following benefits:</p>
<ul class="simple">
<li><p>By initializing a member variable in the constructor, we have the option to
make it <code class="docutils literal notranslate"><span class="pre">const</span></code>, which helps prevent accidental changes to its value and
makes the tests more obviously correct.</p></li>
<li><p>In case we need to subclass the test fixture class, the subclass’
constructor is guaranteed to call the base class’ constructor <em>first</em>, and
the subclass’ destructor is guaranteed to call the base class’ destructor
<em>afterward</em>. With <code class="docutils literal notranslate"><span class="pre">SetUp()/TearDown()</span></code>, a subclass may make the mistake of
forgetting to call the base class’ <code class="docutils literal notranslate"><span class="pre">SetUp()/TearDown()</span></code> or call them at the
wrong time.</p></li>
</ul>
<p>You may still want to use <code class="docutils literal notranslate"><span class="pre">SetUp()/TearDown()</span></code> in the following cases:</p>
<ul class="simple">
<li><p>C++ does not allow virtual function calls in constructors and destructors.
You can call a method declared as virtual, but it will not use dynamic
dispatch, it will use the definition from the class the constructor of which
is currently executing. This is because calling a virtual method before the
derived class constructor has a chance to run is very dangerous - the
virtual method might operate on uninitialized data. Therefore, if you need
to call a method that will be overridden in a derived class, you have to use
<code class="docutils literal notranslate"><span class="pre">SetUp()/TearDown()</span></code>.</p></li>
<li><p>In the body of a constructor (or destructor), it’s not possible to use the
<code class="docutils literal notranslate"><span class="pre">ASSERT_xx</span></code> macros. Therefore, if the set-up operation could cause a fatal
test failure that should prevent the test from running, it’s necessary to
use <code class="docutils literal notranslate"><span class="pre">abort</span></code> and abort the whole test
executable, or to use <code class="docutils literal notranslate"><span class="pre">SetUp()</span></code> instead of a constructor.</p></li>
<li><p>If the tear-down operation could throw an exception, you must use
<code class="docutils literal notranslate"><span class="pre">TearDown()</span></code> as opposed to the destructor, as throwing in a destructor leads
to undefined behavior and usually will kill your program right away. Note
that many standard libraries (like STL) may throw when exceptions are
enabled in the compiler. Therefore you should prefer <code class="docutils literal notranslate"><span class="pre">TearDown()</span></code> if you
want to write portable tests that work with or without exceptions.</p></li>
<li><p>The googletest team is considering making the assertion macros throw on
platforms where exceptions are enabled (e.g. Windows, Mac OS, and Linux
client-side), which will eliminate the need for the user to propagate
failures from a subroutine to its caller. Therefore, you shouldn’t use
googletest assertions in a destructor if your code could run on such a
platform.</p></li>
</ul>
</div>
<div class="section" id="the-compiler-complains-no-matching-function-to-call-when-i-use-assert-pred-how-do-i-fix-it">
<h2>The compiler complains “no matching function to call” when I use ASSERT_PRED*. How do I fix it?<a class="headerlink" href="#the-compiler-complains-no-matching-function-to-call-when-i-use-assert-pred-how-do-i-fix-it" title="Permalink to this headline">¶</a></h2>
<p>See details for EXPECT_PRED* in the
Assertions Reference.</p>
</div>
<div class="section" id="my-compiler-complains-about-ignoring-return-value-when-i-call-run-all-tests-why">
<h2>My compiler complains about “ignoring return value” when I call RUN_ALL_TESTS(). Why?<a class="headerlink" href="#my-compiler-complains-about-ignoring-return-value-when-i-call-run-all-tests-why" title="Permalink to this headline">¶</a></h2>
<p>Some people had been ignoring the return value of <code class="docutils literal notranslate"><span class="pre">RUN_ALL_TESTS()</span></code>. That is,
instead of</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span>  <span class="k">return</span> <span class="nf">RUN_ALL_TESTS</span><span class="p">();</span>
</pre></div>
</div>
<p>they write</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span>  <span class="n">RUN_ALL_TESTS</span><span class="p">();</span>
</pre></div>
</div>
<p>This is <strong>wrong and dangerous</strong>. The testing services needs to see the return
value of <code class="docutils literal notranslate"><span class="pre">RUN_ALL_TESTS()</span></code> in order to determine if a test has passed. If your
<code class="docutils literal notranslate"><span class="pre">main()</span></code> function ignores it, your test will be considered successful even if it
has a googletest assertion failure. Very bad.</p>
<p>We have decided to fix this (thanks to Michael Chastain for the idea). Now, your
code will no longer be able to ignore <code class="docutils literal notranslate"><span class="pre">RUN_ALL_TESTS()</span></code> when compiled with
<code class="docutils literal notranslate"><span class="pre">gcc</span></code>. If you do so, you’ll get a compiler error.</p>
<p>If you see the compiler complaining about you ignoring the return value of
<code class="docutils literal notranslate"><span class="pre">RUN_ALL_TESTS()</span></code>, the fix is simple: just make sure its value is used as the
return value of <code class="docutils literal notranslate"><span class="pre">main()</span></code>.</p>
<p>But how could we introduce a change that breaks existing tests? Well, in this
case, the code was already broken in the first place, so we didn’t break it. :-)</p>
</div>
<div class="section" id="my-compiler-complains-that-a-constructor-or-destructor-cannot-return-a-value-what-s-going-on">
<h2>My compiler complains that a constructor (or destructor) cannot return a value. What’s going on?<a class="headerlink" href="#my-compiler-complains-that-a-constructor-or-destructor-cannot-return-a-value-what-s-going-on" title="Permalink to this headline">¶</a></h2>
<p>Due to a peculiarity of C++, in order to support the syntax for streaming
messages to an <code class="docutils literal notranslate"><span class="pre">ASSERT_*</span></code>, e.g.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span>  <span class="n">ASSERT_EQ</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Foo</span><span class="p">())</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;blah blah&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">foo</span><span class="p">;</span>
</pre></div>
</div>
<p>we had to give up using <code class="docutils literal notranslate"><span class="pre">ASSERT*</span></code> and <code class="docutils literal notranslate"><span class="pre">FAIL*</span></code> (but not <code class="docutils literal notranslate"><span class="pre">EXPECT*</span></code> and
<code class="docutils literal notranslate"><span class="pre">ADD_FAILURE*</span></code>) in constructors and destructors. The workaround is to move the
content of your constructor/destructor to a private void member function, or
switch to <code class="docutils literal notranslate"><span class="pre">EXPECT_*()</span></code> if that works. This
<a class="reference internal" href="advanced.html#assertion-placement"><span class="std std-ref">section</span></a> in the user’s guide explains it.</p>
</div>
<div class="section" id="my-setup-function-is-not-called-why">
<h2>My SetUp() function is not called. Why?<a class="headerlink" href="#my-setup-function-is-not-called-why" title="Permalink to this headline">¶</a></h2>
<p>C++ is case-sensitive. Did you spell it as <code class="docutils literal notranslate"><span class="pre">Setup()</span></code>?</p>
<p>Similarly, sometimes people spell <code class="docutils literal notranslate"><span class="pre">SetUpTestSuite()</span></code> as <code class="docutils literal notranslate"><span class="pre">SetupTestSuite()</span></code> and
wonder why it’s never called.</p>
</div>
<div class="section" id="i-have-several-test-suites-which-share-the-same-test-fixture-logic-do-i-have-to-define-a-new-test-fixture-class-for-each-of-them-this-seems-pretty-tedious">
<h2>I have several test suites which share the same test fixture logic, do I have to define a new test fixture class for each of them? This seems pretty tedious.<a class="headerlink" href="#i-have-several-test-suites-which-share-the-same-test-fixture-logic-do-i-have-to-define-a-new-test-fixture-class-for-each-of-them-this-seems-pretty-tedious" title="Permalink to this headline">¶</a></h2>
<p>You don’t have to. Instead of</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FooTest</span> <span class="o">:</span> <span class="k">public</span> <span class="n">BaseTest</span> <span class="p">{};</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Abc</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">TEST_F</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Def</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

<span class="k">class</span> <span class="nc">BarTest</span> <span class="o">:</span> <span class="k">public</span> <span class="n">BaseTest</span> <span class="p">{};</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">BarTest</span><span class="p">,</span> <span class="n">Abc</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">TEST_F</span><span class="p">(</span><span class="n">BarTest</span><span class="p">,</span> <span class="n">Def</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>you can simply <code class="docutils literal notranslate"><span class="pre">typedef</span></code> the test fixtures:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="n">BaseTest</span> <span class="n">FooTest</span><span class="p">;</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Abc</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">TEST_F</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Def</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

<span class="k">typedef</span> <span class="n">BaseTest</span> <span class="n">BarTest</span><span class="p">;</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">BarTest</span><span class="p">,</span> <span class="n">Abc</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">TEST_F</span><span class="p">(</span><span class="n">BarTest</span><span class="p">,</span> <span class="n">Def</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="googletest-output-is-buried-in-a-whole-bunch-of-log-messages-what-do-i-do">
<h2>googletest output is buried in a whole bunch of LOG messages. What do I do?<a class="headerlink" href="#googletest-output-is-buried-in-a-whole-bunch-of-log-messages-what-do-i-do" title="Permalink to this headline">¶</a></h2>
<p>The googletest output is meant to be a concise and human-friendly report. If
your test generates textual output itself, it will mix with the googletest
output, making it hard to read. However, there is an easy solution to this
problem.</p>
<p>Since <code class="docutils literal notranslate"><span class="pre">LOG</span></code> messages go to stderr, we decided to let googletest output go to
stdout. This way, you can easily separate the two using redirection. For
example:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ ./my_test &gt; gtest_output.txt
</pre></div>
</div>
</div>
<div class="section" id="why-should-i-prefer-test-fixtures-over-global-variables">
<h2>Why should I prefer test fixtures over global variables?<a class="headerlink" href="#why-should-i-prefer-test-fixtures-over-global-variables" title="Permalink to this headline">¶</a></h2>
<p>There are several good reasons:</p>
<ol class="simple">
<li><p>It’s likely your test needs to change the states of its global variables.
This makes it difficult to keep side effects from escaping one test and
contaminating others, making debugging difficult. By using fixtures, each
test has a fresh set of variables that’s different (but with the same
names). Thus, tests are kept independent of each other.</p></li>
<li><p>Global variables pollute the global namespace.</p></li>
<li><p>Test fixtures can be reused via subclassing, which cannot be done easily
with global variables. This is useful if many test suites have something in
common.</p></li>
</ol>
</div>
<div class="section" id="what-can-the-statement-argument-in-assert-death-be">
<h2>What can the statement argument in ASSERT_DEATH() be?<a class="headerlink" href="#what-can-the-statement-argument-in-assert-death-be" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">ASSERT_DEATH(statement,</span> <span class="pre">matcher)</span></code> (or any death assertion macro) can be used
wherever <em><code class="docutils literal notranslate"><span class="pre">statement</span></code></em> is valid. So basically <em><code class="docutils literal notranslate"><span class="pre">statement</span></code></em> can be any C++
statement that makes sense in the current context. In particular, it can
reference global and/or local variables, and can be:</p>
<ul class="simple">
<li><p>a simple function call (often the case),</p></li>
<li><p>a complex expression, or</p></li>
<li><p>a compound statement.</p></li>
</ul>
<p>Some examples are shown here:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// A death test can be a simple function call.</span>
<span class="n">TEST</span><span class="p">(</span><span class="n">MyDeathTest</span><span class="p">,</span> <span class="n">FunctionCall</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">ASSERT_DEATH</span><span class="p">(</span><span class="n">Xyz</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="s">&quot;Xyz failed&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Or a complex expression that references variables and functions.</span>
<span class="n">TEST</span><span class="p">(</span><span class="n">MyDeathTest</span><span class="p">,</span> <span class="n">ComplexExpression</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">const</span> <span class="kt">bool</span> <span class="n">c</span> <span class="o">=</span> <span class="n">Condition</span><span class="p">();</span>
  <span class="n">ASSERT_DEATH</span><span class="p">((</span><span class="n">c</span> <span class="o">?</span> <span class="n">Func1</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="n">object2</span><span class="p">.</span><span class="n">Method</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">)),</span>
               <span class="s">&quot;(Func1|Method) failed&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Death assertions can be used anywhere in a function.  In</span>
<span class="c1">// particular, they can be inside a loop.</span>
<span class="n">TEST</span><span class="p">(</span><span class="n">MyDeathTest</span><span class="p">,</span> <span class="n">InsideLoop</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Verifies that Foo(0), Foo(1), ..., and Foo(4) all die.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">EXPECT_DEATH_M</span><span class="p">(</span><span class="n">Foo</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s">&quot;Foo has </span><span class="se">\\</span><span class="s">d+ errors&quot;</span><span class="p">,</span>
                   <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Message</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;where i is &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// A death assertion can contain a compound statement.</span>
<span class="n">TEST</span><span class="p">(</span><span class="n">MyDeathTest</span><span class="p">,</span> <span class="n">CompoundStatement</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Verifies that at lease one of Bar(0), Bar(1), ..., and</span>
  <span class="c1">// Bar(4) dies.</span>
  <span class="n">ASSERT_DEATH</span><span class="p">({</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Bar</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s">&quot;Bar has </span><span class="se">\\</span><span class="s">d+ errors&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="i-have-a-fixture-class-footest-but-test-f-footest-bar-gives-me-error-no-matching-function-for-call-to-footest-footest-why">
<h2>I have a fixture class <code class="docutils literal notranslate"><span class="pre">FooTest</span></code>, but <code class="docutils literal notranslate"><span class="pre">TEST_F(FooTest,</span> <span class="pre">Bar)</span></code> gives me error <code class="docutils literal notranslate"><span class="pre">&quot;no</span> <span class="pre">matching</span> <span class="pre">function</span> <span class="pre">for</span> <span class="pre">call</span> <span class="pre">to</span> <span class="pre">`FooTest::FooTest()'&quot;</span></code>. Why?<a class="headerlink" href="#i-have-a-fixture-class-footest-but-test-f-footest-bar-gives-me-error-no-matching-function-for-call-to-footest-footest-why" title="Permalink to this headline">¶</a></h2>
<p>Googletest needs to be able to create objects of your test fixture class, so it
must have a default constructor. Normally the compiler will define one for you.
However, there are cases where you have to define your own:</p>
<ul class="simple">
<li><p>If you explicitly declare a non-default constructor for class <code class="docutils literal notranslate"><span class="pre">FooTest</span></code>
(<code class="docutils literal notranslate"><span class="pre">DISALLOW_EVIL_CONSTRUCTORS()</span></code> does this), then you need to define a
default constructor, even if it would be empty.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">FooTest</span></code> has a const non-static data member, then you have to define the
default constructor <em>and</em> initialize the const member in the initializer
list of the constructor. (Early versions of <code class="docutils literal notranslate"><span class="pre">gcc</span></code> doesn’t force you to
initialize the const member. It’s a bug that has been fixed in <code class="docutils literal notranslate"><span class="pre">gcc</span> <span class="pre">4</span></code>.)</p></li>
</ul>
</div>
<div class="section" id="why-does-assert-death-complain-about-previous-threads-that-were-already-joined">
<h2>Why does ASSERT_DEATH complain about previous threads that were already joined?<a class="headerlink" href="#why-does-assert-death-complain-about-previous-threads-that-were-already-joined" title="Permalink to this headline">¶</a></h2>
<p>With the Linux pthread library, there is no turning back once you cross the line
from a single thread to multiple threads. The first time you create a thread, a
manager thread is created in addition, so you get 3, not 2, threads. Later when
the thread you create joins the main thread, the thread count decrements by 1,
but the manager thread will never be killed, so you still have 2 threads, which
means you cannot safely run a death test.</p>
<p>The new NPTL thread library doesn’t suffer from this problem, as it doesn’t
create a manager thread. However, if you don’t control which machine your test
runs on, you shouldn’t depend on this.</p>
</div>
<div class="section" id="why-does-googletest-require-the-entire-test-suite-instead-of-individual-tests-to-be-named-deathtest-when-it-uses-assert-death">
<h2>Why does googletest require the entire test suite, instead of individual tests, to be named *DeathTest when it uses ASSERT_DEATH?<a class="headerlink" href="#why-does-googletest-require-the-entire-test-suite-instead-of-individual-tests-to-be-named-deathtest-when-it-uses-assert-death" title="Permalink to this headline">¶</a></h2>
<p>googletest does not interleave tests from different test suites. That is, it
runs all tests in one test suite first, and then runs all tests in the next test
suite, and so on. googletest does this because it needs to set up a test suite
before the first test in it is run, and tear it down afterwards. Splitting up
the test case would require multiple set-up and tear-down processes, which is
inefficient and makes the semantics unclean.</p>
<p>If we were to determine the order of tests based on test name instead of test
case name, then we would have a problem with the following situation:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">TEST_F</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">AbcDeathTest</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">TEST_F</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Uvw</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">BarTest</span><span class="p">,</span> <span class="n">DefDeathTest</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">TEST_F</span><span class="p">(</span><span class="n">BarTest</span><span class="p">,</span> <span class="n">Xyz</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>Since <code class="docutils literal notranslate"><span class="pre">FooTest.AbcDeathTest</span></code> needs to run before <code class="docutils literal notranslate"><span class="pre">BarTest.Xyz</span></code>, and we don’t
interleave tests from different test suites, we need to run all tests in the
<code class="docutils literal notranslate"><span class="pre">FooTest</span></code> case before running any test in the <code class="docutils literal notranslate"><span class="pre">BarTest</span></code> case. This contradicts
with the requirement to run <code class="docutils literal notranslate"><span class="pre">BarTest.DefDeathTest</span></code> before <code class="docutils literal notranslate"><span class="pre">FooTest.Uvw</span></code>.</p>
</div>
<div class="section" id="but-i-don-t-like-calling-my-entire-test-suite-deathtest-when-it-contains-both-death-tests-and-non-death-tests-what-do-i-do">
<h2>But I don’t like calling my entire test suite *DeathTest when it contains both death tests and non-death tests. What do I do?<a class="headerlink" href="#but-i-don-t-like-calling-my-entire-test-suite-deathtest-when-it-contains-both-death-tests-and-non-death-tests-what-do-i-do" title="Permalink to this headline">¶</a></h2>
<p>You don’t have to, but if you like, you may split up the test suite into
<code class="docutils literal notranslate"><span class="pre">FooTest</span></code> and <code class="docutils literal notranslate"><span class="pre">FooDeathTest</span></code>, where the names make it clear that they are
related:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FooTest</span> <span class="o">:</span> <span class="k">public</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Test</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Abc</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">TEST_F</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Def</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

<span class="k">using</span> <span class="n">FooDeathTest</span> <span class="o">=</span> <span class="n">FooTest</span><span class="p">;</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">FooDeathTest</span><span class="p">,</span> <span class="n">Uvw</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="n">EXPECT_DEATH</span><span class="p">(...)</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">TEST_F</span><span class="p">(</span><span class="n">FooDeathTest</span><span class="p">,</span> <span class="n">Xyz</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="n">ASSERT_DEATH</span><span class="p">(...)</span> <span class="p">...</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="googletest-prints-the-log-messages-in-a-death-test-s-child-process-only-when-the-test-fails-how-can-i-see-the-log-messages-when-the-death-test-succeeds">
<h2>googletest prints the LOG messages in a death test’s child process only when the test fails. How can I see the LOG messages when the death test succeeds?<a class="headerlink" href="#googletest-prints-the-log-messages-in-a-death-test-s-child-process-only-when-the-test-fails-how-can-i-see-the-log-messages-when-the-death-test-succeeds" title="Permalink to this headline">¶</a></h2>
<p>Printing the LOG messages generated by the statement inside <code class="docutils literal notranslate"><span class="pre">EXPECT_DEATH()</span></code>
makes it harder to search for real problems in the parent’s log. Therefore,
googletest only prints them when the death test has failed.</p>
<p>If you really need to see such LOG messages, a workaround is to temporarily
break the death test (e.g. by changing the regex pattern it is expected to
match). Admittedly, this is a hack. We’ll consider a more permanent solution
after the fork-and-exec-style death tests are implemented.</p>
</div>
<div class="section" id="the-compiler-complains-about-no-match-for-operator-when-i-use-an-assertion-what-gives">
<h2>The compiler complains about <code class="docutils literal notranslate"><span class="pre">no</span> <span class="pre">match</span> <span class="pre">for</span> <span class="pre">'operator&lt;&lt;'</span></code> when I use an assertion. What gives?<a class="headerlink" href="#the-compiler-complains-about-no-match-for-operator-when-i-use-an-assertion-what-gives" title="Permalink to this headline">¶</a></h2>
<p>If you use a user-defined type <code class="docutils literal notranslate"><span class="pre">FooType</span></code> in an assertion, you must make sure
there is an <code class="docutils literal notranslate"><span class="pre">std::ostream&amp;</span> <span class="pre">operator&lt;&lt;(std::ostream&amp;,</span> <span class="pre">const</span> <span class="pre">FooType&amp;)</span></code> function
defined such that we can print a value of <code class="docutils literal notranslate"><span class="pre">FooType</span></code>.</p>
<p>In addition, if <code class="docutils literal notranslate"><span class="pre">FooType</span></code> is declared in a name space, the <code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span></code> operator also
needs to be defined in the <em>same</em> name space. See
<a class="reference external" href="http://abseil.io/tips/49">Tip of the Week #49</a> for details.</p>
</div>
<div class="section" id="how-do-i-suppress-the-memory-leak-messages-on-windows">
<h2>How do I suppress the memory leak messages on Windows?<a class="headerlink" href="#how-do-i-suppress-the-memory-leak-messages-on-windows" title="Permalink to this headline">¶</a></h2>
<p>Since the statically initialized googletest singleton requires allocations on
the heap, the Visual C++ memory leak detector will report memory leaks at the
end of the program run. The easiest way to avoid this is to use the
<code class="docutils literal notranslate"><span class="pre">_CrtMemCheckpoint</span></code> and <code class="docutils literal notranslate"><span class="pre">_CrtMemDumpAllObjectsSince</span></code> calls to not report any
statically initialized heap objects. See MSDN for more details and additional
heap check/debug routines.</p>
</div>
<div class="section" id="how-can-my-code-detect-if-it-is-running-in-a-test">
<h2>How can my code detect if it is running in a test?<a class="headerlink" href="#how-can-my-code-detect-if-it-is-running-in-a-test" title="Permalink to this headline">¶</a></h2>
<p>If you write code that sniffs whether it’s running in a test and does different
things accordingly, you are leaking test-only logic into production code and
there is no easy way to ensure that the test-only code paths aren’t run by
mistake in production. Such cleverness also leads to
<a class="reference external" href="https://en.wikipedia.org/wiki/Heisenbug">Heisenbugs</a>. Therefore we strongly
advise against the practice, and googletest doesn’t provide a way to do it.</p>
<p>In general, the recommended way to cause the code to behave differently under
test is <a class="reference external" href="http://en.wikipedia.org/wiki/Dependency_injection">Dependency Injection</a>. You can inject
different functionality from the test and from the production code. Since your
production code doesn’t link in the for-test logic at all (the
<a class="reference external" href="http://docs.bazel.build/versions/master/be/common-definitions.html#common.testonly"><code class="docutils literal notranslate"><span class="pre">testonly</span></code></a> attribute for BUILD targets helps to ensure
that), there is no danger in accidentally running it.</p>
<p>However, if you <em>really</em>, <em>really</em>, <em>really</em> have no choice, and if you follow
the rule of ending your test program names with <code class="docutils literal notranslate"><span class="pre">_test</span></code>, you can use the
<em>horrible</em> hack of sniffing your executable name (<code class="docutils literal notranslate"><span class="pre">argv[0]</span></code> in <code class="docutils literal notranslate"><span class="pre">main()</span></code>) to know
whether the code is under test.</p>
</div>
<div class="section" id="how-do-i-temporarily-disable-a-test">
<h2>How do I temporarily disable a test?<a class="headerlink" href="#how-do-i-temporarily-disable-a-test" title="Permalink to this headline">¶</a></h2>
<p>If you have a broken test that you cannot fix right away, you can add the
<code class="docutils literal notranslate"><span class="pre">DISABLED_</span></code> prefix to its name. This will exclude it from execution. This is
better than commenting out the code or using <code class="docutils literal notranslate"><span class="pre">#if</span> <span class="pre">0</span></code>, as disabled tests are
still compiled (and thus won’t rot).</p>
<p>To include disabled tests in test execution, just invoke the test program with
the <code class="docutils literal notranslate"><span class="pre">--gtest_also_run_disabled_tests</span></code> flag.</p>
</div>
<div class="section" id="is-it-ok-if-i-have-two-separate-test-foo-bar-test-methods-defined-in-different-namespaces">
<h2>Is it OK if I have two separate <code class="docutils literal notranslate"><span class="pre">TEST(Foo,</span> <span class="pre">Bar)</span></code> test methods defined in different namespaces?<a class="headerlink" href="#is-it-ok-if-i-have-two-separate-test-foo-bar-test-methods-defined-in-different-namespaces" title="Permalink to this headline">¶</a></h2>
<p>Yes.</p>
<p>The rule is <strong>all test methods in the same test suite must use the same fixture
class.</strong> This means that the following is <strong>allowed</strong> because both tests use the
same fixture class (<code class="docutils literal notranslate"><span class="pre">::testing::Test</span></code>).</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="n">foo</span> <span class="p">{</span>
<span class="n">TEST</span><span class="p">(</span><span class="n">CoolTest</span><span class="p">,</span> <span class="n">DoSomething</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">SUCCEED</span><span class="p">();</span>
<span class="p">}</span>
<span class="p">}</span>  <span class="c1">// namespace foo</span>

<span class="k">namespace</span> <span class="n">bar</span> <span class="p">{</span>
<span class="n">TEST</span><span class="p">(</span><span class="n">CoolTest</span><span class="p">,</span> <span class="n">DoSomething</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">SUCCEED</span><span class="p">();</span>
<span class="p">}</span>
<span class="p">}</span>  <span class="c1">// namespace bar</span>
</pre></div>
</div>
<p>However, the following code is <strong>not allowed</strong> and will produce a runtime error
from googletest because the test methods are using different test fixture
classes with the same test suite name.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="n">foo</span> <span class="p">{</span>
<span class="k">class</span> <span class="nc">CoolTest</span> <span class="o">:</span> <span class="k">public</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Test</span> <span class="p">{};</span>  <span class="c1">// Fixture foo::CoolTest</span>
<span class="n">TEST_F</span><span class="p">(</span><span class="n">CoolTest</span><span class="p">,</span> <span class="n">DoSomething</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">SUCCEED</span><span class="p">();</span>
<span class="p">}</span>
<span class="p">}</span>  <span class="c1">// namespace foo</span>

<span class="k">namespace</span> <span class="n">bar</span> <span class="p">{</span>
<span class="k">class</span> <span class="nc">CoolTest</span> <span class="o">:</span> <span class="k">public</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Test</span> <span class="p">{};</span>  <span class="c1">// Fixture: bar::CoolTest</span>
<span class="n">TEST_F</span><span class="p">(</span><span class="n">CoolTest</span><span class="p">,</span> <span class="n">DoSomething</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">SUCCEED</span><span class="p">();</span>
<span class="p">}</span>
<span class="p">}</span>  <span class="c1">// namespace bar</span>
</pre></div>
</div>
</div>
</div>


                        
                    </div>
                </div>
            </div>
        </div>
    </div>    


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../',
            VERSION:'1.0.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
    <script type="text/javascript" src="../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/clipboard.min.js"></script>
    <script type="text/javascript" src="../../../../_static/copybutton.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>
  
    <div class="footer" role="contentinfo">
        <div class="container">
            &#169; Copyright bladedisc-dev@list.alibaba-inc.com.
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.3.2.
        </div>
    </div>  

</body>
</html>